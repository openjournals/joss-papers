<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE article PUBLIC "-//NLM//DTD JATS (Z39.96) Journal Publishing DTD v1.2 20190208//EN"
                  "JATS-publishing1.dtd">
<article xmlns:mml="http://www.w3.org/1998/Math/MathML" xmlns:xlink="http://www.w3.org/1999/xlink" dtd-version="1.2" article-type="other">
<front>
<journal-meta>
<journal-id></journal-id>
<journal-title-group>
<journal-title>Journal of Open Source Software</journal-title>
<abbrev-journal-title>JOSS</abbrev-journal-title>
</journal-title-group>
<issn publication-format="electronic">2475-9066</issn>
<publisher>
<publisher-name>Open Journals</publisher-name>
</publisher>
</journal-meta>
<article-meta>
<article-id pub-id-type="publisher-id">5322</article-id>
<article-id pub-id-type="doi">10.21105/joss.05322</article-id>
<title-group>
<article-title>SarcGraph: A Python package for analyzing the contractile
behavior of pluripotent stem cell-derived cardiomyocytes</article-title>
</title-group>
<contrib-group>
<contrib contrib-type="author">
<contrib-id contrib-id-type="orcid">https://orcid.org/0000-0001-9879-044X</contrib-id>
<name>
<surname>Mohammadzadeh</surname>
<given-names>Saeed</given-names>
</name>
<xref ref-type="aff" rid="aff-1"/>
</contrib>
<contrib contrib-type="author" corresp="yes">
<contrib-id contrib-id-type="orcid">https://orcid.org/0000-0001-8099-3468</contrib-id>
<name>
<surname>Lejeune</surname>
<given-names>Emma</given-names>
</name>
<xref ref-type="aff" rid="aff-2"/>
<xref ref-type="corresp" rid="cor-1"><sup>*</sup></xref>
</contrib>
<aff id="aff-1">
<institution-wrap>
<institution>Department of Systems Engineering, Boston University,
Massachusetts, the United States of America</institution>
</institution-wrap>
</aff>
<aff id="aff-2">
<institution-wrap>
<institution>Department of Mechanical Engineering, Boston University,
Massachusetts, the United States of America</institution>
</institution-wrap>
</aff>
</contrib-group>
<author-notes>
<corresp id="cor-1">* E-mail: <email></email></corresp>
</author-notes>
<pub-date date-type="pub" publication-format="electronic" iso-8601-date="2023-03-02">
<day>2</day>
<month>3</month>
<year>2023</year>
</pub-date>
<volume>8</volume>
<issue>85</issue>
<fpage>5322</fpage>
<permissions>
<copyright-statement>Authors of papers retain copyright and release the
work under a Creative Commons Attribution 4.0 International License (CC
BY 4.0)</copyright-statement>
<copyright-year>2022</copyright-year>
<copyright-holder>The article authors</copyright-holder>
<license license-type="open-access" xlink:href="https://creativecommons.org/licenses/by/4.0/">
<license-p>Authors of papers retain copyright and release the work under
a Creative Commons Attribution 4.0 International License (CC BY
4.0)</license-p>
</license>
</permissions>
<kwd-group kwd-group-type="author">
<kwd>Python</kwd>
<kwd>Quantitative Methods</kwd>
<kwd>Biomechanics</kwd>
<kwd>Sarcomeres</kwd>
<kwd>Cardiomyocytes</kwd>
</kwd-group>
</article-meta>
</front>
<body>
<sec id="summary">
  <title>Summary</title>
  <p>Heart disease remains the leading cause of death worldwide
  (<xref alt="World Health Organization, n.d." rid="ref-who_cvd_fs" ref-type="bibr">World
  Health Organization, n.d.</xref>). In response to this societal
  burden, scientific funding agencies and researchers have invested
  significant effort into understanding and controlling the functional
  behavior of heart cells. In particular, there has been a recent and
  growing focus on engineered heart cells and tissue to both better
  understand the complex interactions that drive disease, and to repair
  the damaged heart. An important component of these endeavors is the
  study of human induced pluripotent stem cell-derived cardiomyocytes
  (hiPSC-CMs), cells sampled non-invasively from living humans,
  transformed into stem cells, and subsequently differentiated into
  cardiomyocytes, i.e., cardiac muscle cells. These cardiomyocytes are
  composed of sarcomeres, sub-cellular contractile units, that can be
  fluorescently labeled and visualized via z-disc proteins. One major
  challenge in studying hiPSC-CMs in this context is that the immaturity
  and structural nonlinearities of hiPSC-CMs (i.e., disordered sarcomere
  chain structure in comparison to the almost crystalline sarcomere
  structure of mature cardiomyocytes) causes significant complications
  for performing consistent analysis of their functional contractile
  characteristics. And, though multiple methods have recently been
  developed for analyzing images of hiPSC-CMs
  (<xref alt="Gerbin et al., 2021" rid="ref-gerbin2021cell" ref-type="bibr">Gerbin
  et al., 2021</xref>;
  <xref alt="Morris et al., 2020" rid="ref-morris2020striated" ref-type="bibr">Morris
  et al., 2020</xref>;
  <xref alt="Pasqualin et al., 2016" rid="ref-pasqualin2016sarcoptim" ref-type="bibr">Pasqualin
  et al., 2016</xref>;
  <xref alt="Pasqualini et al., 2015" rid="ref-pasqualini2015structural" ref-type="bibr">Pasqualini
  et al., 2015</xref>;
  <xref alt="Ribeiro et al., 2017" rid="ref-doiU003A10.1161U002FCIRCRESAHA.116.310363" ref-type="bibr">Ribeiro
  et al., 2017</xref>;
  <xref alt="Sutcliffe et al., 2018" rid="ref-sutcliffe2018high" ref-type="bibr">Sutcliffe
  et al., 2018</xref>;
  <xref alt="Telley et al., 2006" rid="ref-TELLEY2006514" ref-type="bibr">Telley
  et al., 2006</xref>), few are suitable for analyzing the asynchronous
  contractile behavior of beating cells
  (<xref alt="Toepfer et al., 2019" rid="ref-toepfer2019sarctrack" ref-type="bibr">Toepfer
  et al., 2019</xref>). In our previous publication, we introduced a
  novel computational framework (<monospace>SarcGraph</monospace>) to
  perform this task, directly compared it to other methods, and
  demonstrated its state of the art efficacy and novel functionalities
  (<xref alt="Zhao et al., 2021" rid="ref-zhao2021sarc" ref-type="bibr">Zhao
  et al., 2021</xref>).</p>
  <p>Here we introduce an open-source Python package to make the
  <monospace>SarcGraph</monospace> approach to performing automated
  quantitative analysis of information-rich movies of fluorescently
  labeled beating hiPSC-CMs broadly accessible. In contrast to the
  original version of the software released in conjunction with our
  previous publication
  (<xref alt="Zhao et al., 2021" rid="ref-zhao2021sarc" ref-type="bibr">Zhao
  et al., 2021</xref>), the updated version is better designed, more
  efficient, and significantly more user-friendly. In addition, there
  are multiple methodological and implementation updates to improve
  overall performance. In brief, our framework includes tools to
  automatically detect and track z-discs and sarcomeres in movies of
  beating cells, and to recover sarcomere-scale and cardiomyocyte-scale
  functional behavior metrics. In addition, SarcGraph includes
  additional functions to perform post-processing spatio-temporal
  analysis and data visualization to help extract rich biological
  information. With this further development of SarcGraph, we aim to
  make automated quantitative analysis of hiPSC-CMs more accessible to
  the broader research community. To make our framework more accessible,
  SarcGraph is capable of running various video and image formats and
  textures out of the box. And, SarcGraph can be customized and adapted
  by both users and future developers. In addition to the ongoing
  maintenance of SarcGraph by our group, we expect a continuous
  contribution by other researchers to improve the software.</p>
  <fig>
    <caption><p>An example frame of a beating hiPSC-CM movie with a
    schematic illustrations of labeled z-discs and
    sarcomeres.<styled-content id="figU003Aintro"></styled-content></p></caption>
    <graphic mimetype="image" mime-subtype="png" xlink:href="media/figures/intro.png" />
  </fig>
</sec>
<sec id="statement-of-need">
  <title>Statement of Need</title>
  <p>The goal of the SarcGraph software package is to perform sarcomere
  segmentation, tracking, and analysis from images and movies of beating
  human induced pluripotent stem cell derived cardiomyocytes (hiPS-CMs).
  This is a challenging problem that requires specialized software for
  two key reasons: (1) sarcomeres are typically not imaged directly,
  rather their presence and geometry are inferred based on the location
  of labeled striations (see
  <xref alt="[fig:intro]" rid="figU003Aintro">[fig:intro]</xref>), and
  (2) unlike mature cardiomyocytes, hiPSC-CMs often have a disordered
  structure and exhibit asynchronous contraction which necessitate
  specialized methods to extract meaning from these data. The target
  audience for this software is biomedical researchers who perform
  hiPSC-CM experiments that include image analysis. This software
  package is a complete re-write of our previous version of this
  software, though we encourage users to reference our previously
  published paper
  (<xref alt="Zhao et al., 2021" rid="ref-zhao2021sarc" ref-type="bibr">Zhao
  et al., 2021</xref>) for additional theoretical and practical context.
  As a brief note for future SarcGraph users and developers, the code is
  structured so that the individual steps (e.g., data import,
  segmentation, tracking, analysis) can be used in isolation (e.g.,
  performing segmentation without tracking on single images) to
  facilitate their replacement with updated algorithms (e.g.,
  fundamentally change the segmentation algorithm but still perform
  downstream tracking and analysis).</p>
</sec>
<sec id="sarcgraph-in-action">
  <title>SarcGraph in Action</title>
  <p>SarcGraph provides users with tools to process images and movies of
  hiPSC-CMs for z-disc and sarcomere segmentation and tracking.
  <xref alt="[fig:sample]" rid="figU003Asample">[fig:sample]</xref>
  demonstrates tracked z-discs and sarcomeres in the first frames of two
  movies of beating cells. For z-disc and sarcomere segmentation, we
  build on our previously described work
  (<xref alt="Zhao et al., 2021" rid="ref-zhao2021sarc" ref-type="bibr">Zhao
  et al., 2021</xref>) and also implement a more efficient sarcomere
  detection algorithm, detailed in the
  <xref alt="Appendix" rid="appendix">Appendix</xref>. For tracking, we
  build on a previously developed Python package for particle tracking
  TrackPy
  (<xref alt="Allan et al., 2023" rid="ref-allan_daniel_b_2023_7670439" ref-type="bibr">Allan
  et al., 2023</xref>).</p>
  <fig>
    <caption><p>This figure showcases segmented z-discs and detected
    sarcomeres in the first frame of two beating hiPSC-CM movies.
    Detected sarcomeres are marked by red stars, while blue contours
    indicate z-discs. The code to generate this figure is given in
    Snippet 1 in the
    <xref alt="Appendix" rid="appendix">Appendix</xref>.<styled-content id="figU003Asample"></styled-content></p></caption>
    <graphic mimetype="image" mime-subtype="png" xlink:href="media/figures/sample_vis.png" />
  </fig>
  <p>After initial segmentation and tracking, SarcGraph offers several
  post-processing analysis and visualization functions.
  <xref alt="[fig:features]" rid="figU003Afeatures">[fig:features]</xref>
  showcases some of these features. Notably, there are multiple demos
  and tutorials that further explain these capabilities in the SarcGraph
  repository.</p>
  <fig>
    <caption><p>This figure presents three panels illustrating some of
    the post-processing features of the SarcGraph package on a sample
    movie of hiPSC-CMs. Panel (a) displays the spatial graph
    visualization of the segmented z-discs and sarcomeres. Panel (b)
    shows the average normalized sarcomere length. Panel (c) depicts the
    recovered deformation gradient matrix. These results demonstrate the
    ability of SarcGraph to analyze sarcomere dynamics in hiPSC-CMs by
    showcasing some of the post-processing features of the SarcGraph
    package. The code to generate this figure is given in Snippet 2 in
    the
    <xref alt="Appendix" rid="appendix">Appendix</xref>.<styled-content id="figU003Afeatures"></styled-content></p></caption>
    <graphic mimetype="image" mime-subtype="png" xlink:href="media/figures/features.png" />
  </fig>
  <p>To validate our methods and ensure correct implementation, we
  generated challenging synthetic movies with characteristics similar to
  beating hiPSC-CMs. We used these movies to evaluate the sarcomere
  detection algorithm by comparing recovered metrics to their known
  ground truth.
  <xref alt="[fig:validation]" rid="figU003Avalidation">[fig:validation]</xref>
  shows this process for one of the many tested validation examples.</p>
  <fig>
    <caption><p>This figure displays the performance of SarcGraph on a
    synthetically generated movie designed to replicate a beating
    hiPSC-CM. Panel (a) shows the first frame of the movie with tracked
    sarcomeres marked by red stars. Panel (b) compares the average
    normalized sarcomere length obtained from SarcGraph with the ground
    truth. Panel (c) compares the parameters related to average
    deformation obtained from SarcGraph with the ground truth. The
    results demonstrate the validity of the SarcGraph package in
    accurately analyzing sarcomere dynamics in hiPSC-CMs. As a brief
    note, the updated version of SarcGraph is better able to recover the
    ground truth from this synthetic example in comparison to the
    previous version of the framework shown in Figure 6 in
    (<xref alt="Zhao et al., 2021" rid="ref-zhao2021sarc" ref-type="bibr">Zhao
    et al., 2021</xref>). The code to generate this figure is given in
    Snippet 3 in the
    <xref alt="Appendix" rid="appendix">Appendix</xref>.<styled-content id="figU003Avalidation"></styled-content></p></caption>
    <graphic mimetype="image" mime-subtype="png" xlink:href="media/figures/validation.png" />
  </fig>
</sec>
<sec id="sarcgraph-vs.-legacy-sarc-graph">
  <title>SarcGraph vs. Legacy Sarc-Graph</title>
  <p>The updated version of the SarcGraph software has the following key
  improvements: (1) better structure, (2) testing via PyTest, (3) error
  handling, (4) efficiency improvements, (5) a novel sarcomere detection
  algorithm, and (6) significantly improved documentation including a
  documented API and multiple tutorials. This new version represents not
  only methodological improvements, but also an essential step towards
  making this a tool with longevity that can reasonably be used by
  others.</p>
  <p>Highlights include a more efficient and user-friendly design,
  achieved through various enhancements including but not limited to a
  modular design (by merging eight Python files into two), improved code
  readability (refactoring the code and removing redundancy - reducing
  the lines of code from 3,094 to 2,547), and the addition of tests and
  error handling for a more robust experience. Efficiency improvements
  include the utilization of built-in NumPy functions and the
  introduction of a new sarcomere detection algorithm. For example, the
  new algorithm detects and tracks 86 sarcomeres in the synthetic image
  (<xref alt="[fig:validation]" rid="figU003Avalidation">[fig:validation]</xref>)
  within 8.6 seconds, compared to the previous version which takes 18.3
  seconds to detect only 75 sarcomeres. In the experimental sample in
  <xref alt="[fig:sample]" rid="figU003Asample">[fig:sample]</xref>,
  left panel, the updated algorithm detects and fully tracks 329
  sarcomeres in 37 seconds, while the old algorithm takes 144 seconds to
  track only 74 sarcomeres <xref ref-type="fn" rid="fn1">1</xref>. In
  addition, SarcGraph’s enhanced user-friendliness is reflected in its
  comprehensive documentation, which includes API details and accessible
  Jupyter Notebook tutorials. Additionally, the package is available on
  both PyPI and Conda servers for easy cross-platform installation.
  Furthermore, we provide guidelines for advanced users to contribute to
  the software by adding new features and functionality, encouraging
  community-driven improvements. As stated previously, these
  user-friendly components were not present in the legacy code.</p>
</sec>
<sec id="current-limitations-and-plans-for-future-development">
  <title>Current Limitations and Plans for Future Development</title>
  <p>At present, the major limitation of SarcGraph is that it only gives
  reliable results for relatively high quality images. Very noisy and/or
  low resolution experimental images will lead to poor segmentation
  performance where inconsistent segmentation across frames leads to
  downstream failures in the tracking and analysis steps. Future
  development of SarcGraph will focus on both identifying sarcomeres in
  the presence of severe noise, and on adding functionality that can
  individually segment overlapping and partially occluded z-discs.
  Furthermore, the performance of the algorithm is sensitive to
  parameter settings, and while we have fine-tuned the parameters for
  the samples we worked with, users might need to adjust them for
  different samples. Future development of SarcGraph will draw from more
  diverse datasets to create automatic parameter tuning routines to
  avoid this issue. Finally, in the current version of SarcGraph,
  detected sarcomeres are not guaranteed to be correctly identified.
  Future development will be required to more robustly reject spurious
  sarcomeres.</p>
</sec>
<sec id="acknowledgements">
  <title>Acknowledgements</title>
  <p>This work was made possible through the support of the Boston
  University David R. Dalton Career Development Professorship, the
  Boston University Hariri Institute Junior Faculty Fellowship, the
  National Science Foundation CELL-MET ERC EEC-1647837, and the American
  Heart Association Career Development Award 856354. This support is
  gratefully acknowledged.</p>
</sec>
<sec id="appendix">
  <title>Appendix</title>
  <sec id="sarcomere-detection-algorithm">
    <title>Sarcomere Detection Algorithm</title>
    <p>In this implementation of SarcGraph, we introduce a novel and
    further customizable algorithm for sarcomere detection, which
    replaces the ghost points-based approach used in our previous work
    (<xref alt="Zhao et al., 2021" rid="ref-zhao2021sarc" ref-type="bibr">Zhao
    et al., 2021</xref>). Our new method works by first constructing a
    spatial graph from the segmented z-discs in a given frame of the
    movie. In this initial spatial graph, each node represents a z-disc
    and each edge represents a potential sarcomere location where each
    node is initially connected to its three nearest neighbors. To score
    each edge, we define a function <inline-formula><alternatives>
    <tex-math><![CDATA[\mathcal{S}_i]]></tex-math>
    <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:msub><mml:mi>𝒮</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:math></alternatives></inline-formula>
    that takes into account the length of the edge
    <inline-formula><alternatives>
    <tex-math><![CDATA[l_i]]></tex-math>
    <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:msub><mml:mi>l</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:math></alternatives></inline-formula>,
    the angle between the edge and its neighboring edges
    <inline-formula><alternatives>
    <tex-math><![CDATA[\theta_{i,j}]]></tex-math>
    <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:msub><mml:mi>θ</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:math></alternatives></inline-formula>,
    the maximum allowable length for a sarcomere
    <inline-formula><alternatives>
    <tex-math><![CDATA[l_{max}]]></tex-math>
    <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:msub><mml:mi>l</mml:mi><mml:mrow><mml:mi>m</mml:mi><mml:mi>a</mml:mi><mml:mi>x</mml:mi></mml:mrow></mml:msub></mml:math></alternatives></inline-formula>,
    an initial guess for the average length of sarcomeres
    <inline-formula><alternatives>
    <tex-math><![CDATA[l_{avg}]]></tex-math>
    <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:msub><mml:mi>l</mml:mi><mml:mrow><mml:mi>a</mml:mi><mml:mi>v</mml:mi><mml:mi>g</mml:mi></mml:mrow></mml:msub></mml:math></alternatives></inline-formula>,
    and three user-defined functions <inline-formula><alternatives>
    <tex-math><![CDATA[f_k]]></tex-math>
    <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:msub><mml:mi>f</mml:mi><mml:mi>k</mml:mi></mml:msub></mml:math></alternatives></inline-formula>.</p>
    <p>The scoring function is defined as:</p>
    <p><disp-formula><alternatives>
    <tex-math><![CDATA[ \mathcal{S}_i = \mathbb{1}_{l_i < l_{max}} \Big(\max_{j\in\{1,\dots,n_i\}} \big(c_1 \times f_1(\theta_{i,j}) + c_2 \times f_2(l_i, l_j)\big) + c_3 \times f_3(l_i, l_{avg})\Big) ]]></tex-math>
    <mml:math display="block" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:mrow><mml:msub><mml:mi>𝒮</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mn>𝟙</mml:mn><mml:mrow><mml:msub><mml:mi>l</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>&lt;</mml:mo><mml:msub><mml:mi>l</mml:mi><mml:mrow><mml:mi>m</mml:mi><mml:mi>a</mml:mi><mml:mi>x</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msub><mml:mo minsize="1.8" maxsize="1.8" stretchy="false" form="prefix">(</mml:mo><mml:munder><mml:mo>max</mml:mo><mml:mrow><mml:mi>j</mml:mi><mml:mo>∈</mml:mo><mml:mo stretchy="false" form="prefix">{</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mi>…</mml:mi><mml:mo>,</mml:mo><mml:msub><mml:mi>n</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo stretchy="false" form="postfix">}</mml:mo></mml:mrow></mml:munder><mml:mo minsize="1.2" maxsize="1.2" stretchy="false" form="prefix">(</mml:mo><mml:msub><mml:mi>c</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo>×</mml:mo><mml:msub><mml:mi>f</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mrow><mml:mo stretchy="true" form="prefix">(</mml:mo><mml:msub><mml:mi>θ</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="true" form="postfix">)</mml:mo></mml:mrow><mml:mo>+</mml:mo><mml:msub><mml:mi>c</mml:mi><mml:mn>2</mml:mn></mml:msub><mml:mo>×</mml:mo><mml:msub><mml:mi>f</mml:mi><mml:mn>2</mml:mn></mml:msub><mml:mrow><mml:mo stretchy="true" form="prefix">(</mml:mo><mml:msub><mml:mi>l</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>l</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mo stretchy="true" form="postfix">)</mml:mo></mml:mrow><mml:mo minsize="1.2" maxsize="1.2" stretchy="false" form="postfix">)</mml:mo><mml:mo>+</mml:mo><mml:msub><mml:mi>c</mml:mi><mml:mn>3</mml:mn></mml:msub><mml:mo>×</mml:mo><mml:msub><mml:mi>f</mml:mi><mml:mn>3</mml:mn></mml:msub><mml:mrow><mml:mo stretchy="true" form="prefix">(</mml:mo><mml:msub><mml:mi>l</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>l</mml:mi><mml:mrow><mml:mi>a</mml:mi><mml:mi>v</mml:mi><mml:mi>g</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="true" form="postfix">)</mml:mo></mml:mrow><mml:mo minsize="1.8" maxsize="1.8" stretchy="false" form="postfix">)</mml:mo></mml:mrow></mml:math></alternatives></disp-formula></p>
    <p>where <inline-formula><alternatives>
    <tex-math><![CDATA[n_i]]></tex-math>
    <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:msub><mml:mi>n</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:math></alternatives></inline-formula>
    is the number of edges connected to edge
    <inline-formula><alternatives>
    <tex-math><![CDATA[i]]></tex-math>
    <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:mi>i</mml:mi></mml:math></alternatives></inline-formula>
    and,</p>
    <p><disp-formula><alternatives>
    <tex-math><![CDATA[ f_1(\theta_{i,j}) = \mathbb{1}_{\theta_{i,j} \leq \pi/2} \big( 1 - \theta_{i,j} / (\pi/2) \big) ^ 2 ]]></tex-math>
    <mml:math display="block" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:mrow><mml:msub><mml:mi>f</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mrow><mml:mo stretchy="true" form="prefix">(</mml:mo><mml:msub><mml:mi>θ</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="true" form="postfix">)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:msub><mml:mn>𝟙</mml:mn><mml:mrow><mml:msub><mml:mi>θ</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>≤</mml:mo><mml:mi>π</mml:mi><mml:mi>/</mml:mi><mml:mn>2</mml:mn></mml:mrow></mml:msub><mml:mo minsize="1.2" maxsize="1.2" stretchy="false" form="prefix">(</mml:mo><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:msub><mml:mi>θ</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mi>/</mml:mi><mml:mrow><mml:mo stretchy="true" form="prefix">(</mml:mo><mml:mi>π</mml:mi><mml:mi>/</mml:mi><mml:mn>2</mml:mn><mml:mo stretchy="true" form="postfix">)</mml:mo></mml:mrow><mml:msup><mml:mo minsize="1.2" maxsize="1.2" stretchy="false" form="postfix">)</mml:mo><mml:mn>2</mml:mn></mml:msup></mml:mrow></mml:math></alternatives></disp-formula>
    <disp-formula><alternatives>
    <tex-math><![CDATA[ f_2(l_i, l_j) = (1 + |l_j - l_i| / l_i) ^ {-1} ]]></tex-math>
    <mml:math display="block" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:mrow><mml:msub><mml:mi>f</mml:mi><mml:mn>2</mml:mn></mml:msub><mml:mrow><mml:mo stretchy="true" form="prefix">(</mml:mo><mml:msub><mml:mi>l</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>l</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mo stretchy="true" form="postfix">)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:msup><mml:mrow><mml:mo stretchy="true" form="prefix">(</mml:mo><mml:mn>1</mml:mn><mml:mo>+</mml:mo><mml:mrow><mml:mo stretchy="true" form="prefix">|</mml:mo><mml:msub><mml:mi>l</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>l</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo stretchy="true" form="postfix">|</mml:mo></mml:mrow><mml:mi>/</mml:mi><mml:msub><mml:mi>l</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo stretchy="true" form="postfix">)</mml:mo></mml:mrow><mml:mrow><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msup></mml:mrow></mml:math></alternatives></disp-formula>
    <disp-formula><alternatives>
    <tex-math><![CDATA[ f_3(l_i) = e ^ {-\pi(1 - l_i / l_{avg}) ^ 2} ]]></tex-math>
    <mml:math display="block" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:mrow><mml:msub><mml:mi>f</mml:mi><mml:mn>3</mml:mn></mml:msub><mml:mrow><mml:mo stretchy="true" form="prefix">(</mml:mo><mml:msub><mml:mi>l</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo stretchy="true" form="postfix">)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:msup><mml:mi>e</mml:mi><mml:mrow><mml:mo>−</mml:mo><mml:mi>π</mml:mi><mml:msup><mml:mrow><mml:mo stretchy="true" form="prefix">(</mml:mo><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:msub><mml:mi>l</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mi>/</mml:mi><mml:msub><mml:mi>l</mml:mi><mml:mrow><mml:mi>a</mml:mi><mml:mi>v</mml:mi><mml:mi>g</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="true" form="postfix">)</mml:mo></mml:mrow><mml:mn>2</mml:mn></mml:msup></mml:mrow></mml:msup></mml:mrow></mml:math></alternatives></disp-formula></p>
    <p>and <inline-formula><alternatives>
    <tex-math><![CDATA[c_1]]></tex-math>
    <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:msub><mml:mi>c</mml:mi><mml:mn>1</mml:mn></mml:msub></mml:math></alternatives></inline-formula>,
    <inline-formula><alternatives>
    <tex-math><![CDATA[c_2]]></tex-math>
    <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:msub><mml:mi>c</mml:mi><mml:mn>2</mml:mn></mml:msub></mml:math></alternatives></inline-formula>,
    and <inline-formula><alternatives>
    <tex-math><![CDATA[c_3]]></tex-math>
    <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:msub><mml:mi>c</mml:mi><mml:mn>3</mml:mn></mml:msub></mml:math></alternatives></inline-formula>
    are user-defined constants that weigh the importance of each link
    feature. The default values of <inline-formula><alternatives>
    <tex-math><![CDATA[c_k]]></tex-math>
    <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:msub><mml:mi>c</mml:mi><mml:mi>k</mml:mi></mml:msub></mml:math></alternatives></inline-formula>
    and functions for <inline-formula><alternatives>
    <tex-math><![CDATA[f_k]]></tex-math>
    <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:msub><mml:mi>f</mml:mi><mml:mi>k</mml:mi></mml:msub></mml:math></alternatives></inline-formula>
    in SarcGraph were selected to produce accurate results on all of the
    samples that we tested (both real and synthetic data) without any
    example-specific parameter tuning. However, it is possible to
    customize these values and functions to suit different scenarios
    where the defaults may not perform optimally. In future development
    of SarcGraph, automated parameter tuning will be implemented as
    needed.</p>
    <p>To prune this spatial graph to retain the most probable
    candidates for actual sarcomeres, we adhere to four rules: (1) each
    node can maintain a maximum of two edges (reflecting the biological
    reality that a z-disc is typically part of two sarcomeres), (2) all
    remaining edges must exceed a threshold score,
    <inline-formula><alternatives>
    <tex-math><![CDATA[s_{max}]]></tex-math>
    <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:msub><mml:mi>s</mml:mi><mml:mrow><mml:mi>m</mml:mi><mml:mi>a</mml:mi><mml:mi>x</mml:mi></mml:mrow></mml:msub></mml:math></alternatives></inline-formula>
    (to discard low-probability potential sarcomeres), (3) for nodes
    with two remaining edges, the angle between them must surpass a
    threshold, <inline-formula><alternatives>
    <tex-math><![CDATA[\theta_{max}]]></tex-math>
    <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:msub><mml:mi>θ</mml:mi><mml:mrow><mml:mi>m</mml:mi><mml:mi>a</mml:mi><mml:mi>x</mml:mi></mml:mrow></mml:msub></mml:math></alternatives></inline-formula>
    (which prevents predicted myofibrils from having unrealistic kinked
    structure), and (4) the retained edges at a node should be those
    with the highest scores that comply with the first three rules
    (preserving only the potential sarcomeres that are the most likely
    to be valid). The new algorithm offers improved effectiveness and
    flexibility over the previous method and is a key component of the
    new SarcGraph package’s sarcomere detection capabilities.</p>
    <fig>
      <caption><p>In the initial graph (left) the edges show the
      potential sarcomeres. After scoring and pruning, the remaining
      edges that represent the detected sarcomeres are shown in blue
      lines in the pruned graph (right). The edges that were deleted
      during pruning are shown in red dashed
      lines.<styled-content id="figU003Aappendix"></styled-content></p></caption>
      <graphic mimetype="image" mime-subtype="png" xlink:href="media/figures/appendix.png" />
    </fig>
  </sec>
</sec>
<sec id="instructions-to-reproduce-the-results-shown-in-this-paper">
  <title>Instructions to Reproduce the Results Shown in this
  Paper</title>
  <p>In this Appendix, we present the code snippets used to generate the
  figures in the main text. It should be noted that some minor aesthetic
  adjustments have been made to the figures after their initial
  generation using these snippets in order to enhance their visual
  clarity and presentation quality within the paper (e.g., moving
  legends or changing titles).</p>
  <graphic mimetype="image" mime-subtype="png" xlink:href="media/figures/snippet1.png" />
  <graphic mimetype="image" mime-subtype="png" xlink:href="media/figures/snippet2.png" />
  <graphic mimetype="image" mime-subtype="png" xlink:href="media/figures/snippet3.png" />
</sec>
</body>
<back>
<ref-list>
  <ref id="ref-who_cvd_fs">
    <element-citation>
      <person-group person-group-type="author">
        <string-name>World Health Organization</string-name>
      </person-group>
      <article-title>Cardiovascular diseases (CVDs) fact sheet</article-title>
      <publisher-name>https://www.who.int/news-room/fact-sheets/detail/cardiovascular-diseases-(cvds)</publisher-name>
    </element-citation>
  </ref>
  <ref id="ref-morris2020striated">
    <element-citation publication-type="article-journal">
      <person-group person-group-type="author">
        <name><surname>Morris</surname><given-names>Tessa Altair</given-names></name>
        <name><surname>Naik</surname><given-names>Jasmine</given-names></name>
        <name><surname>Fibben</surname><given-names>Kirby Sinclair</given-names></name>
        <name><surname>Kong</surname><given-names>Xiangduo</given-names></name>
        <name><surname>Kiyono</surname><given-names>Tohru</given-names></name>
        <name><surname>Yokomori</surname><given-names>Kyoko</given-names></name>
        <name><surname>Grosberg</surname><given-names>Anna</given-names></name>
      </person-group>
      <article-title>Striated myocyte structural integrity: Automated analysis of sarcomeric z-discs</article-title>
      <source>PLoS computational biology</source>
      <publisher-name>Public Library of Science San Francisco, CA USA</publisher-name>
      <year iso-8601-date="2020">2020</year>
      <volume>16</volume>
      <issue>3</issue>
      <pub-id pub-id-type="doi">10.1371/journal.pcbi.1007676</pub-id>
      <fpage>e1007676</fpage>
      <lpage></lpage>
    </element-citation>
  </ref>
  <ref id="ref-sutcliffe2018high">
    <element-citation publication-type="article-journal">
      <person-group person-group-type="author">
        <name><surname>Sutcliffe</surname><given-names>Matthew D</given-names></name>
        <name><surname>Tan</surname><given-names>Philip M</given-names></name>
        <name><surname>Fernandez-Perez</surname><given-names>Antonio</given-names></name>
        <name><surname>Nam</surname><given-names>Young-Jae</given-names></name>
        <name><surname>Munshi</surname><given-names>Nikhil V</given-names></name>
        <name><surname>Saucerman</surname><given-names>Jeffrey J</given-names></name>
      </person-group>
      <article-title>High content analysis identifies unique morphological features of reprogrammed cardiomyocytes</article-title>
      <source>Scientific reports</source>
      <publisher-name>Nature Publishing Group UK London</publisher-name>
      <year iso-8601-date="2018">2018</year>
      <volume>8</volume>
      <issue>1</issue>
      <pub-id pub-id-type="doi">10.1038/s41598-018-19539-z</pub-id>
      <fpage>1258</fpage>
      <lpage></lpage>
    </element-citation>
  </ref>
  <ref id="ref-pasqualini2015structural">
    <element-citation publication-type="article-journal">
      <person-group person-group-type="author">
        <name><surname>Pasqualini</surname><given-names>Francesco Silvio</given-names></name>
        <name><surname>Sheehy</surname><given-names>Sean Paul</given-names></name>
        <name><surname>Agarwal</surname><given-names>Ashutosh</given-names></name>
        <name><surname>Aratyn-Schaus</surname><given-names>Yvonne</given-names></name>
        <name><surname>Parker</surname><given-names>Kevin Kit</given-names></name>
      </person-group>
      <article-title>Structural phenotyping of stem cell-derived cardiomyocytes</article-title>
      <source>Stem cell reports</source>
      <publisher-name>Elsevier</publisher-name>
      <year iso-8601-date="2015">2015</year>
      <volume>4</volume>
      <issue>3</issue>
      <pub-id pub-id-type="doi">10.1016/j.stemcr.2015.01.020</pub-id>
      <fpage>340</fpage>
      <lpage>347</lpage>
    </element-citation>
  </ref>
  <ref id="ref-doiU003A10.1161U002FCIRCRESAHA.116.310363">
    <element-citation publication-type="article-journal">
      <person-group person-group-type="author">
        <name><surname>Ribeiro</surname><given-names>Alexandre J. S.</given-names></name>
        <name><surname>Schwab</surname><given-names>Olivier</given-names></name>
        <name><surname>Mandegar</surname><given-names>Mohammad A.</given-names></name>
        <name><surname>Ang</surname><given-names>Yen-Sin</given-names></name>
        <name><surname>Conklin</surname><given-names>Bruce R.</given-names></name>
        <name><surname>Srivastava</surname><given-names>Deepak</given-names></name>
        <name><surname>Pruitt</surname><given-names>Beth L.</given-names></name>
      </person-group>
      <article-title>Multi-imaging method to assay the contractile mechanical output of micropatterned human iPSC-derived cardiac myocytes</article-title>
      <source>Circulation Research</source>
      <year iso-8601-date="2017">2017</year>
      <volume>120</volume>
      <issue>10</issue>
      <uri>https://www.ahajournals.org/doi/abs/10.1161/CIRCRESAHA.116.310363</uri>
      <pub-id pub-id-type="doi">10.1161/CIRCRESAHA.116.310363</pub-id>
      <fpage>1572</fpage>
      <lpage>1583</lpage>
    </element-citation>
  </ref>
  <ref id="ref-pasqualin2016sarcoptim">
    <element-citation publication-type="article-journal">
      <person-group person-group-type="author">
        <name><surname>Pasqualin</surname><given-names>Côme</given-names></name>
        <name><surname>Gannier</surname><given-names>François</given-names></name>
        <name><surname>Yu</surname><given-names>Angèle</given-names></name>
        <name><surname>Malécot</surname><given-names>Claire O</given-names></name>
        <name><surname>Bredeloux</surname><given-names>Pierre</given-names></name>
        <name><surname>Maupoil</surname><given-names>Véronique</given-names></name>
      </person-group>
      <article-title>SarcOptiM for ImageJ: High-frequency online sarcomere length computing on stimulated cardiomyocytes</article-title>
      <source>American Journal of Physiology-Cell Physiology</source>
      <publisher-name>American Physiological Society Bethesda, MD</publisher-name>
      <year iso-8601-date="2016">2016</year>
      <volume>311</volume>
      <issue>2</issue>
      <pub-id pub-id-type="doi">10.1152/ajpcell.00094.2016</pub-id>
      <fpage>C277</fpage>
      <lpage>C283</lpage>
    </element-citation>
  </ref>
  <ref id="ref-TELLEY2006514">
    <element-citation publication-type="article-journal">
      <person-group person-group-type="author">
        <name><surname>Telley</surname><given-names>Ivo A.</given-names></name>
        <name><surname>Denoth</surname><given-names>Jachen</given-names></name>
        <name><surname>Stüssi</surname><given-names>Edgar</given-names></name>
        <name><surname>Pfitzer</surname><given-names>Gabriele</given-names></name>
        <name><surname>Stehle</surname><given-names>Robert</given-names></name>
      </person-group>
      <article-title>Half-sarcomere dynamics in myofibrils during activation and relaxation studied by tracking fluorescent markers</article-title>
      <source>Biophysical Journal</source>
      <year iso-8601-date="2006">2006</year>
      <volume>90</volume>
      <issue>2</issue>
      <issn>0006-3495</issn>
      <uri>https://www.sciencedirect.com/science/article/pii/S0006349506722317</uri>
      <pub-id pub-id-type="doi">10.1152/ajpcell.00094.2016</pub-id>
      <fpage>514</fpage>
      <lpage>530</lpage>
    </element-citation>
  </ref>
  <ref id="ref-toepfer2019sarctrack">
    <element-citation publication-type="article-journal">
      <person-group person-group-type="author">
        <name><surname>Toepfer</surname><given-names>Christopher N</given-names></name>
        <name><surname>Sharma</surname><given-names>Arun</given-names></name>
        <name><surname>Cicconet</surname><given-names>Marcelo</given-names></name>
        <name><surname>Garfinkel</surname><given-names>Amanda C</given-names></name>
        <name><surname>Mücke</surname><given-names>Michael</given-names></name>
        <name><surname>Neyazi</surname><given-names>Meraj</given-names></name>
        <name><surname>Willcox</surname><given-names>Jon AL</given-names></name>
        <name><surname>Agarwal</surname><given-names>Radhika</given-names></name>
        <name><surname>Schmid</surname><given-names>Manuel</given-names></name>
        <name><surname>Rao</surname><given-names>Jyoti</given-names></name>
        <name><surname>others</surname></name>
      </person-group>
      <article-title>SarcTrack: An adaptable software tool for efficient large-scale analysis of sarcomere function in hiPSC-cardiomyocytes</article-title>
      <source>Circulation research</source>
      <publisher-name>Am Heart Assoc</publisher-name>
      <year iso-8601-date="2019">2019</year>
      <volume>124</volume>
      <issue>8</issue>
      <pub-id pub-id-type="doi">10.1161/CIRCRESAHA.118.314505</pub-id>
      <fpage>1172</fpage>
      <lpage>1183</lpage>
    </element-citation>
  </ref>
  <ref id="ref-zhao2021sarc">
    <element-citation publication-type="article-journal">
      <person-group person-group-type="author">
        <name><surname>Zhao</surname><given-names>Bill</given-names></name>
        <name><surname>Zhang</surname><given-names>Kehan</given-names></name>
        <name><surname>Chen</surname><given-names>Christopher S</given-names></name>
        <name><surname>Lejeune</surname><given-names>Emma</given-names></name>
      </person-group>
      <article-title>Sarc-graph: Automated segmentation, tracking, and analysis of sarcomeres in hiPSC-derived cardiomyocytes</article-title>
      <source>PLoS Computational Biology</source>
      <publisher-name>Public Library of Science San Francisco, CA USA</publisher-name>
      <year iso-8601-date="2021">2021</year>
      <volume>17</volume>
      <issue>10</issue>
      <pub-id pub-id-type="doi">10.1371/journal.pcbi.1009443</pub-id>
      <fpage>e1009443</fpage>
      <lpage></lpage>
    </element-citation>
  </ref>
  <ref id="ref-allan_daniel_b_2023_7670439">
    <element-citation publication-type="software">
      <person-group person-group-type="author">
        <name><surname>Allan</surname><given-names>Daniel B.</given-names></name>
        <name><surname>Caswell</surname><given-names>Thomas</given-names></name>
        <name><surname>Keim</surname><given-names>Nathan C.</given-names></name>
        <name><surname>Wel</surname><given-names>Casper M. van der</given-names></name>
        <name><surname>Verweij</surname><given-names>Ruben W.</given-names></name>
      </person-group>
      <article-title>Soft-matter/trackpy: v0.6.1</article-title>
      <publisher-name>Zenodo</publisher-name>
      <year iso-8601-date="2023-02">2023</year><month>02</month>
      <uri>https://doi.org/10.5281/zenodo.7670439</uri>
      <pub-id pub-id-type="doi">10.5281/zenodo.7670439</pub-id>
    </element-citation>
  </ref>
  <ref id="ref-gerbin2021cell">
    <element-citation publication-type="article-journal">
      <person-group person-group-type="author">
        <name><surname>Gerbin</surname><given-names>Kaytlyn A</given-names></name>
        <name><surname>Grancharova</surname><given-names>Tanya</given-names></name>
        <name><surname>Donovan-Maiye</surname><given-names>Rory M</given-names></name>
        <name><surname>Hendershott</surname><given-names>Melissa C</given-names></name>
        <name><surname>Anderson</surname><given-names>Helen G</given-names></name>
        <name><surname>Brown</surname><given-names>Jackson M</given-names></name>
        <name><surname>Chen</surname><given-names>Jianxu</given-names></name>
        <name><surname>Dinh</surname><given-names>Stephanie Q</given-names></name>
        <name><surname>Gehring</surname><given-names>Jamie L</given-names></name>
        <name><surname>Johnson</surname><given-names>Gregory R</given-names></name>
        <name><surname>others</surname></name>
      </person-group>
      <article-title>Cell states beyond transcriptomics: Integrating structural organization and gene expression in hiPSC-derived cardiomyocytes</article-title>
      <source>Cell Systems</source>
      <publisher-name>Elsevier</publisher-name>
      <year iso-8601-date="2021">2021</year>
      <volume>12</volume>
      <issue>6</issue>
      <pub-id pub-id-type="doi">10.1016/j.cels.2021.05.001</pub-id>
      <fpage>670</fpage>
      <lpage>687</lpage>
    </element-citation>
  </ref>
</ref-list>
<fn-group>
  <fn id="fn1">
    <label>1</label><p>We performed the analysis of all movie samples
    using a Dell XPS desktop computer running Windows 11, with a 2.9 GHz
    9-Core Intel Core i7 processor and 16 GB of RAM.</p>
  </fn>
</fn-group>
</back>
</article>
