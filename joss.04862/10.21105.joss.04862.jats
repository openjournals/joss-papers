<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE article PUBLIC "-//NLM//DTD JATS (Z39.96) Journal Publishing DTD v1.2 20190208//EN"
                  "JATS-publishing1.dtd">
<article xmlns:mml="http://www.w3.org/1998/Math/MathML" xmlns:xlink="http://www.w3.org/1999/xlink" dtd-version="1.2" article-type="other">
<front>
<journal-meta>
<journal-id></journal-id>
<journal-title-group>
<journal-title>Journal of Open Source Software</journal-title>
<abbrev-journal-title>JOSS</abbrev-journal-title>
</journal-title-group>
<issn publication-format="electronic">2475-9066</issn>
<publisher>
<publisher-name>Open Journals</publisher-name>
</publisher>
</journal-meta>
<article-meta>
<article-id pub-id-type="publisher-id">4862</article-id>
<article-id pub-id-type="doi">10.21105/joss.04862</article-id>
<title-group>
<article-title>APAV: An Open-Source Python Package for Mass Spectrum
Analysis in Atom Probe Tomography</article-title>
</title-group>
<contrib-group>
<contrib contrib-type="author" corresp="yes">
<contrib-id contrib-id-type="orcid">https://orcid.org/0000-0001-7402-6658</contrib-id>
<name>
<surname>Smith</surname>
<given-names>Jesse D.</given-names>
</name>
<xref ref-type="aff" rid="aff-1"/>
<xref ref-type="corresp" rid="cor-1"><sup>*</sup></xref>
</contrib>
<contrib contrib-type="author">
<contrib-id contrib-id-type="orcid">https://orcid.org/0000-0002-4953-5562</contrib-id>
<name>
<surname>Young</surname>
<given-names>Marcus L.</given-names>
</name>
<xref ref-type="aff" rid="aff-1"/>
</contrib>
<aff id="aff-1">
<institution-wrap>
<institution>Department of Materials Science and Engineering, University
of North Texas, United States of America</institution>
</institution-wrap>
</aff>
</contrib-group>
<author-notes>
<corresp id="cor-1">* E-mail: <email></email></corresp>
</author-notes>
<pub-date date-type="pub" publication-format="electronic" iso-8601-date="2022-06-03">
<day>3</day>
<month>6</month>
<year>2022</year>
</pub-date>
<volume>8</volume>
<issue>83</issue>
<fpage>4862</fpage>
<permissions>
<copyright-statement>Authors of papers retain copyright and release the
work under a Creative Commons Attribution 4.0 International License (CC
BY 4.0)</copyright-statement>
<copyright-year>2022</copyright-year>
<copyright-holder>The article authors</copyright-holder>
<license license-type="open-access" xlink:href="https://creativecommons.org/licenses/by/4.0/">
<license-p>Authors of papers retain copyright and release the work under
a Creative Commons Attribution 4.0 International License (CC BY
4.0)</license-p>
</license>
</permissions>
<kwd-group kwd-group-type="author">
<kwd>Python</kwd>
<kwd>Atom Probe Tomography</kwd>
<kwd>Data analysis</kwd>
</kwd-group>
</article-meta>
</front>
<body>
<sec id="summary">
  <title>Summary</title>
  <p>As microstructures are increasingly engineered with nanoscale
  precision, comparably precise metrological tools like Atom Probe
  Tomography (APT) are crucial for experimental validation. APT has the
  unique capability of 3D imaging and compositional/isotopic analysis at
  the sub-nanometer scale
  (<xref alt="Gault et al., 2021" rid="ref-gault_review" ref-type="bibr">Gault
  et al., 2021</xref>). However, the informative potential of APT is
  hindered by nebulous, material-dependent evaporation physics,
  naturally complex data analysis/visualization, and the
  standards/specifications set by vendors. Transparent and accessible
  data analysis tools are critical for reproducible analysis of APT
  experiments. APAV seeks to bridge the gap of openly accessible
  analysis tools available to scientists leveraging APT in their
  research.</p>
</sec>
<sec id="statement-of-need">
  <title>Statement of need</title>
  <p>APAV is a Python package for analysis and visualization of APT
  experiments, with a focus on mass spectrum analysis and detector
  multiple events. APAV supplies an object-oriented interface into
  common positional and ranged file formats, forming the foundation from
  which APAV or user-adapted analysis can be extended. Commercial
  applications dominate the field and are limited to IVAS and its
  successor: AP Suite. Both IVAS and AP Suite are developed by the sole
  commercial vendor of Local Electrode Atom Probes (LEAP). Generalized
  lists of open-source contributions may be found
  online<xref ref-type="fn" rid="fn1">1</xref>, in addition to a
  collection of software-oriented journal articles
  (<xref alt="Felfer et al., 2013" rid="ref-atomva" ref-type="bibr">Felfer
  et al., 2013</xref>;
  <xref alt="Kühbach et al., 2021" rid="ref-paraprobe" ref-type="bibr">Kühbach
  et al., 2021</xref>;
  <xref alt="Monajem &amp; Felfer, 2022" rid="ref-apt_control" ref-type="bibr">Monajem
  &amp; Felfer, 2022</xref>). APAV aims to improve the general coverage
  of APT tools in the Python space while specifically targeting the
  analysis of mass spectra.</p>
  <p>Python is a popular language in both general and specialized
  computing domains, partly owing to its comprehensive centralized
  package management (PyPI and Conda), openness, and reputed ease of
  use. Such qualities have helped to ingrain Python into the greater
  academic community, forming our belief that the development of APT
  tools for Python should be pursued. Though native Python is slow, APAV
  uses widely accepted scientific packages for numerical acceleration
  (i.e., Numpy, fast-histogram, etc.), custom C extensions for
  performance-critical computations, and Qt for graphical interactive
  tools. It is sustained by a suite of unit tests, continuous
  integration, git version control, documentation, and is easily
  acquirable through the Python package index (PyPI).</p>
</sec>
<sec id="inputoutput">
  <title>Input/output</title>
  <p>Historically, post-reconstruction APT data is stored in two files:
  one file tabulating ion positions and the instantaneous experimental
  state (henceforth referred to as “positional” files or data), and
  another file mapping user-specified ion compositions to half-open
  intervals in the mass/charge domain (henceforth referred to as
  “ranging” files or data). For best interoperability, APAV does not
  introduce new file formats, instead supporting the major file formats:
  *.pos (position), *.epos (extended position), *.ato (atom), *.apt
  (atom probe tomography), *.rng (range), and *.rrng (range). A summary
  of the positional formats and their content is tabulated in
  <xref alt="Table 1" rid="tableU003Afiles">Table 1</xref> with further
  details in literature
  (<xref alt="Gault et al., 2012" rid="ref-gault_book_2012" ref-type="bibr">Gault
  et al., 2012</xref>;
  <xref alt="Larson et al., 2013" rid="ref-Larson2013" ref-type="bibr">Larson
  et al., 2013</xref>). APAV does not implement readers or writers for
  pre-reconstruction data formats (*.rhit, *.rraw, *.hits, *.str, etc.)
  as these files are proprietary binary formats.</p>
  <table-wrap>
    <caption>
      <p>Positional file formats with ion positions and state variables.
      Field inclusion is indicated by <inline-formula><alternatives>
      <tex-math><![CDATA[\times]]></tex-math>
      <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:mo>×</mml:mo></mml:math></alternatives></inline-formula>
      for included, empty for not included, and
      <inline-formula><alternatives>
      <tex-math><![CDATA[\circ]]></tex-math>
      <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:mo>∘</mml:mo></mml:math></alternatives></inline-formula>
      for conditionally included.
      <styled-content id="tableU003Afiles"></styled-content></p>
    </caption>
    <table>
      <colgroup>
        <col width="19%" />
        <col width="8%" />
        <col width="8%" />
        <col width="13%" />
        <col width="13%" />
        <col width="23%" />
        <col width="16%" />
      </colgroup>
      <thead>
        <tr>
          <th align="center">Format</th>
          <th align="center">XYZ</th>
          <th align="center">m/n</th>
          <th align="center">TOF</th>
          <th align="center">DME</th>
          <th align="center">DC/Pulse volts</th>
          <th align="center">Det pos.</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td align="center">POS</td>
          <td align="center">×</td>
          <td align="center">×</td>
          <td align="center"><inline-formula><alternatives>
          <tex-math><![CDATA[~]]></tex-math>
          <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:mspace width="0.222em"></mml:mspace></mml:math></alternatives></inline-formula></td>
          <td align="center"><inline-formula><alternatives>
          <tex-math><![CDATA[~]]></tex-math>
          <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:mspace width="0.222em"></mml:mspace></mml:math></alternatives></inline-formula></td>
          <td align="center"><inline-formula><alternatives>
          <tex-math><![CDATA[~]]></tex-math>
          <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:mspace width="0.222em"></mml:mspace></mml:math></alternatives></inline-formula></td>
          <td align="center"><inline-formula><alternatives>
          <tex-math><![CDATA[~]]></tex-math>
          <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:mspace width="0.222em"></mml:mspace></mml:math></alternatives></inline-formula></td>
        </tr>
        <tr>
          <td align="center">ePOS</td>
          <td align="center">×</td>
          <td align="center">×</td>
          <td align="center">×</td>
          <td align="center">×</td>
          <td align="center">×</td>
          <td align="center">×</td>
        </tr>
        <tr>
          <td align="center">ATO</td>
          <td align="center">×</td>
          <td align="center">×</td>
          <td align="center">×</td>
          <td align="center"><inline-formula><alternatives>
          <tex-math><![CDATA[~]]></tex-math>
          <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:mspace width="0.222em"></mml:mspace></mml:math></alternatives></inline-formula></td>
          <td align="center">×</td>
          <td align="center">×</td>
        </tr>
        <tr>
          <td align="center">APT</td>
          <td align="center">×</td>
          <td align="center">×</td>
          <td align="center"><inline-formula><alternatives>
          <tex-math><![CDATA[\circ]]></tex-math>
          <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:mo>∘</mml:mo></mml:math></alternatives></inline-formula></td>
          <td align="center"><inline-formula><alternatives>
          <tex-math><![CDATA[\circ]]></tex-math>
          <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:mo>∘</mml:mo></mml:math></alternatives></inline-formula></td>
          <td align="center"><inline-formula><alternatives>
          <tex-math><![CDATA[\circ]]></tex-math>
          <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:mo>∘</mml:mo></mml:math></alternatives></inline-formula></td>
          <td align="center"><inline-formula><alternatives>
          <tex-math><![CDATA[\circ]]></tex-math>
          <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:mo>∘</mml:mo></mml:math></alternatives></inline-formula></td>
        </tr>
      </tbody>
    </table>
  </table-wrap>
  <p>Positional data is stored in an <monospace>apav.Roi</monospace>
  container and is the primary data structure used for constructing
  other analysis objects. Readers and writers are accessed through its
  class methods <monospace>Roi.from_XXX</monospace> and
  <monospace>Roi.to_XXX</monospace> or convenience loading functions
  <monospace>apav.load_XXX</monospace> in the top-level namespace. It is
  worth noting that the *.apt format is a new file introduced by Cameca
  in AP Suite and is the only dynamic positional format that can contain
  an arbitrary number of fields. Details of the *.apt format
  specification can be found in the B.5.4 appendix (version 6.1) of the
  AP Suite Software User Guide, other formats are well summarized by
  Larson et al.
  (<xref alt="2013" rid="ref-Larson2013" ref-type="bibr">2013</xref>) in
  appendix A. The ranging formats are stored in a
  <monospace>apav.RangeCollection</monospace> containers loaded by
  <monospace>RangeCollection.from_XXX</monospace> class methods (or
  <monospace>apav.load_XXX</monospace> convenience functions).</p>
</sec>
<sec id="detector-multiple-events-dme">
  <title>Detector multiple events (DME)</title>
  <p>Detector events can be partially characterized by a “multiplicity”
  defining the number of ions that the position sensitive detector (PSD)
  was able to resolve during a detection cycle (the time spanning two
  consecutive pulses). Ideally, all detector events would be “single”,
  indicating a single ion was detected during the cycle. However, with
  increasingly nonmetallic bonding, the applied field can penetrate
  multiple atomic layers (due to weak electric-field screening
  (<xref alt="Tamura et al., 2012" rid="ref-Tamura2012" ref-type="bibr">Tamura
  et al., 2012</xref>)), resulting in both increased molecular
  evaporation, and the evaporation of multiple ions—a detector multiple
  event (DME). Analyzing the effect of DMEs is complex, too many ions
  reaching the PSD in quick succession (dead times are ~3ns) may result
  in data loss. Similarly, neutral ions produced by molecular
  dissociation are predominantly undetected.</p>
  <fig>
    <caption><p>DME correlation histogram of a GdBa2Cu3O7-x
    superconductor with important physical phenomena annotated:
    co-evaporation (blue), thermally delayed evaporation (red),
    molecular dissociation (green), neutral generation (purple), and
    kinetic energy release (lobe, yellow).
    <styled-content id="figU003Acorr_hist"></styled-content></p></caption>
    <graphic mimetype="image" mime-subtype="png" xlink:href="media/corr_window.png" />
  </fig>
  <p>For example, a DME of four ions “ABCD” (multiplicity of four) can
  be expressed as six unique pairs (AB, AC, AD, BC, BD, CD). Pairing
  DMEs in this fashion enables analysis through correlation histograms
  (<xref alt="Saxey, 2011" rid="ref-Saxey2011" ref-type="bibr">Saxey,
  2011</xref>), where the first ion is placed on the abscissa and the
  second on the ordinate. In APAV DME information can be accessed
  through <monospace>MultipleEventExtractor</monospace> that interfaces
  with a <monospace>Roi</monospace>—assuming the DME information exists
  (see <xref alt="Table 1" rid="tableU003Afiles">Table 1</xref>). An
  example of the interactive correlation histogram tool is shown in
  <xref alt="[fig:corr_hist]" rid="figU003Acorr_hist">[fig:corr_hist]</xref>
  for a complex oxide superconductor; this particular correlation
  histogram exhibits all currently known physical phenomena in a
  correlation histogram (see Smith et al.
  (<xref alt="2021" rid="ref-Smith2021" ref-type="bibr">2021</xref>) for
  details).</p>
</sec>
<sec id="mass-spectrum-quantification">
  <title>Mass spectrum quantification</title>
  <p>Mass spectrum quantification principally seeks to compute the
  elemental (or molecular) composition of some region of interest in the
  APT dataset. Conventionally, this is achieved by accumulating the
  number of each experimentally observed ion by segmentation of the mass
  spectrum into explicit bins (which can be optionally background
  corrected). The composition is typically expressed in terms of the
  <italic>decomposed</italic> atomic concentration, but the ionic
  concentration is occasionally used. APAV supports three levels of
  quantification, differentiated by the level background correction: 1)
  No correction, 2) Random noise background correction, and 3) Random +
  local background correction. Conventionally, the background shape is
  sufficiently described by a power law,</p>
  <p><disp-formula><alternatives>
  <tex-math><![CDATA[I(x)=A(x-x_0)^{-B}]]></tex-math>
  <mml:math display="block" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:mrow><mml:mi>I</mml:mi><mml:mrow><mml:mo stretchy="true" form="prefix">(</mml:mo><mml:mi>x</mml:mi><mml:mo stretchy="true" form="postfix">)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mi>A</mml:mi><mml:msup><mml:mrow><mml:mo stretchy="true" form="prefix">(</mml:mo><mml:mi>x</mml:mi><mml:mo>−</mml:mo><mml:msub><mml:mi>x</mml:mi><mml:mn>0</mml:mn></mml:msub><mml:mo stretchy="true" form="postfix">)</mml:mo></mml:mrow><mml:mrow><mml:mo>−</mml:mo><mml:mi>B</mml:mi></mml:mrow></mml:msup></mml:mrow></mml:math></alternatives></disp-formula></p>
  <p>which is the default model used in APAV. Quantification in APAV was
  designed to be as flexible as possible, as the model selection and
  setup for one experiment may not apply to another. Further, any
  <monospace>Model</monospace> from <monospace>lmfit</monospace>
  (<xref alt="Newville et al., 2021" rid="ref-lmfit" ref-type="bibr">Newville
  et al., 2021</xref>) can be used (within reason) in addition to custom
  defined models. The automated background estimation in AP Suite and
  IVAS are prone to failure for complex spectra with many peaks, with no
  recourse available. APAV provides a flexible syntax for declaring
  multiple intervals for fit ranges and ion selections as needed.</p>
  <fig>
    <caption><p>Ranged mass spectrum quantification with random noise
    and local background correction.
    <styled-content id="figU003Aranged_mass"></styled-content></p></caption>
    <graphic mimetype="image" mime-subtype="png" xlink:href="media/ranged_mass.png" />
  </fig>
  <p>For nonmetals, certain isotopes may be sensitive to DMEs, such that
  they are not detected in isolation. See
  <xref alt="[fig:dme_hists]" rid="figU003Adme_hists">[fig:dme_hists]</xref>
  for an example of DME-dependent mass spectra, generated through APAV.
  In these situations, it may be prudent to quantify single events
  separately from multiple events (DMEs)
  (<xref alt="Yao et al., 2010" rid="ref-Yao2010" ref-type="bibr">Yao et
  al., 2010</xref>). APAV can flexibly accommodate quantification based
  on DME multiplicity, with most constructors taking an optional
  <monospace>multiplicity</monospace> argument for controlling the
  multiplicity parameterization.</p>
  <fig>
    <caption><p>Mass spectra of the first 10 DME multiplicities of a
    nonmetallic specimen, showing DME-dependent phenomena.
    <styled-content id="figU003Adme_hists"></styled-content></p></caption>
    <graphic mimetype="image" mime-subtype="png" xlink:href="media/dme_hists.png" />
  </fig>
</sec>
<sec id="delocalization-and-the-spatial-compositional-domain">
  <title>Delocalization and the spatial-compositional domain</title>
  <p>APT is often considered to exhibit atomic resolution, however, this
  truly depends on the specimen, acquisition parameters, and the exposed
  surface crystallography. Nevertheless, spatial analysis is structured
  in terms of the point cloud, or a structured compositional grid.
  Construction of the compositional grid is non-trivial as the initial
  dataset is discretized as a list of coordinates, and each coordinate
  does not necessarily represent a singular elemental ion. The
  compositional grid is initialized by the delocalization of each ion
  into discrete bins using a chosen transfer function, which is then
  smoothed (typically using a Gaussian kernel). This smoothing is
  applied to mitigate aliasing artifacts possibly introduced by the
  grid-based sampling process of the ion distribution (and is not
  related the detection process itself). The amount of delocalization is
  defined by a specified length for each axis; i.e.,
  <inline-formula><alternatives>
  <tex-math><![CDATA[d_x]]></tex-math>
  <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:msub><mml:mi>d</mml:mi><mml:mi>x</mml:mi></mml:msub></mml:math></alternatives></inline-formula>
  is the delocalization distance in the x-axis, which expresses the
  <inline-formula><alternatives>
  <tex-math><![CDATA[3\sigma]]></tex-math>
  <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:mrow><mml:mn>3</mml:mn><mml:mi>σ</mml:mi></mml:mrow></mml:math></alternatives></inline-formula>
  (three standard deviations) spatial distance that each ion is “spread”
  along this axis. The delocalization <inline-formula><alternatives>
  <tex-math><![CDATA[d_x]]></tex-math>
  <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:msub><mml:mi>d</mml:mi><mml:mi>x</mml:mi></mml:msub></mml:math></alternatives></inline-formula>
  constrains the standard deviations of both steps, such that they are
  added in quadrature: <inline-formula><alternatives>
  <tex-math><![CDATA[d_x=\sqrt{(3\sigma_{x1})^2 + (3\sigma_{x2})^2}]]></tex-math>
  <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:mrow><mml:msub><mml:mi>d</mml:mi><mml:mi>x</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:msqrt><mml:mrow><mml:msup><mml:mrow><mml:mo stretchy="true" form="prefix">(</mml:mo><mml:mn>3</mml:mn><mml:msub><mml:mi>σ</mml:mi><mml:mrow><mml:mi>x</mml:mi><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo stretchy="true" form="postfix">)</mml:mo></mml:mrow><mml:mn>2</mml:mn></mml:msup><mml:mo>+</mml:mo><mml:msup><mml:mrow><mml:mo stretchy="true" form="prefix">(</mml:mo><mml:mn>3</mml:mn><mml:msub><mml:mi>σ</mml:mi><mml:mrow><mml:mi>x</mml:mi><mml:mn>2</mml:mn></mml:mrow></mml:msub><mml:mo stretchy="true" form="postfix">)</mml:mo></mml:mrow><mml:mn>2</mml:mn></mml:msup></mml:mrow></mml:msqrt></mml:mrow></mml:math></alternatives></inline-formula>,
  where <inline-formula><alternatives>
  <tex-math><![CDATA[\sigma_{x1}]]></tex-math>
  <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:msub><mml:mi>σ</mml:mi><mml:mrow><mml:mi>x</mml:mi><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:math></alternatives></inline-formula>
  and <inline-formula><alternatives>
  <tex-math><![CDATA[\sigma_{x2}]]></tex-math>
  <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:msub><mml:mi>σ</mml:mi><mml:mrow><mml:mi>x</mml:mi><mml:mn>2</mml:mn></mml:mrow></mml:msub></mml:math></alternatives></inline-formula>
  are the standard deviations of the 1st and 2nd pass stages,
  respectively. The delocalization distances
  <inline-formula><alternatives>
  <tex-math><![CDATA[(d_x, d_y, d_z)]]></tex-math>
  <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:mrow><mml:mo stretchy="true" form="prefix">(</mml:mo><mml:msub><mml:mi>d</mml:mi><mml:mi>x</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>d</mml:mi><mml:mi>y</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>d</mml:mi><mml:mi>z</mml:mi></mml:msub><mml:mo stretchy="true" form="postfix">)</mml:mo></mml:mrow></mml:math></alternatives></inline-formula>
  are user-provided, but default to <inline-formula><alternatives>
  <tex-math><![CDATA[3\times 3\times 1.5]]></tex-math>
  <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:mrow><mml:mn>3</mml:mn><mml:mo>×</mml:mo><mml:mn>3</mml:mn><mml:mo>×</mml:mo><mml:mn>1.5</mml:mn></mml:mrow></mml:math></alternatives></inline-formula>
  nm, meaning the delocalization distance can be different along each
  axis. The reasoning for the smaller delocalization in the z-axis is
  due to the better spatial resolution along this axis (the z-coordinate
  is measured by the time of flight, whereas x/y coordinates are
  measured by the PSD position).</p>
  <p>The first stage (placement into bins) cannot be accelerated by
  means of fast Fourier transforms (FFT) or other convolution methods.
  Instead, ion delocalization must be computed directly, per-ion.
  Computations like this are difficult to express solely with NumPy,
  this is an example where APAV utilizes multithreaded C extensions for
  acceleration. For this stage, any distribution could be used to
  transfer ions to the grid, APAV uses a Gaussian distribution. For
  example, the decomposed atomic concentration of sodium
  <inline-formula><alternatives>
  <tex-math><![CDATA[C_\text{Na}]]></tex-math>
  <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:msub><mml:mi>C</mml:mi><mml:mtext mathvariant="normal">Na</mml:mtext></mml:msub></mml:math></alternatives></inline-formula>,
  at the voxel centered in space at <inline-formula><alternatives>
  <tex-math><![CDATA[\boldsymbol{v_i}]]></tex-math>
  <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:msub><mml:mi>𝐯</mml:mi><mml:mi>𝐢</mml:mi></mml:msub></mml:math></alternatives></inline-formula>
  amounts to,</p>
  <p><disp-formula><alternatives>
  <tex-math><![CDATA[C_{\text{Na}}(\boldsymbol{v_i}) = \frac{1}{N_i}\sum_{j\in \boldsymbol{x}}\frac{k_j}{\sigma_1\sqrt{2\pi}}\exp\left(-\frac{||\boldsymbol{p_j} - \boldsymbol{v_i}||^{2}}{2\sigma_1^{2}}\right)]]></tex-math>
  <mml:math display="block" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:mrow><mml:msub><mml:mi>C</mml:mi><mml:mtext mathvariant="normal">Na</mml:mtext></mml:msub><mml:mrow><mml:mo stretchy="true" form="prefix">(</mml:mo><mml:msub><mml:mi>𝐯</mml:mi><mml:mi>𝐢</mml:mi></mml:msub><mml:mo stretchy="true" form="postfix">)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:msub><mml:mi>N</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mfrac><mml:munder><mml:mo>∑</mml:mo><mml:mrow><mml:mi>j</mml:mi><mml:mo>∈</mml:mo><mml:mi>𝐱</mml:mi></mml:mrow></mml:munder><mml:mfrac><mml:msub><mml:mi>k</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mrow><mml:msub><mml:mi>σ</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:msqrt><mml:mrow><mml:mn>2</mml:mn><mml:mi>π</mml:mi></mml:mrow></mml:msqrt></mml:mrow></mml:mfrac><mml:mo>exp</mml:mo><mml:mrow><mml:mo stretchy="true" form="prefix">(</mml:mo><mml:mo>−</mml:mo><mml:mfrac><mml:mrow><mml:mrow><mml:mo stretchy="true" form="prefix">|</mml:mo><mml:mo stretchy="true" form="postfix">|</mml:mo></mml:mrow><mml:msub><mml:mi>𝐩</mml:mi><mml:mi>𝐣</mml:mi></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>𝐯</mml:mi><mml:mi>𝐢</mml:mi></mml:msub><mml:msup><mml:mrow><mml:mo stretchy="true" form="prefix">|</mml:mo><mml:mo stretchy="true" form="postfix">|</mml:mo></mml:mrow><mml:mn>2</mml:mn></mml:msup></mml:mrow><mml:mrow><mml:mn>2</mml:mn><mml:msubsup><mml:mi>σ</mml:mi><mml:mn>1</mml:mn><mml:mn>2</mml:mn></mml:msubsup></mml:mrow></mml:mfrac><mml:mo stretchy="true" form="postfix">)</mml:mo></mml:mrow></mml:mrow></mml:math></alternatives></disp-formula></p>
  <p>where <inline-formula><alternatives>
  <tex-math><![CDATA[N_i]]></tex-math>
  <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:msub><mml:mi>N</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:math></alternatives></inline-formula>
  is the total number of (decomposed) ions contained within
  <inline-formula><alternatives>
  <tex-math><![CDATA[v_i]]></tex-math>
  <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:msub><mml:mi>v</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:math></alternatives></inline-formula>,
  <inline-formula><alternatives>
  <tex-math><![CDATA[\boldsymbol{p_j}]]></tex-math>
  <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:msub><mml:mi>𝐩</mml:mi><mml:mi>𝐣</mml:mi></mml:msub></mml:math></alternatives></inline-formula>
  is the spatial position of the <inline-formula><alternatives>
  <tex-math><![CDATA[j]]></tex-math>
  <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:mi>j</mml:mi></mml:math></alternatives></inline-formula>-th
  ion, <inline-formula><alternatives>
  <tex-math><![CDATA[x]]></tex-math>
  <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:mi>x</mml:mi></mml:math></alternatives></inline-formula>
  is the set of ions containing at least 1 Na atom,
  <inline-formula><alternatives>
  <tex-math><![CDATA[k_j]]></tex-math>
  <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:msub><mml:mi>k</mml:mi><mml:mi>j</mml:mi></mml:msub></mml:math></alternatives></inline-formula>
  is the number of Na atoms constituting the ion at
  <inline-formula><alternatives>
  <tex-math><![CDATA[\boldsymbol{p_j}]]></tex-math>
  <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:msub><mml:mi>𝐩</mml:mi><mml:mi>𝐣</mml:mi></mml:msub></mml:math></alternatives></inline-formula>,
  and <inline-formula><alternatives>
  <tex-math><![CDATA[\sigma_1]]></tex-math>
  <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:msub><mml:mi>σ</mml:mi><mml:mn>1</mml:mn></mml:msub></mml:math></alternatives></inline-formula>
  is the standard deviation of the Gaussian distribution. The standard
  deviation is chosen such that the 3rd standard deviation is half the
  bin width, <inline-formula><alternatives>
  <tex-math><![CDATA[3\sigma_1=b/2]]></tex-math>
  <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:mrow><mml:mn>3</mml:mn><mml:msub><mml:mi>σ</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo>=</mml:mo><mml:mi>b</mml:mi><mml:mi>/</mml:mi><mml:mn>2</mml:mn></mml:mrow></mml:math></alternatives></inline-formula>;
  this ensures that an ion in the center of a bin mostly contributes to
  only that bin (typical bin widths are 0.25-2 nm). For performance
  reasons, the kernel is truncated after the 1st nearest neighbors
  (i.e., the central bin and the surrounding 26 bins).</p>
  <p>The second stage is a Gaussian smoothing filter on each grid. For
  small bin sizes there may be low counts in each bin, and smoothing
  helps to mitigate noise. The standard deviation for this filter,
  <inline-formula><alternatives>
  <tex-math><![CDATA[\sigma_2]]></tex-math>
  <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:msub><mml:mi>σ</mml:mi><mml:mn>2</mml:mn></mml:msub></mml:math></alternatives></inline-formula>,
  is constrained by <inline-formula><alternatives>
  <tex-math><![CDATA[d=\sqrt{(3\sigma_1)^2 + (3\sigma_2)^2}]]></tex-math>
  <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:mrow><mml:mi>d</mml:mi><mml:mo>=</mml:mo><mml:msqrt><mml:mrow><mml:msup><mml:mrow><mml:mo stretchy="true" form="prefix">(</mml:mo><mml:mn>3</mml:mn><mml:msub><mml:mi>σ</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo stretchy="true" form="postfix">)</mml:mo></mml:mrow><mml:mn>2</mml:mn></mml:msup><mml:mo>+</mml:mo><mml:msup><mml:mrow><mml:mo stretchy="true" form="prefix">(</mml:mo><mml:mn>3</mml:mn><mml:msub><mml:mi>σ</mml:mi><mml:mn>2</mml:mn></mml:msub><mml:mo stretchy="true" form="postfix">)</mml:mo></mml:mrow><mml:mn>2</mml:mn></mml:msup></mml:mrow></mml:msqrt></mml:mrow></mml:math></alternatives></inline-formula>,
  thus <inline-formula><alternatives>
  <tex-math><![CDATA[\sigma_2]]></tex-math>
  <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:msub><mml:mi>σ</mml:mi><mml:mn>2</mml:mn></mml:msub></mml:math></alternatives></inline-formula>
  can be directly determined by <inline-formula><alternatives>
  <tex-math><![CDATA[\sigma_2=\sqrt{d^2+(3\sigma_1)^2}/3]]></tex-math>
  <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:mrow><mml:msub><mml:mi>σ</mml:mi><mml:mn>2</mml:mn></mml:msub><mml:mo>=</mml:mo><mml:msqrt><mml:mrow><mml:msup><mml:mi>d</mml:mi><mml:mn>2</mml:mn></mml:msup><mml:mo>+</mml:mo><mml:msup><mml:mrow><mml:mo stretchy="true" form="prefix">(</mml:mo><mml:mn>3</mml:mn><mml:msub><mml:mi>σ</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo stretchy="true" form="postfix">)</mml:mo></mml:mrow><mml:mn>2</mml:mn></mml:msup></mml:mrow></mml:msqrt><mml:mi>/</mml:mi><mml:mn>3</mml:mn></mml:mrow></mml:math></alternatives></inline-formula>.
  Computation of these grids provides a basis for studying compositional
  variations in the spatial domain, such as 2D concentration maps,
  proximity histograms, multivariate histograms, etc.</p>
</sec>
<sec id="acknowledgements">
  <title>Acknowledgements</title>
  <p>This work was performed in part at the University of North Texas’s
  Materials Research Facility: A shared research facility for
  multidimensional fabrication and characterization.</p>
</sec>
</body>
<back>
<ref-list>
  <ref id="ref-gault_review">
    <element-citation publication-type="article-journal">
      <person-group person-group-type="author">
        <name><surname>Gault</surname><given-names>B.</given-names></name>
        <name><surname>Chiaramonti</surname><given-names>A.</given-names></name>
        <name><surname>Cojocaru-Mirédin</surname><given-names>O.</given-names></name>
        <name><surname>Stender</surname><given-names>P.</given-names></name>
        <name><surname>Dubosq</surname><given-names>R.</given-names></name>
        <name><surname>Freysoldt</surname><given-names>C.</given-names></name>
        <name><surname>Makineni</surname><given-names>S. K.</given-names></name>
        <name><surname>Li</surname><given-names>T.</given-names></name>
        <name><surname>Moody</surname><given-names>M.</given-names></name>
        <name><surname>Cairney</surname><given-names>J. M.</given-names></name>
      </person-group>
      <article-title>Atom probe tomography</article-title>
      <source>Nature Reviews Method Primers</source>
      <year iso-8601-date="2021">2021</year>
      <volume>1</volume>
      <issue>51, 1</issue>
      <uri>https://doi.org/10.1038/s43586-021-00047-w</uri>
      <pub-id pub-id-type="doi">10.1038/s43586-021-00047-w</pub-id>
    </element-citation>
  </ref>
  <ref id="ref-atomva">
    <element-citation publication-type="article-journal">
      <person-group person-group-type="author">
        <name><surname>Felfer</surname><given-names>P</given-names></name>
        <name><surname>Ceguerra</surname><given-names>A.</given-names></name>
        <name><surname>Ringer</surname><given-names>S.</given-names></name>
        <name><surname>Cairney</surname><given-names>J.</given-names></name>
      </person-group>
      <article-title>Applying computational geometry techniques for advanced feature analysis in atom probe data</article-title>
      <source>Ultramicroscopy</source>
      <year iso-8601-date="2013">2013</year>
      <volume>132</volume>
      <issn>0304-3991</issn>
      <uri>https://www.sciencedirect.com/science/article/pii/S0304399113000740</uri>
      <pub-id pub-id-type="doi">10.1016/j.ultramic.2013.03.004</pub-id>
      <fpage>100</fpage>
      <lpage>106</lpage>
    </element-citation>
  </ref>
  <ref id="ref-apt_control">
    <element-citation publication-type="article-journal">
      <person-group person-group-type="author">
        <name><surname>Monajem</surname><given-names>M.</given-names></name>
        <name><surname>Felfer</surname><given-names>P.</given-names></name>
      </person-group>
      <article-title>APT_PyControl, an open-source python atom probe tomography control software package</article-title>
      <source>Microscopy and Microanalysis</source>
      <publisher-name>Cambridge University Press</publisher-name>
      <year iso-8601-date="2022">2022</year>
      <volume>28</volume>
      <issue>S1</issue>
      <pub-id pub-id-type="doi">10.1017/S1431927622003397</pub-id>
      <fpage>732</fpage>
      <lpage>734</lpage>
    </element-citation>
  </ref>
  <ref id="ref-paraprobe">
    <element-citation publication-type="article-journal">
      <person-group person-group-type="author">
        <name><surname>Kühbach</surname><given-names>M.</given-names></name>
        <name><surname>Bajaj</surname><given-names>P.</given-names></name>
        <name><surname>Zhao</surname><given-names>H.</given-names></name>
        <name><surname>Çelik</surname><given-names>M. H.</given-names></name>
        <name><surname>Jägle</surname><given-names>E. A.</given-names></name>
        <name><surname>Gault</surname><given-names>B.</given-names></name>
      </person-group>
      <article-title>On strong-scaling and open-source tools for analyzing atom probe tomography data</article-title>
      <source>npj Computational Materials</source>
      <publisher-name>Springer US</publisher-name>
      <year iso-8601-date="2021">2021</year>
      <volume>7</volume>
      <issue>1</issue>
      <uri>http://dx.doi.org/10.1038/s41524-020-00486-1</uri>
      <pub-id pub-id-type="doi">10.1038/s41524-020-00486-1</pub-id>
      <fpage>1</fpage>
      <lpage>10</lpage>
    </element-citation>
  </ref>
  <ref id="ref-Larson2013">
    <element-citation publication-type="book">
      <person-group person-group-type="author">
        <name><surname>Larson</surname><given-names>D.</given-names></name>
        <name><surname>Prosa</surname><given-names>T.</given-names></name>
        <name><surname>Ulfig</surname><given-names>R.</given-names></name>
        <name><surname>Geiser</surname><given-names>B.</given-names></name>
        <name><surname>Kelly</surname><given-names>T.</given-names></name>
      </person-group>
      <source>Local Electrode Atom Probe Tomography: A User’s Guide</source>
      <publisher-name>Springer</publisher-name>
      <year iso-8601-date="2013">2013</year>
      <isbn>978-1-4614-8721-0</isbn>
    </element-citation>
  </ref>
  <ref id="ref-Saxey2011">
    <element-citation publication-type="article-journal">
      <person-group person-group-type="author">
        <name><surname>Saxey</surname><given-names>D. W.</given-names></name>
      </person-group>
      <article-title>Correlated ion analysis and the interpretation of atom probe mass spectra</article-title>
      <source>Ultramicroscopy</source>
      <publisher-name>North-Holland</publisher-name>
      <year iso-8601-date="2011-05">2011</year><month>05</month>
      <volume>111</volume>
      <issue>6</issue>
      <uri>https://www.sciencedirect.com/science/article/pii/S0304399110003116 https://linkinghub.elsevier.com/retrieve/pii/S0304399110003116</uri>
      <pub-id pub-id-type="doi">10.1016/j.ultramic.2010.11.021</pub-id>
      <fpage>473</fpage>
      <lpage>479</lpage>
    </element-citation>
  </ref>
  <ref id="ref-Smith2021">
    <element-citation publication-type="article-journal">
      <person-group person-group-type="author">
        <name><surname>Smith</surname><given-names>J. D.</given-names></name>
        <name><surname>Huh</surname><given-names>J.</given-names></name>
        <name><surname>Shelton</surname><given-names>A.</given-names></name>
        <name><surname>Reidy</surname><given-names>R. F.</given-names></name>
        <name><surname>Young</surname><given-names>M. L.</given-names></name>
      </person-group>
      <article-title>Laser-Assisted Field Evaporation of RBa2Cu3O7-δ (R = Gd, Sm) High-Temperature Superconducting Coated Conductors</article-title>
      <source>Microscopy and Microanalysis</source>
      <publisher-name>Cambridge University Press</publisher-name>
      <year iso-8601-date="2021">2021</year>
      <pub-id pub-id-type="doi">10.1017/S1431927621012794</pub-id>
      <fpage>1</fpage>
      <lpage>18</lpage>
    </element-citation>
  </ref>
  <ref id="ref-lmfit">
    <element-citation publication-type="software">
      <person-group person-group-type="author">
        <name><surname>Newville</surname><given-names>M.</given-names></name>
        <name><surname>Otten</surname><given-names>R.</given-names></name>
        <name><surname>Nelson</surname><given-names>A.</given-names></name>
        <name><surname>Ingargiola</surname><given-names>A.</given-names></name>
        <name><surname>Stensitzki</surname><given-names>T.</given-names></name>
        <name><surname>Allan</surname><given-names>D.</given-names></name>
        <name><surname>Fox</surname><given-names>A.</given-names></name>
        <name><surname>Carter</surname><given-names>F.</given-names></name>
        <name><surname>Michał</surname></name>
        <name><surname>Osborn</surname><given-names>R.</given-names></name>
        <name><surname>Pustakhod</surname><given-names>D.</given-names></name>
        <name><surname>Lneuhaus</surname></name>
        <name><surname>Weigand</surname><given-names>S.</given-names></name>
        <name><surname>Glenn</surname></name>
        <name><surname>Deil</surname><given-names>C.</given-names></name>
        <name><surname>Mark</surname></name>
        <name><surname>Hansen</surname><given-names>A. L.</given-names></name>
        <name><surname>Pasquevich</surname><given-names>G.</given-names></name>
        <name><surname>Foks</surname><given-names>L.</given-names></name>
        <name><surname>Zobrist</surname><given-names>N.</given-names></name>
        <name><surname>Frost</surname><given-names>O.</given-names></name>
        <name><surname>Beelen</surname><given-names>A.</given-names></name>
        <name><surname>Stuermer</surname></name>
        <name><surname>Azelcer</surname></name>
        <name><surname>Hannum</surname><given-names>A.</given-names></name>
        <name><surname>Polloreno</surname><given-names>A.</given-names></name>
        <name><surname>Nielsen</surname><given-names>J. H.</given-names></name>
        <name><surname>Caldwell</surname><given-names>S.</given-names></name>
        <name><surname>Almarza</surname><given-names>A.</given-names></name>
        <name><surname>Persaud</surname><given-names>A.</given-names></name>
      </person-group>
      <article-title>Lmfit/lmfit-py: 1.0.3</article-title>
      <publisher-name>Zenodo</publisher-name>
      <year iso-8601-date="2021-10">2021</year><month>10</month>
      <uri>https://doi.org/10.5281/zenodo.5570790</uri>
      <pub-id pub-id-type="doi">10.5281/zenodo.5570790</pub-id>
    </element-citation>
  </ref>
  <ref id="ref-Yao2010">
    <element-citation publication-type="article-journal">
      <person-group person-group-type="author">
        <name><surname>Yao</surname><given-names>L.</given-names></name>
        <name><surname>Gault</surname><given-names>B.</given-names></name>
        <name><surname>Cairney</surname><given-names>J. M.</given-names></name>
        <name><surname>Ringer</surname><given-names>S. P.</given-names></name>
      </person-group>
      <article-title>On the multiplicity of field evaporation events in atom probe: A new dimension to the analysis of mass spectra</article-title>
      <source>Philosophical Magazine Letters</source>
      <year iso-8601-date="2010">2010</year>
      <volume>90</volume>
      <issue>2</issue>
      <pub-id pub-id-type="doi">10.1080/09500830903472997</pub-id>
      <fpage>121</fpage>
      <lpage>129</lpage>
    </element-citation>
  </ref>
  <ref id="ref-gault_book_2012">
    <element-citation publication-type="book">
      <person-group person-group-type="author">
        <name><surname>Gault</surname><given-names>B.</given-names></name>
        <name><surname>Moody</surname><given-names>M. P.</given-names></name>
        <name><surname>Cairney</surname><given-names>J. M.</given-names></name>
        <name><surname>Ringer</surname><given-names>S. P.</given-names></name>
      </person-group>
      <source>Atom probe microscopy</source>
      <publisher-name>Springer</publisher-name>
      <year iso-8601-date="2012">2012</year>
      <edition>1</edition>
      <isbn>146143436X</isbn>
      <uri>https://link.springer.com/book/10.1007/978-1-4614-3436-8</uri>
    </element-citation>
  </ref>
  <ref id="ref-Tamura2012">
    <element-citation publication-type="article-journal">
      <person-group person-group-type="author">
        <name><surname>Tamura</surname><given-names>H.</given-names></name>
        <name><surname>Tsukada</surname><given-names>M.</given-names></name>
        <name><surname>McKenna</surname><given-names>K. P.</given-names></name>
        <name><surname>Shluger</surname><given-names>A. L.</given-names></name>
        <name><surname>Ohkubo</surname><given-names>T.</given-names></name>
        <name><surname>Hono</surname><given-names>K.</given-names></name>
      </person-group>
      <article-title>Laser-assisted field evaporation from insulators triggered by photoinduced hole accumulation</article-title>
      <source>Phys. Rev. B</source>
      <publisher-name>American Physical Society</publisher-name>
      <year iso-8601-date="2012-11">2012</year><month>11</month>
      <volume>86</volume>
      <uri>https://link.aps.org/doi/10.1103/PhysRevB.86.195430</uri>
      <pub-id pub-id-type="doi">10.1103/PhysRevB.86.195430</pub-id>
      <fpage>195430</fpage>
      <lpage></lpage>
    </element-citation>
  </ref>
</ref-list>
<fn-group>
  <fn id="fn1">
    <label>1</label><p>Such as:
    https://gitlab.com/jesseds/apav/-/blob/JOSS/docs/APT%20software%20list.md</p>
  </fn>
</fn-group>
</back>
</article>
