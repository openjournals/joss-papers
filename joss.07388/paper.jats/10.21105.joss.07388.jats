<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE article PUBLIC "-//NLM//DTD JATS (Z39.96) Journal Publishing DTD v1.2 20190208//EN"
                  "JATS-publishing1.dtd">
<article xmlns:mml="http://www.w3.org/1998/Math/MathML" xmlns:xlink="http://www.w3.org/1999/xlink" dtd-version="1.2" article-type="other">
<front>
<journal-meta>
<journal-id></journal-id>
<journal-title-group>
<journal-title>Journal of Open Source Software</journal-title>
<abbrev-journal-title>JOSS</abbrev-journal-title>
</journal-title-group>
<issn publication-format="electronic">2475-9066</issn>
<publisher>
<publisher-name>Open Journals</publisher-name>
</publisher>
</journal-meta>
<article-meta>
<article-id pub-id-type="publisher-id">7388</article-id>
<article-id pub-id-type="doi">10.21105/joss.07388</article-id>
<title-group>
<article-title>flory: A Python package for finding coexisting phases in
multicomponent mixtures</article-title>
</title-group>
<contrib-group>
<contrib contrib-type="author">
<contrib-id contrib-id-type="orcid">https://orcid.org/0000-0003-2053-079X</contrib-id>
<name>
<surname>Qiang</surname>
<given-names>Yicheng</given-names>
</name>
<xref ref-type="aff" rid="aff-1"/>
</contrib>
<contrib contrib-type="author">
<contrib-id contrib-id-type="orcid">https://orcid.org/0000-0002-3909-3334</contrib-id>
<name>
<surname>Zwicker</surname>
<given-names>David</given-names>
</name>
<xref ref-type="aff" rid="aff-1"/>
</contrib>
<aff id="aff-1">
<institution-wrap>
<institution>Max Planck Institute for Dynamics and Self-Organization,
Göttingen, Germany</institution>
</institution-wrap>
</aff>
</contrib-group>
<pub-date date-type="pub" publication-format="electronic" iso-8601-date="2024-12-02">
<day>2</day>
<month>12</month>
<year>2024</year>
</pub-date>
<volume>10</volume>
<issue>107</issue>
<fpage>7388</fpage>
<permissions>
<copyright-statement>Authors of papers retain copyright and release the
work under a Creative Commons Attribution 4.0 International License (CC
BY 4.0)</copyright-statement>
<copyright-year>2025</copyright-year>
<copyright-holder>The article authors</copyright-holder>
<license license-type="open-access" xlink:href="https://creativecommons.org/licenses/by/4.0/">
<license-p>Authors of papers retain copyright and release the work under
a Creative Commons Attribution 4.0 International License (CC BY
4.0)</license-p>
</license>
</permissions>
<kwd-group kwd-group-type="author">
<kwd>Python</kwd>
<kwd>physics</kwd>
<kwd>phase separation</kwd>
<kwd>free energy</kwd>
</kwd-group>
</article-meta>
</front>
<body>
<sec id="summary">
  <title>Summary</title>
  <p>Phase separation is an intrinsic property of mixtures that is
  widely observed in many scenarios, ranging from the simple demixing of
  oil and water to the condensation of biomolecules in cells
  (<xref alt="Hyman et al., 2014" rid="ref-hyman2014LiquidLiquid" ref-type="bibr">Hyman
  et al., 2014</xref>). In multicomponent mixtures, phase separation can
  lead to many coexisting phases, which is crucial in many fields. One
  key step to understand phase separation is to measure or predict the
  composition of the coexisting phases. To support such research, the
  <monospace>flory</monospace> package provides an easily accessible,
  performant, and extensible code that finds coexisting phases in
  multicomponent mixtures. The package expresses the free energy of the
  mixtures by several orthogonal aspects to cover a broad range of
  physical situations. In contrast to existing methods, the
  <monospace>flory</monospace> package implements a state-of-art method
  that is optimized for mixtures of many components. The package mainly
  focus on the mixtures with uniform and relatively simple free energies
  such as Flory-Huggins free energy and its generalizations, while more
  complicated ones can also be supported through extensions.</p>
</sec>
<sec id="statement-of-need">
  <title>Statement of need</title>
  <p>Finding coexisting phases is a common task in many fields, such as
  chemical engineering
  (<xref alt="Lukas et al., 2007" rid="ref-lukas2007Computational" ref-type="bibr">Lukas
  et al., 2007</xref>) and soft matter physics
  (<xref alt="Jacobs, 2023" rid="ref-jacobs2023Theory" ref-type="bibr">Jacobs,
  2023</xref>). The coexisting phases can be theoretically predicted by
  solving the balance equations between phases
  (<xref alt="Zwicker &amp; Laan, 2022" rid="ref-zwicker2022Evolved" ref-type="bibr">Zwicker
  &amp; Laan, 2022</xref>), or equivalently minimizing the total free
  energy of the whole mixture
  (<xref alt="Lukas et al., 2007" rid="ref-lukas2007Computational" ref-type="bibr">Lukas
  et al., 2007</xref>). Other strategies include direct
  spatially-resolved simulations
  (<xref alt="Shrinivas &amp; Brenner, 2021" rid="ref-shrinivas2021Phase" ref-type="bibr">Shrinivas
  &amp; Brenner, 2021</xref>) and the construction of the convex hull of
  the free energy landscape
  (<xref alt="Mao et al., 2019" rid="ref-mao2019Phase" ref-type="bibr">Mao
  et al., 2019</xref>). There are a few open-source packages that
  implement these strategies. Most notably, Calphad packages, including
  <monospace>Equilipy</monospace>
  (<xref alt="Kwon et al., 2024" rid="ref-kwon2024Equilipy" ref-type="bibr">Kwon
  et al., 2024</xref>), <monospace>pycalphad</monospace>
  (<xref alt="Otis &amp; Liu, 2017" rid="ref-otis2017Pycalphad" ref-type="bibr">Otis
  &amp; Liu, 2017</xref>) and <monospace>OpenCalphad</monospace>
  (<xref alt="Sundman et al., 2015" rid="ref-sundman2015OpenCalphad" ref-type="bibr">Sundman
  et al., 2015</xref>), combine a database of candidate phases and the
  strategies above to compute phase diagrams of mixtures with few
  components. In addition, <monospace>SurfinPy</monospace>
  (<xref alt="Tse et al., 2022" rid="ref-tse2022SurfinPy" ref-type="bibr">Tse
  et al., 2022</xref>) applies the free energy minimization strategy to
  surface phases.</p>
  <p>In general, finding coexisting phases is challenging for mixtures
  with a large number of the components, <inline-formula><alternatives>
  <tex-math><![CDATA[N_\mathrm{C}]]></tex-math>
  <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:msub><mml:mi>N</mml:mi><mml:mi mathvariant="normal">C</mml:mi></mml:msub></mml:math></alternatives></inline-formula>.
  This is because the number of degrees of freedom (e.g., to describe
  the composition of the phases) increases with larger
  <inline-formula><alternatives>
  <tex-math><![CDATA[N_\mathrm{C}]]></tex-math>
  <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:msub><mml:mi>N</mml:mi><mml:mi mathvariant="normal">C</mml:mi></mml:msub></mml:math></alternatives></inline-formula>.
  Moreover, the possible number of coexisting phases also increases with
  <inline-formula><alternatives>
  <tex-math><![CDATA[N_\mathrm{C}]]></tex-math>
  <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:msub><mml:mi>N</mml:mi><mml:mi mathvariant="normal">C</mml:mi></mml:msub></mml:math></alternatives></inline-formula>
  according to Gibbs phase rule, implying that the free energy of the
  entire system comprises roughly <inline-formula><alternatives>
  <tex-math><![CDATA[N_\mathrm{C}^2]]></tex-math>
  <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:msubsup><mml:mi>N</mml:mi><mml:mi mathvariant="normal">C</mml:mi><mml:mn>2</mml:mn></mml:msubsup></mml:math></alternatives></inline-formula>
  free variables. This high-dimensional space needs to be sampled to
  find the global minimum with multiple coexisting phases, which is
  infeasible for some of the strategies mentioned above since they
  become prohibitively expensive. For example, the cost of the convex
  hull strategy increases exponentially with
  <inline-formula><alternatives>
  <tex-math><![CDATA[N_\mathrm{C}]]></tex-math>
  <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:msub><mml:mi>N</mml:mi><mml:mi mathvariant="normal">C</mml:mi></mml:msub></mml:math></alternatives></inline-formula>
  since it requires sampling the entire free energy landscape. The
  existing Calphad packages address this challenge by taking the
  advantage of several strategies
  (<xref alt="Lukas et al., 2007" rid="ref-lukas2007Computational" ref-type="bibr">Lukas
  et al., 2007</xref>). For example, the free energy minimization
  strategy can refine the results obtained from the convex hull
  strategy. Besides, Calphad packages usually provide high flexibility
  on candidate phases, allowing each phase to have different free
  energies to model realistic systems
  (<xref alt="Sundman et al., 2015" rid="ref-sundman2015OpenCalphad" ref-type="bibr">Sundman
  et al., 2015</xref>). In contrast, <monospace>flory</monospace>
  focuses on the general physics of multicomponent phase separation, and
  thus assumes that all candidate phases share the same free energy
  function, e.g., the simple Flory-Huggins free energy, similar to a
  recent submodule of the <monospace>OpenCalphad</monospace> package
  (<xref alt="Li et al., 2020" rid="ref-li2020Implementation" ref-type="bibr">Li
  et al., 2020</xref>). These simple models are more common in liquid
  systems such as polymer mixtures, and have recently been considered
  relevant to phase separation in biological cells. The restrictions of
  the physical model simplifies the user interface and allow for an
  efficient optimization algorithm. For example,
  <monospace>flory</monospace> implements an algorithm that
  automatically satisfies the constraints of ensembles, thus reducing
  the Lagrange multipliers required
  (<xref alt="White et al., 1958" rid="ref-white1958Chemical" ref-type="bibr">White
  et al., 1958</xref>). To obtain the coexisting phases in equilibrium
  without the prior knowledge of the compositions of the phases,
  <monospace>flory</monospace> starts from many phases initially and
  then clusters the equivalent phases afterwards. As the result, the
  <monospace>flory</monospace> package can efficiently determine the
  multiple coexisting phases in equilibrium in a range of multicomponent
  mixtures with large number of the components
  <inline-formula><alternatives>
  <tex-math><![CDATA[N_\mathrm{C}]]></tex-math>
  <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:msub><mml:mi>N</mml:mi><mml:mi mathvariant="normal">C</mml:mi></mml:msub></mml:math></alternatives></inline-formula>.</p>
</sec>
<sec id="methods">
  <title>Methods</title>
  <p>The <monospace>flory</monospace> package is based on the free
  energy minimization strategy. To reduce computation cost, the package
  focuses on coexisting phases in thermodynamically large systems, where
  the interfaces between phases become negligible. Coexisting phases can
  thus be found by minimizing the average free energy density
  <inline-formula><alternatives>
  <tex-math><![CDATA[\bar f]]></tex-math>
  <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:mover><mml:mi>f</mml:mi><mml:mo accent="true">‾</mml:mo></mml:mover></mml:math></alternatives></inline-formula>
  of the entire system, which is given by</p>
  <p><disp-formula><alternatives>
  <tex-math><![CDATA[\bar{f}({N_\mathrm{P}}, \{J_p\}, \{\phi_{p,i}\}) = \sum_{p=1}^{{N_\mathrm{P}}} J_p f(\{\phi_{p,i}\}) \; ,]]></tex-math>
  <mml:math display="block" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:mrow><mml:mover><mml:mi>f</mml:mi><mml:mo accent="true">‾</mml:mo></mml:mover><mml:mrow><mml:mo stretchy="true" form="prefix">(</mml:mo><mml:msub><mml:mi>N</mml:mi><mml:mi mathvariant="normal">P</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:mo stretchy="false" form="prefix">{</mml:mo><mml:msub><mml:mi>J</mml:mi><mml:mi>p</mml:mi></mml:msub><mml:mo stretchy="false" form="postfix">}</mml:mo><mml:mo>,</mml:mo><mml:mo stretchy="false" form="prefix">{</mml:mo><mml:msub><mml:mi>ϕ</mml:mi><mml:mrow><mml:mi>p</mml:mi><mml:mo>,</mml:mo><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false" form="postfix">}</mml:mo><mml:mo stretchy="true" form="postfix">)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:munderover><mml:mo>∑</mml:mo><mml:mrow><mml:mi>p</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:msub><mml:mi>N</mml:mi><mml:mi mathvariant="normal">P</mml:mi></mml:msub></mml:munderover><mml:msub><mml:mi>J</mml:mi><mml:mi>p</mml:mi></mml:msub><mml:mi>f</mml:mi><mml:mrow><mml:mo stretchy="true" form="prefix">(</mml:mo><mml:mo stretchy="false" form="prefix">{</mml:mo><mml:msub><mml:mi>ϕ</mml:mi><mml:mrow><mml:mi>p</mml:mi><mml:mo>,</mml:mo><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false" form="postfix">}</mml:mo><mml:mo stretchy="true" form="postfix">)</mml:mo></mml:mrow><mml:mspace width="0.278em"></mml:mspace><mml:mo>,</mml:mo></mml:mrow></mml:math></alternatives></disp-formula></p>
  <p>where <inline-formula><alternatives>
  <tex-math><![CDATA[N_\mathrm{C}]]></tex-math>
  <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:msub><mml:mi>N</mml:mi><mml:mi mathvariant="normal">C</mml:mi></mml:msub></mml:math></alternatives></inline-formula>
  is the number of components, <inline-formula><alternatives>
  <tex-math><![CDATA[N_\mathrm{P}]]></tex-math>
  <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:msub><mml:mi>N</mml:mi><mml:mi mathvariant="normal">P</mml:mi></mml:msub></mml:math></alternatives></inline-formula>
  is the number of phases, <inline-formula><alternatives>
  <tex-math><![CDATA[J_p]]></tex-math>
  <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:msub><mml:mi>J</mml:mi><mml:mi>p</mml:mi></mml:msub></mml:math></alternatives></inline-formula>
  denotes the fraction of volume that phase
  <inline-formula><alternatives>
  <tex-math><![CDATA[p=1,\ldots,N_\mathrm{P}]]></tex-math>
  <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:mrow><mml:mi>p</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mi>…</mml:mi><mml:mo>,</mml:mo><mml:msub><mml:mi>N</mml:mi><mml:mi mathvariant="normal">P</mml:mi></mml:msub></mml:mrow></mml:math></alternatives></inline-formula>
  occupies in the entire system, and <inline-formula><alternatives>
  <tex-math><![CDATA[\phi_{p,i}]]></tex-math>
  <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:msub><mml:mi>ϕ</mml:mi><mml:mrow><mml:mi>p</mml:mi><mml:mo>,</mml:mo><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:math></alternatives></inline-formula>
  is the volume fraction of component <inline-formula><alternatives>
  <tex-math><![CDATA[i=1,\ldots,N_\mathrm{C}]]></tex-math>
  <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mi>…</mml:mi><mml:mo>,</mml:mo><mml:msub><mml:mi>N</mml:mi><mml:mi mathvariant="normal">C</mml:mi></mml:msub></mml:mrow></mml:math></alternatives></inline-formula>
  in phase <inline-formula><alternatives>
  <tex-math><![CDATA[p]]></tex-math>
  <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:mi>p</mml:mi></mml:math></alternatives></inline-formula>.
  The physical behavior of the mixture is encoded in the free energy
  density <inline-formula><alternatives>
  <tex-math><![CDATA[f]]></tex-math>
  <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:mi>f</mml:mi></mml:math></alternatives></inline-formula>,
  which <monospace>flory</monospace> expresses using four orthogonal
  aspects: interaction, entropy, ensemble, and constraints. The package
  only imposes limits on the entropy part, which is crucial for the core
  algorithm, while the other three aspects are rather flexible. For
  instance, the interactions can be described by quadratic terms, like
  in the Flory-Huggins model, and the parameters can be obtained from
  database such as <monospace>3PDB</monospace>
  (<xref alt="Polymer Property Predictor and Database, 2019" rid="ref-2019Polymer" ref-type="bibr"><italic>Polymer
  Property Predictor and Database</italic>, 2019</xref>) for realistic
  polymer mixtures, or freely chosen for theoretical investigations. By
  combining these four aspects, <monospace>flory</monospace> supports a
  broad range of free energy densities <inline-formula><alternatives>
  <tex-math><![CDATA[f]]></tex-math>
  <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:mi>f</mml:mi></mml:math></alternatives></inline-formula>
  with different ensembles and constraints. A few widely-used
  specializations are provided for all four aspects, while customized
  ones can be added easily.</p>
  <p>The <monospace>flory</monospace> package is designed to deliver
  high performance. The core part of the <monospace>flory</monospace>
  package is the finder for coexisting phases, which can be reused when
  the number <inline-formula><alternatives>
  <tex-math><![CDATA[N_\mathrm{C}]]></tex-math>
  <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:msub><mml:mi>N</mml:mi><mml:mi mathvariant="normal">C</mml:mi></mml:msub></mml:math></alternatives></inline-formula>
  of components is kept fixed. This design moves a significant overhead
  to the creation of the solver, which can be amortized in many tasks,
  e.g., when a phase diagram is sampled. The core methods in the finder
  are just-in-time (JIT) compiled using numba
  (<xref alt="Lam et al., 2015" rid="ref-lam2015Numba" ref-type="bibr">Lam
  et al., 2015</xref>) to achieve high performance. To support different
  forms of the free energy <inline-formula><alternatives>
  <tex-math><![CDATA[f]]></tex-math>
  <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:mi>f</mml:mi></mml:math></alternatives></inline-formula>,
  the core method is also designed to be general. The finder fetches
  compiled instances of the interaction, entropy, ensemble, and
  constraints, where case-specific codes are inserted as methods. These
  methods are also compiled for performance, using the experimental
  <monospace>jitclass</monospace> feature from numba
  (<xref alt="Lam et al., 2015" rid="ref-lam2015Numba" ref-type="bibr">Lam
  et al., 2015</xref>).</p>
  <p>The <monospace>flory</monospace> package adopts state-of-the-art
  numerical methods to determine coexisting phases. The main idea is to
  represent the system by many independent compartments, which can
  exchange particles and volumes, obeying total constraints
  (<xref alt="Zwicker &amp; Laan, 2022" rid="ref-zwicker2022Evolved" ref-type="bibr">Zwicker
  &amp; Laan, 2022</xref>). The <monospace>flory</monospace> package
  then minimizes the full free energy <inline-formula><alternatives>
  <tex-math><![CDATA[\bar f]]></tex-math>
  <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:mover><mml:mi>f</mml:mi><mml:mo accent="true">‾</mml:mo></mml:mover></mml:math></alternatives></inline-formula>
  instead of directly solving the corresponding coexistence conditions.
  At the free energy minimum, compartments may share similar
  compositions, which the package then cluster to obtain unique phases
  using the <monospace>scipy</monospace> cluster methods
  (<xref alt="Virtanen et al., 2020" rid="ref-virtanen2020SciPy" ref-type="bibr">Virtanen
  et al., 2020</xref>). This strategy circumvents the typical challenge
  of multiple local minima and it avoids iterating over all possible
  phase counts <inline-formula><alternatives>
  <tex-math><![CDATA[N_\mathrm{P}]]></tex-math>
  <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:msub><mml:mi>N</mml:mi><mml:mi mathvariant="normal">P</mml:mi></mml:msub></mml:math></alternatives></inline-formula>.
  To improve performance, the <monospace>flory</monospace> package
  implements the improved Gibbs ensemble method we developed recently
  (<xref alt="Qiang et al., 2024" rid="ref-qiang2024Scaling" ref-type="bibr">Qiang
  et al., 2024</xref>). This method redistributes components across all
  compartments simultaneously, guided by a set of conjugate variables,
  such that the total computation cost per step only scales linearly
  with the number of compartments. Beside the core function of finding
  coexisting phases, <monospace>flory</monospace> also includes
  convenience tools, e.g., to analyze thermodynamic properties such as
  chemical potentials and osmotic pressures. In summary, the
  <monospace>flory</monospace> package can typically obtain the
  equilibrium coexisting states even in systems with many interacting
  components.</p>
</sec>
<sec id="examples">
  <title>Examples</title>
  <p>The following code illustrates the main functionality of the
  package by finding the two coexisting phases of a symmetric
  Flory-Huggins binary mixture with <inline-formula><alternatives>
  <tex-math><![CDATA[\chi=4]]></tex-math>
  <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:mrow><mml:mi>χ</mml:mi><mml:mo>=</mml:mo><mml:mn>4</mml:mn></mml:mrow></mml:math></alternatives></inline-formula>:</p>
  <code language="python">fh = flory.FloryHuggins(2, chis=[[0, 4.0], [4.0, 0]])
ensemble = flory.CanonicalEnsemble(2, phi_means=[0.5, 0.5])
finder = flory.CoexistingPhasesFinder(fh.interaction, fh.entropy, ensemble)
phases = finder.run().get_clusters()</code>
  <p>Here, <monospace>FloryHuggins</monospace> represents the seminal
  Flory-Huggins free energy that creates the interaction
  <monospace>FloryHugginsInteraction</monospace> and the entropy
  <monospace>IdealGasEntropy</monospace> simultaneously, and provides
  tools for analyzing coexisting phases. By updating the interaction, we
  can then obtain the coexisting phases of another symmetric binary
  mixture with <inline-formula><alternatives>
  <tex-math><![CDATA[\chi=3.5]]></tex-math>
  <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:mrow><mml:mi>χ</mml:mi><mml:mo>=</mml:mo><mml:mn>3.5</mml:mn></mml:mrow></mml:math></alternatives></inline-formula>:</p>
  <code language="python">fh.chis = [[0, 3.5], [3.5, 0]]
finder.set_interaction(fh.interaction)
phases = finder.run().get_clusters()</code>
  <p>This procedure can be repeated to sample an entire phase diagrams.
  For example, the following code will generate the phase diagram of a
  mixture of two components with identical molecular sizes,</p>
  <code language="python">import matplotlib.pyplot as plt
import numpy as np
import flory

fh = flory.FloryHuggins(2, chis=[[0, 5.0], [5.0, 0]])
ensemble = flory.CanonicalEnsemble(2, phi_means=[0.5, 0.5])
finder = flory.CoexistingPhasesFinder(fh.interaction, fh.entropy, ensemble)

line_chi = []
line_l = []
line_h = []
for chi in np.arange(5.0, 1.0, -0.1):  # scan chi from high value to low value
    fh.interaction.chis = [[0, chi], [chi, 0]]  # set chi matrix of the finder
    finder.set_interaction(fh.interaction)
    phases = finder.run().get_clusters()  # get coexisting phases
    if phases.fractions.shape[0] == 1:  # stop scanning if no phase separation
        break
    line_chi.append(chi)
    line_l.append(phases.fractions[1, 0])
    line_h.append(phases.fractions[0, 0])

plt.plot(line_l, line_chi, c=&quot;black&quot;)
plt.plot(line_h, line_chi, c=&quot;black&quot;)
plt.xlabel(&quot;$\\phi$&quot;)
plt.ylabel(&quot;$\\chi$&quot;)
plt.show()</code>
  <fig>
    <caption><p>Phase diagram of binary mixture. The lines show the
    coexisting composition <inline-formula><alternatives>
    <tex-math><![CDATA[\phi]]></tex-math>
    <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:mi>ϕ</mml:mi></mml:math></alternatives></inline-formula>
    at a given interaction strength <inline-formula><alternatives>
    <tex-math><![CDATA[\chi]]></tex-math>
    <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:mi>χ</mml:mi></mml:math></alternatives></inline-formula>,
    together known as a the binodal line.</p></caption>
    <graphic mimetype="image" mime-subtype="jpeg" xlink:href="pd.jpg" xlink:title="Phase diagram of binary mixture" />
  </fig>
  <p>Moreover, one can vary the type of interaction by initializing a
  different class or by modifying the existing one, and one could
  similarly change the entropy, ensemble, and constraints. Customized
  specialization of all four aspects can be easily implemented by
  deriving from the provided base classes
  (<xref alt="“Flory” Python Package — Flory Documentation, 2025" rid="ref-2025Flory" ref-type="bibr"><italic>“Flory”
  Python Package — Flory Documentation</italic>, 2025</xref>).</p>
</sec>
<sec id="acknowledgements">
  <title>Acknowledgements</title>
  <p>We thank Chengjie Luo for stimulating discussions. We gratefully
  acknowledge funding from the Max Planck Society and the European Union
  (ERC, EmulSim, 101044662).</p>
</sec>
</body>
<back>
<ref-list>
  <title></title>
  <ref id="ref-2019Polymer">
    <element-citation>
      <article-title>Polymer Property Predictor and Database</article-title>
      <year iso-8601-date="2019">2019</year>
      <date-in-citation content-type="access-date"><year iso-8601-date="2024-12-02">2024</year><month>12</month><day>02</day></date-in-citation>
      <uri>https://pppdb.uchicago.edu</uri>
    </element-citation>
  </ref>
  <ref id="ref-2025Flory">
    <element-citation>
      <article-title>‘Flory’ Python package — flory documentation</article-title>
      <year iso-8601-date="2025">2025</year>
      <date-in-citation content-type="access-date"><year iso-8601-date="2025-02-18">2025</year><month>02</month><day>18</day></date-in-citation>
      <uri>https://flory.readthedocs.io</uri>
    </element-citation>
  </ref>
  <ref id="ref-hyman2014LiquidLiquid">
    <element-citation publication-type="article-journal">
      <person-group person-group-type="author">
        <name><surname>Hyman</surname><given-names>Anthony A.</given-names></name>
        <name><surname>Weber</surname><given-names>Christoph A.</given-names></name>
        <name><surname>Jülicher</surname><given-names>Frank</given-names></name>
      </person-group>
      <article-title>Liquid-Liquid Phase Separation in Biology</article-title>
      <source>Annual Review of Cell and Developmental Biology</source>
      <publisher-name>Annual Reviews</publisher-name>
      <year iso-8601-date="2014-10">2014</year><month>10</month>
      <date-in-citation content-type="access-date"><year iso-8601-date="2024-04-12">2024</year><month>04</month><day>12</day></date-in-citation>
      <volume>30</volume>
      <issue>1</issue>
      <issn>1081-0706</issn>
      <pub-id pub-id-type="doi">10.1146/annurev-cellbio-100913-013325</pub-id>
      <fpage>39</fpage>
      <lpage>58</lpage>
    </element-citation>
  </ref>
  <ref id="ref-jacobs2023Theory">
    <element-citation publication-type="article-journal">
      <person-group person-group-type="author">
        <name><surname>Jacobs</surname><given-names>William M.</given-names></name>
      </person-group>
      <article-title>Theory and Simulation of Multiphase Coexistence in Biomolecular Mixtures</article-title>
      <source>Journal of Chemical Theory and Computation</source>
      <publisher-name>American Chemical Society</publisher-name>
      <year iso-8601-date="2023-06">2023</year><month>06</month>
      <date-in-citation content-type="access-date"><year iso-8601-date="2023-11-15">2023</year><month>11</month><day>15</day></date-in-citation>
      <volume>19</volume>
      <issue>12</issue>
      <issn>1549-9618</issn>
      <pub-id pub-id-type="doi">10.1021/acs.jctc.3c00198</pub-id>
      <fpage>3429</fpage>
      <lpage>3445</lpage>
    </element-citation>
  </ref>
  <ref id="ref-kwon2024Equilipy">
    <element-citation publication-type="article-journal">
      <person-group person-group-type="author">
        <name><surname>Kwon</surname><given-names>Sun Yong</given-names></name>
        <name><surname>Thibodeau</surname><given-names>Eric</given-names></name>
        <name><surname>Plotkowski</surname><given-names>Alex</given-names></name>
        <name><surname>Yang</surname><given-names>Ying</given-names></name>
      </person-group>
      <article-title>Equilipy: A python package for calculating phase equilibria</article-title>
      <source>Journal of Open Source Software</source>
      <year iso-8601-date="2024-08">2024</year><month>08</month>
      <date-in-citation content-type="access-date"><year iso-8601-date="2024-10-14">2024</year><month>10</month><day>14</day></date-in-citation>
      <volume>9</volume>
      <issue>100</issue>
      <issn>2475-9066</issn>
      <pub-id pub-id-type="doi">10.21105/joss.06875</pub-id>
      <fpage>6875</fpage>
      <lpage></lpage>
    </element-citation>
  </ref>
  <ref id="ref-lam2015Numba">
    <element-citation publication-type="paper-conference">
      <person-group person-group-type="author">
        <name><surname>Lam</surname><given-names>Siu Kwan</given-names></name>
        <name><surname>Pitrou</surname><given-names>Antoine</given-names></name>
        <name><surname>Seibert</surname><given-names>Stanley</given-names></name>
      </person-group>
      <article-title>Numba: A LLVM-based Python JIT compiler</article-title>
      <source>Proceedings of the Second Workshop on the LLVM Compiler Infrastructure in HPC</source>
      <publisher-name>ACM</publisher-name>
      <publisher-loc>Austin Texas</publisher-loc>
      <year iso-8601-date="2015-11">2015</year><month>11</month>
      <date-in-citation content-type="access-date"><year iso-8601-date="2024-08-12">2024</year><month>08</month><day>12</day></date-in-citation>
      <isbn>978-1-4503-4005-2</isbn>
      <pub-id pub-id-type="doi">10.1145/2833157.2833162</pub-id>
      <fpage>1</fpage>
      <lpage>6</lpage>
    </element-citation>
  </ref>
  <ref id="ref-li2020Implementation">
    <element-citation publication-type="article-journal">
      <person-group person-group-type="author">
        <name><surname>Li</surname><given-names>Jing</given-names></name>
        <name><surname>Sundman</surname><given-names>Bo</given-names></name>
        <name><surname>Winkelman</surname><given-names>Jozef G. M.</given-names></name>
        <name><surname>Vakis</surname><given-names>Antonis I.</given-names></name>
        <name><surname>Picchioni</surname><given-names>Francesco</given-names></name>
      </person-group>
      <article-title>Implementation of the UNIQUAC model in the OpenCalphad software</article-title>
      <source>Fluid Phase Equilibria</source>
      <year iso-8601-date="2020-03">2020</year><month>03</month>
      <date-in-citation content-type="access-date"><year iso-8601-date="2024-12-11">2024</year><month>12</month><day>11</day></date-in-citation>
      <volume>507</volume>
      <issn>0378-3812</issn>
      <pub-id pub-id-type="doi">10.1016/j.fluid.2019.112398</pub-id>
      <fpage>112398</fpage>
      <lpage></lpage>
    </element-citation>
  </ref>
  <ref id="ref-lukas2007Computational">
    <element-citation publication-type="book">
      <person-group person-group-type="author">
        <name><surname>Lukas</surname><given-names>Hans Leo</given-names></name>
        <name><surname>Fries</surname><given-names>Suzana G.</given-names></name>
        <name><surname>Sundman</surname><given-names>Bo</given-names></name>
      </person-group>
      <source>Computational thermodynamics: The Calphad method</source>
      <publisher-name>Cambridge University Press</publisher-name>
      <publisher-loc>Cambridge</publisher-loc>
      <year iso-8601-date="2007">2007</year>
      <isbn>978-0-521-86811-2</isbn>
    </element-citation>
  </ref>
  <ref id="ref-mao2019Phase">
    <element-citation publication-type="article-journal">
      <person-group person-group-type="author">
        <name><surname>Mao</surname><given-names>Sheng</given-names></name>
        <name><surname>Kuldinow</surname><given-names>Derek</given-names></name>
        <name><surname>Haataja</surname><given-names>Mikko P.</given-names></name>
        <name><surname>Košmrlj</surname><given-names>Andrej</given-names></name>
      </person-group>
      <article-title>Phase behavior and morphology of multicomponent liquid mixtures</article-title>
      <source>Soft Matter</source>
      <publisher-name>The Royal Society of Chemistry</publisher-name>
      <year iso-8601-date="2019-02">2019</year><month>02</month>
      <date-in-citation content-type="access-date"><year iso-8601-date="2023-06-21">2023</year><month>06</month><day>21</day></date-in-citation>
      <volume>15</volume>
      <issue>6</issue>
      <issn>1744-6848</issn>
      <pub-id pub-id-type="doi">10.1039/C8SM02045K</pub-id>
      <fpage>1297</fpage>
      <lpage>1311</lpage>
    </element-citation>
  </ref>
  <ref id="ref-otis2017Pycalphad">
    <element-citation publication-type="article-journal">
      <person-group person-group-type="author">
        <name><surname>Otis</surname><given-names>Richard</given-names></name>
        <name><surname>Liu</surname><given-names>Zi-Kui</given-names></name>
      </person-group>
      <article-title>Pycalphad: CALPHAD-based Computational Thermodynamics in Python</article-title>
      <source>Journal of Open Research Software</source>
      <year iso-8601-date="2017-01">2017</year><month>01</month>
      <date-in-citation content-type="access-date"><year iso-8601-date="2024-08-27">2024</year><month>08</month><day>27</day></date-in-citation>
      <volume>5</volume>
      <issue>1</issue>
      <issn>2049-9647</issn>
      <pub-id pub-id-type="doi">10.5334/jors.140</pub-id>
    </element-citation>
  </ref>
  <ref id="ref-qiang2024Scaling">
    <element-citation>
      <person-group person-group-type="author">
        <name><surname>Qiang</surname><given-names>Yicheng</given-names></name>
        <name><surname>Luo</surname><given-names>Chengjie</given-names></name>
        <name><surname>Zwicker</surname><given-names>David</given-names></name>
      </person-group>
      <article-title>Scaling of phase count in multicomponent liquids</article-title>
      <publisher-name>arXiv</publisher-name>
      <year iso-8601-date="2024-05">2024</year><month>05</month>
      <date-in-citation content-type="access-date"><year iso-8601-date="2024-08-12">2024</year><month>08</month><day>12</day></date-in-citation>
      <uri>https://arxiv.org/abs/2405.01138</uri>
    </element-citation>
  </ref>
  <ref id="ref-shrinivas2021Phase">
    <element-citation publication-type="article-journal">
      <person-group person-group-type="author">
        <name><surname>Shrinivas</surname><given-names>Krishna</given-names></name>
        <name><surname>Brenner</surname><given-names>Michael P.</given-names></name>
      </person-group>
      <article-title>Phase separation in fluids with many interacting components</article-title>
      <source>Proceedings of the National Academy of Sciences</source>
      <publisher-name>Proceedings of the National Academy of Sciences</publisher-name>
      <year iso-8601-date="2021-11">2021</year><month>11</month>
      <date-in-citation content-type="access-date"><year iso-8601-date="2023-06-21">2023</year><month>06</month><day>21</day></date-in-citation>
      <volume>118</volume>
      <issue>45</issue>
      <pub-id pub-id-type="doi">10.1073/pnas.2108551118</pub-id>
      <fpage>e2108551118</fpage>
      <lpage></lpage>
    </element-citation>
  </ref>
  <ref id="ref-sundman2015OpenCalphad">
    <element-citation publication-type="article-journal">
      <person-group person-group-type="author">
        <name><surname>Sundman</surname><given-names>Bo</given-names></name>
        <name><surname>Kattner</surname><given-names>Ursula R.</given-names></name>
        <name><surname>Palumbo</surname><given-names>Mauro</given-names></name>
        <name><surname>Fries</surname><given-names>Suzana G.</given-names></name>
      </person-group>
      <article-title>OpenCalphad - a free thermodynamic software</article-title>
      <source>Integrating Materials and Manufacturing Innovation</source>
      <year iso-8601-date="2015-12">2015</year><month>12</month>
      <date-in-citation content-type="access-date"><year iso-8601-date="2025-01-15">2025</year><month>01</month><day>15</day></date-in-citation>
      <volume>4</volume>
      <issue>1</issue>
      <issn>2193-9772</issn>
      <pub-id pub-id-type="doi">10.1186/s40192-014-0029-1</pub-id>
      <fpage>1</fpage>
      <lpage>15</lpage>
    </element-citation>
  </ref>
  <ref id="ref-tse2022SurfinPy">
    <element-citation publication-type="article-journal">
      <person-group person-group-type="author">
        <name><surname>Tse</surname><given-names>Joshua S.</given-names></name>
        <name><surname>Molinari</surname><given-names>Marco</given-names></name>
        <name><surname>Parker</surname><given-names>Stephen C.</given-names></name>
        <name><surname>Symington</surname><given-names>Adam R.</given-names></name>
      </person-group>
      <article-title>SurfinPy 2.0: A Phase Diagram Generator for Surfaces and Bulk Phases</article-title>
      <source>Journal of Open Source Software</source>
      <year iso-8601-date="2022-03">2022</year><month>03</month>
      <date-in-citation content-type="access-date"><year iso-8601-date="2024-10-14">2024</year><month>10</month><day>14</day></date-in-citation>
      <volume>7</volume>
      <issue>71</issue>
      <issn>2475-9066</issn>
      <pub-id pub-id-type="doi">10.21105/joss.04014</pub-id>
      <fpage>4014</fpage>
      <lpage></lpage>
    </element-citation>
  </ref>
  <ref id="ref-virtanen2020SciPy">
    <element-citation publication-type="article-journal">
      <person-group person-group-type="author">
        <name><surname>Virtanen</surname><given-names>Pauli</given-names></name>
        <name><surname>Gommers</surname><given-names>Ralf</given-names></name>
        <name><surname>Oliphant</surname><given-names>Travis E.</given-names></name>
        <name><surname>Haberland</surname><given-names>Matt</given-names></name>
        <name><surname>Reddy</surname><given-names>Tyler</given-names></name>
        <name><surname>Cournapeau</surname><given-names>David</given-names></name>
        <name><surname>Burovski</surname><given-names>Evgeni</given-names></name>
        <name><surname>Peterson</surname><given-names>Pearu</given-names></name>
        <name><surname>Weckesser</surname><given-names>Warren</given-names></name>
        <name><surname>Bright</surname><given-names>Jonathan</given-names></name>
        <name><surname>van der Walt</surname><given-names>Stéfan J.</given-names></name>
        <name><surname>Brett</surname><given-names>Matthew</given-names></name>
        <name><surname>Wilson</surname><given-names>Joshua</given-names></name>
        <name><surname>Millman</surname><given-names>K. Jarrod</given-names></name>
        <name><surname>Mayorov</surname><given-names>Nikolay</given-names></name>
        <name><surname>Nelson</surname><given-names>Andrew R. J.</given-names></name>
        <name><surname>Jones</surname><given-names>Eric</given-names></name>
        <name><surname>Kern</surname><given-names>Robert</given-names></name>
        <name><surname>Larson</surname><given-names>Eric</given-names></name>
        <name><surname>Carey</surname><given-names>C. J.</given-names></name>
        <name><surname>Polat</surname><given-names>İlhan</given-names></name>
        <name><surname>Feng</surname><given-names>Yu</given-names></name>
        <name><surname>Moore</surname><given-names>Eric W.</given-names></name>
        <name><surname>VanderPlas</surname><given-names>Jake</given-names></name>
        <name><surname>Laxalde</surname><given-names>Denis</given-names></name>
        <name><surname>Perktold</surname><given-names>Josef</given-names></name>
        <name><surname>Cimrman</surname><given-names>Robert</given-names></name>
        <name><surname>Henriksen</surname><given-names>Ian</given-names></name>
        <name><surname>Quintero</surname><given-names>E. A.</given-names></name>
        <name><surname>Harris</surname><given-names>Charles R.</given-names></name>
        <name><surname>Archibald</surname><given-names>Anne M.</given-names></name>
        <name><surname>Ribeiro</surname><given-names>Antônio H.</given-names></name>
        <name><surname>Pedregosa</surname><given-names>Fabian</given-names></name>
        <name><surname>van Mulbregt</surname><given-names>Paul</given-names></name>
      </person-group>
      <article-title>SciPy 1.0: Fundamental algorithms for scientific computing in Python</article-title>
      <source>Nature Methods</source>
      <publisher-name>Nature Publishing Group</publisher-name>
      <year iso-8601-date="2020-03">2020</year><month>03</month>
      <date-in-citation content-type="access-date"><year iso-8601-date="2024-10-15">2024</year><month>10</month><day>15</day></date-in-citation>
      <volume>17</volume>
      <issue>3</issue>
      <issn>1548-7105</issn>
      <pub-id pub-id-type="doi">10.1038/s41592-019-0686-2</pub-id>
      <fpage>261</fpage>
      <lpage>272</lpage>
    </element-citation>
  </ref>
  <ref id="ref-white1958Chemical">
    <element-citation publication-type="article-journal">
      <person-group person-group-type="author">
        <name><surname>White</surname><given-names>W. B.</given-names></name>
        <name><surname>Johnson</surname><given-names>S. M.</given-names></name>
        <name><surname>Dantzig</surname><given-names>G. B.</given-names></name>
      </person-group>
      <article-title>Chemical Equilibrium in Complex Mixtures</article-title>
      <source>The Journal of Chemical Physics</source>
      <year iso-8601-date="1958-05">1958</year><month>05</month>
      <date-in-citation content-type="access-date"><year iso-8601-date="2025-01-15">2025</year><month>01</month><day>15</day></date-in-citation>
      <volume>28</volume>
      <issue>5</issue>
      <issn>0021-9606</issn>
      <pub-id pub-id-type="doi">10.1063/1.1744264</pub-id>
      <fpage>751</fpage>
      <lpage>755</lpage>
    </element-citation>
  </ref>
  <ref id="ref-zwicker2022Evolved">
    <element-citation publication-type="article-journal">
      <person-group person-group-type="author">
        <name><surname>Zwicker</surname><given-names>David</given-names></name>
        <name><surname>Laan</surname><given-names>Liedewij</given-names></name>
      </person-group>
      <article-title>Evolved interactions stabilize many coexisting phases in multicomponent liquids</article-title>
      <source>Proceedings of the National Academy of Sciences</source>
      <publisher-name>Proceedings of the National Academy of Sciences</publisher-name>
      <year iso-8601-date="2022-07">2022</year><month>07</month>
      <date-in-citation content-type="access-date"><year iso-8601-date="2023-06-21">2023</year><month>06</month><day>21</day></date-in-citation>
      <volume>119</volume>
      <issue>28</issue>
      <pub-id pub-id-type="doi">10.1073/pnas.2201250119</pub-id>
      <fpage>e2201250119</fpage>
      <lpage></lpage>
    </element-citation>
  </ref>
</ref-list>
</back>
</article>
