<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE article PUBLIC "-//NLM//DTD JATS (Z39.96) Journal Publishing DTD v1.2 20190208//EN"
                  "JATS-publishing1.dtd">
<article xmlns:mml="http://www.w3.org/1998/Math/MathML" xmlns:xlink="http://www.w3.org/1999/xlink" dtd-version="1.2" article-type="other">
<front>
<journal-meta>
<journal-id></journal-id>
<journal-title-group>
<journal-title>Journal of Open Source Software</journal-title>
<abbrev-journal-title>JOSS</abbrev-journal-title>
</journal-title-group>
<issn publication-format="electronic">2475-9066</issn>
<publisher>
<publisher-name>Open Journals</publisher-name>
</publisher>
</journal-meta>
<article-meta>
<article-id pub-id-type="publisher-id">5510</article-id>
<article-id pub-id-type="doi">10.21105/joss.05510</article-id>
<title-group>
<article-title>xinvert: A Python package for inversion problems in
geophysical fluid dynamics</article-title>
</title-group>
<contrib-group>
<contrib contrib-type="author" corresp="yes">
<contrib-id contrib-id-type="orcid">https://orcid.org/0000-0001-5660-7619</contrib-id>
<name>
<surname>Qian</surname>
<given-names>Yu-Kun</given-names>
</name>
<xref ref-type="aff" rid="aff-1"/>
<xref ref-type="corresp" rid="cor-1"><sup>*</sup></xref>
</contrib>
<aff id="aff-1">
<institution-wrap>
<institution>State Key Laboratory of Tropical Oceanography, South China
Sea Institute of Oceanology, Chinese Academy of Sciences, Guangzhou,
China</institution>
</institution-wrap>
</aff>
</contrib-group>
<author-notes>
<corresp id="cor-1">* E-mail: <email></email></corresp>
</author-notes>
<pub-date date-type="pub" publication-format="electronic" iso-8601-date="2023-04-23">
<day>23</day>
<month>4</month>
<year>2023</year>
</pub-date>
<volume>8</volume>
<issue>89</issue>
<fpage>5510</fpage>
<permissions>
<copyright-statement>Authors of papers retain copyright and release the
work under a Creative Commons Attribution 4.0 International License (CC
BY 4.0)</copyright-statement>
<copyright-year>2022</copyright-year>
<copyright-holder>The article authors</copyright-holder>
<license license-type="open-access" xlink:href="https://creativecommons.org/licenses/by/4.0/">
<license-p>Authors of papers retain copyright and release the work under
a Creative Commons Attribution 4.0 International License (CC BY
4.0)</license-p>
</license>
</permissions>
<kwd-group kwd-group-type="author">
<kwd>Python</kwd>
<kwd>geophysics</kwd>
<kwd>atmosphere</kwd>
<kwd>ocean</kwd>
<kwd>geophysical fluid dynamics</kwd>
<kwd>steady state problem</kwd>
<kwd>second-order partial differential equation</kwd>
<kwd>successive over relaxation</kwd>
</kwd-group>
</article-meta>
</front>
<body>
<sec id="statement-of-need">
  <title>Statement of need</title>
  <p>Many problems in meteorology and oceanography can be cast into a
  balanced model in the form of a partial differential equation (PDE).
  The most well-known one is the relation between the stream function
  <inline-formula><alternatives>
  <tex-math><![CDATA[\psi]]></tex-math>
  <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:mi>ψ</mml:mi></mml:math></alternatives></inline-formula>
  and the vertical vorticity <inline-formula><alternatives>
  <tex-math><![CDATA[\zeta]]></tex-math>
  <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:mi>ζ</mml:mi></mml:math></alternatives></inline-formula>
  (also known as Poisson equation):</p>
  <p><disp-formula><alternatives>
  <tex-math><![CDATA[\nabla^2 \psi = \frac{\partial^2 \psi}{\partial y^2}+\frac{\partial^2 \psi}{\partial y^2} = \zeta]]></tex-math>
  <mml:math display="block" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:mrow><mml:msup><mml:mi>∇</mml:mi><mml:mn>2</mml:mn></mml:msup><mml:mi>ψ</mml:mi><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:msup><mml:mi>∂</mml:mi><mml:mn>2</mml:mn></mml:msup><mml:mi>ψ</mml:mi></mml:mrow><mml:mrow><mml:mi>∂</mml:mi><mml:msup><mml:mi>y</mml:mi><mml:mn>2</mml:mn></mml:msup></mml:mrow></mml:mfrac><mml:mo>+</mml:mo><mml:mfrac><mml:mrow><mml:msup><mml:mi>∂</mml:mi><mml:mn>2</mml:mn></mml:msup><mml:mi>ψ</mml:mi></mml:mrow><mml:mrow><mml:mi>∂</mml:mi><mml:msup><mml:mi>y</mml:mi><mml:mn>2</mml:mn></mml:msup></mml:mrow></mml:mfrac><mml:mo>=</mml:mo><mml:mi>ζ</mml:mi></mml:mrow></mml:math></alternatives></disp-formula></p>
  <p>Once <inline-formula><alternatives>
  <tex-math><![CDATA[\zeta]]></tex-math>
  <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:mi>ζ</mml:mi></mml:math></alternatives></inline-formula>
  is given as a known, one needs to get the unknown
  <inline-formula><alternatives>
  <tex-math><![CDATA[\psi]]></tex-math>
  <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:mi>ψ</mml:mi></mml:math></alternatives></inline-formula>
  with proper boundary conditions, which is essentially an inversion
  problem (<xref alt="[fig:1]" rid="figU003A1">[fig:1]</xref>). Many
  geophysical fluid dynamical (GFD) problems can be described by such a
  balanced model, which is generally of second (or fourth) order in
  spatial derivatives and does not depend explicitly on time. Therefore,
  it is also known as a steady-state model. Early scientists tried to
  find analytical solutions by simplifying the parameters of these
  models (e.g., assuming constant coefficients). Nowadays, with the new
  developments in numerical algorithms and parallel-computing
  programming, one may need a modern solver, written in a popular
  programming language like <monospace>Python</monospace>, to invert all
  these models in a numerical fashion. More specifically, the following
  needs should be satisfied:</p>
  <list list-type="bullet">
    <list-item>
      <p><bold>A unified numerical solver:</bold> It can solve all of
      the classical balanced GFD models, even in a domain with irregular
      boundaries like the ocean. New models can also be adapted
      straightforwardly to fit the solver;</p>
    </list-item>
    <list-item>
      <p><bold>Thinking and coding in equations:</bold> Users focus
      naturally on the key inputs and outputs of the GFD models, just
      like thinking of the knowns and unknowns of the PDEs;</p>
    </list-item>
    <list-item>
      <p><bold>Flexible parameter specification:</bold> Coefficients of
      the models can be either constant, 1D vectors, or ND arrays. This
      allows an easy reproduction of early simplified results and also
      an extension to more general/realistic results;</p>
    </list-item>
    <list-item>
      <p><bold>Fast and efficient:</bold> The algorithm should be fast
      and efficient. Also, the code can be compiled first and then
      executed as fast as <monospace>C</monospace> or
      <monospace>FORTRAN</monospace>, instead of executed in the slow
      pure <monospace>Python</monospace> interpreter. In addition, it
      can leverage the multi-core and out-of-core computational
      capabilities of modern computers;</p>
    </list-item>
  </list>
  <p><monospace>xinvert</monospace> is designed to satisfy all of the
  above needs, based on the <monospace>Python</monospace> ecosystem.</p>
  <fig>
    <caption><p>(a) Vertical relative vorticity
    <inline-formula><alternatives>
    <tex-math><![CDATA[\zeta]]></tex-math>
    <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:mi>ζ</mml:mi></mml:math></alternatives></inline-formula>
    and (b) the inverted streamfunction <inline-formula><alternatives>
    <tex-math><![CDATA[\psi]]></tex-math>
    <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:mi>ψ</mml:mi></mml:math></alternatives></inline-formula>
    (shading) with current vector superimposed. Note the irregular
    boundaries over the global ocean.
    <styled-content id="figU003A1"></styled-content></p></caption>
    <graphic mimetype="image" mime-subtype="png" xlink:href="media/streamfunction.png" />
  </fig>
</sec>
<sec id="state-of-the-field">
  <title>State of the field</title>
  <p>There are also several PDE solvers written in Python, like
  <bold>windspharm</bold>
  (<xref alt="Dawson, 2016" rid="ref-DawsonU003A2016" ref-type="bibr">Dawson,
  2016</xref>) and <bold>Dedalus</bold>
  (<xref alt="Burns et al., 2020" rid="ref-BurnsU003A2020" ref-type="bibr">Burns
  et al., 2020</xref>). While they are efficient and accurate in
  double-periodic or global domains using the spectral method, they may
  not be suitable for arbitrary domains or boundaries like the ocean
  (Gibbs phenomenon will arise near ocean boundaries). Also, it is not
  easy to apply these solvers to more general elliptic equations with
  arbitrary coefficients (sometimes given in a numerical or discretized
  fashion). In these cases, the successive over relaxation (SOR) method
  should be a better choice.</p>
</sec>
<sec id="mathematics">
  <title>Mathematics</title>
  <p>This package, <monospace>xinvert</monospace>, is designed to invert
  or solve the following PDE in an abstract form:</p>
  <p><named-content id="eqU003A1" content-type="equation"><disp-formula><alternatives>
  <tex-math><![CDATA[L\left(\psi \right) = F   \tag{1}]]></tex-math>
  <mml:math display="block" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:mrow><mml:mi>L</mml:mi><mml:mrow><mml:mo stretchy="true" form="prefix">(</mml:mo><mml:mi>ψ</mml:mi><mml:mo stretchy="true" form="postfix">)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mi>F</mml:mi></mml:mrow></mml:math></alternatives></disp-formula></named-content></p>
  <p>where <inline-formula><alternatives>
  <tex-math><![CDATA[L]]></tex-math>
  <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:mi>L</mml:mi></mml:math></alternatives></inline-formula>
  is a second-order partial differential operator,
  <inline-formula><alternatives>
  <tex-math><![CDATA[\psi]]></tex-math>
  <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:mi>ψ</mml:mi></mml:math></alternatives></inline-formula>
  the unknown to be inverted for, and <inline-formula><alternatives>
  <tex-math><![CDATA[F]]></tex-math>
  <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:mi>F</mml:mi></mml:math></alternatives></inline-formula>
  a prescribed forcing function. There could be also some coefficients
  or parameters in the definition of <inline-formula><alternatives>
  <tex-math><![CDATA[L]]></tex-math>
  <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:mi>L</mml:mi></mml:math></alternatives></inline-formula>,
  which should be specified before inverting
  <inline-formula><alternatives>
  <tex-math><![CDATA[\psi]]></tex-math>
  <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:mi>ψ</mml:mi></mml:math></alternatives></inline-formula>.</p>
  <p>For the 2D case, the <bold>general form</bold> of Eq.
  <xref alt="1" rid="eqU003A1">1</xref> is:</p>
  <p><named-content id="eqU003A2" content-type="equation"><disp-formula><alternatives>
  <tex-math><![CDATA[L\left(\psi\right) \equiv A_1\frac{\partial^2 \psi}{\partial y^2}+A_2\frac{\partial^2 \psi}{\partial y \partial x}+A_3\frac{\partial^2 \psi}{\partial x^2}+A_4\frac{\partial \psi}{\partial y}+A_5\frac{\partial \psi}{\partial x}+A_6\psi = F  \tag{2}]]></tex-math>
  <mml:math display="block" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:mrow><mml:mi>L</mml:mi><mml:mrow><mml:mo stretchy="true" form="prefix">(</mml:mo><mml:mi>ψ</mml:mi><mml:mo stretchy="true" form="postfix">)</mml:mo></mml:mrow><mml:mo>≡</mml:mo><mml:msub><mml:mi>A</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mfrac><mml:mrow><mml:msup><mml:mi>∂</mml:mi><mml:mn>2</mml:mn></mml:msup><mml:mi>ψ</mml:mi></mml:mrow><mml:mrow><mml:mi>∂</mml:mi><mml:msup><mml:mi>y</mml:mi><mml:mn>2</mml:mn></mml:msup></mml:mrow></mml:mfrac><mml:mo>+</mml:mo><mml:msub><mml:mi>A</mml:mi><mml:mn>2</mml:mn></mml:msub><mml:mfrac><mml:mrow><mml:msup><mml:mi>∂</mml:mi><mml:mn>2</mml:mn></mml:msup><mml:mi>ψ</mml:mi></mml:mrow><mml:mrow><mml:mi>∂</mml:mi><mml:mi>y</mml:mi><mml:mi>∂</mml:mi><mml:mi>x</mml:mi></mml:mrow></mml:mfrac><mml:mo>+</mml:mo><mml:msub><mml:mi>A</mml:mi><mml:mn>3</mml:mn></mml:msub><mml:mfrac><mml:mrow><mml:msup><mml:mi>∂</mml:mi><mml:mn>2</mml:mn></mml:msup><mml:mi>ψ</mml:mi></mml:mrow><mml:mrow><mml:mi>∂</mml:mi><mml:msup><mml:mi>x</mml:mi><mml:mn>2</mml:mn></mml:msup></mml:mrow></mml:mfrac><mml:mo>+</mml:mo><mml:msub><mml:mi>A</mml:mi><mml:mn>4</mml:mn></mml:msub><mml:mfrac><mml:mrow><mml:mi>∂</mml:mi><mml:mi>ψ</mml:mi></mml:mrow><mml:mrow><mml:mi>∂</mml:mi><mml:mi>y</mml:mi></mml:mrow></mml:mfrac><mml:mo>+</mml:mo><mml:msub><mml:mi>A</mml:mi><mml:mn>5</mml:mn></mml:msub><mml:mfrac><mml:mrow><mml:mi>∂</mml:mi><mml:mi>ψ</mml:mi></mml:mrow><mml:mrow><mml:mi>∂</mml:mi><mml:mi>x</mml:mi></mml:mrow></mml:mfrac><mml:mo>+</mml:mo><mml:msub><mml:mi>A</mml:mi><mml:mn>6</mml:mn></mml:msub><mml:mi>ψ</mml:mi><mml:mo>=</mml:mo><mml:mi>F</mml:mi></mml:mrow></mml:math></alternatives></disp-formula></named-content></p>
  <p>where coefficients <inline-formula><alternatives>
  <tex-math><![CDATA[A_1-A_6]]></tex-math>
  <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:mrow><mml:msub><mml:mi>A</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>A</mml:mi><mml:mn>6</mml:mn></mml:msub></mml:mrow></mml:math></alternatives></inline-formula>
  are all known. When the condition <inline-formula><alternatives>
  <tex-math><![CDATA[4A_1 A_3-A_2^2>0]]></tex-math>
  <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:mrow><mml:mn>4</mml:mn><mml:msub><mml:mi>A</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:msub><mml:mi>A</mml:mi><mml:mn>3</mml:mn></mml:msub><mml:mo>−</mml:mo><mml:msubsup><mml:mi>A</mml:mi><mml:mn>2</mml:mn><mml:mn>2</mml:mn></mml:msubsup><mml:mo>&gt;</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:math></alternatives></inline-formula>
  is met everywhere in the domain, the above equation is an
  elliptic-type equation. In this case, one can invert
  <inline-formula><alternatives>
  <tex-math><![CDATA[\psi]]></tex-math>
  <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:mi>ψ</mml:mi></mml:math></alternatives></inline-formula>
  using the <bold>SOR</bold> iteration method. When
  <inline-formula><alternatives>
  <tex-math><![CDATA[4A_1 A_3-A_2^2=0]]></tex-math>
  <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:mrow><mml:mn>4</mml:mn><mml:msub><mml:mi>A</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:msub><mml:mi>A</mml:mi><mml:mn>3</mml:mn></mml:msub><mml:mo>−</mml:mo><mml:msubsup><mml:mi>A</mml:mi><mml:mn>2</mml:mn><mml:mn>2</mml:mn></mml:msubsup><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:math></alternatives></inline-formula>
  or <inline-formula><alternatives>
  <tex-math><![CDATA[4A_1 A_3-A_2^2<0]]></tex-math>
  <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:mrow><mml:mn>4</mml:mn><mml:msub><mml:mi>A</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:msub><mml:mi>A</mml:mi><mml:mn>3</mml:mn></mml:msub><mml:mo>−</mml:mo><mml:msubsup><mml:mi>A</mml:mi><mml:mn>2</mml:mn><mml:mn>2</mml:mn></mml:msubsup><mml:mo>&lt;</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:math></alternatives></inline-formula>,
  it is a parabolic or hyperbolic equation. In either case, SOR would
  <italic>fail</italic> to converge to the solution.</p>
  <p>Sometimes the <bold>general form</bold> of Eq.
  <xref alt="2" rid="eqU003A2">2</xref> can be transformed into the
  <bold>standard form</bold> (i.e., standardization):</p>
  <p><named-content id="eqU003A3" content-type="equation"><disp-formula><alternatives>
  <tex-math><![CDATA[L\left(\psi\right) \equiv \frac{\partial}{\partial y}\left(A_1\frac{\partial \psi}{\partial y}+A_2\frac{\partial \psi}{\partial x}\right)+\frac{\partial}{\partial x}\left(A_3\frac{\partial \psi}{\partial y}+A_4\frac{\partial \psi}{\partial x}\right) + A_5\psi = F  \tag{3}]]></tex-math>
  <mml:math display="block" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:mrow><mml:mi>L</mml:mi><mml:mrow><mml:mo stretchy="true" form="prefix">(</mml:mo><mml:mi>ψ</mml:mi><mml:mo stretchy="true" form="postfix">)</mml:mo></mml:mrow><mml:mo>≡</mml:mo><mml:mfrac><mml:mi>∂</mml:mi><mml:mrow><mml:mi>∂</mml:mi><mml:mi>y</mml:mi></mml:mrow></mml:mfrac><mml:mrow><mml:mo stretchy="true" form="prefix">(</mml:mo><mml:msub><mml:mi>A</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mfrac><mml:mrow><mml:mi>∂</mml:mi><mml:mi>ψ</mml:mi></mml:mrow><mml:mrow><mml:mi>∂</mml:mi><mml:mi>y</mml:mi></mml:mrow></mml:mfrac><mml:mo>+</mml:mo><mml:msub><mml:mi>A</mml:mi><mml:mn>2</mml:mn></mml:msub><mml:mfrac><mml:mrow><mml:mi>∂</mml:mi><mml:mi>ψ</mml:mi></mml:mrow><mml:mrow><mml:mi>∂</mml:mi><mml:mi>x</mml:mi></mml:mrow></mml:mfrac><mml:mo stretchy="true" form="postfix">)</mml:mo></mml:mrow><mml:mo>+</mml:mo><mml:mfrac><mml:mi>∂</mml:mi><mml:mrow><mml:mi>∂</mml:mi><mml:mi>x</mml:mi></mml:mrow></mml:mfrac><mml:mrow><mml:mo stretchy="true" form="prefix">(</mml:mo><mml:msub><mml:mi>A</mml:mi><mml:mn>3</mml:mn></mml:msub><mml:mfrac><mml:mrow><mml:mi>∂</mml:mi><mml:mi>ψ</mml:mi></mml:mrow><mml:mrow><mml:mi>∂</mml:mi><mml:mi>y</mml:mi></mml:mrow></mml:mfrac><mml:mo>+</mml:mo><mml:msub><mml:mi>A</mml:mi><mml:mn>4</mml:mn></mml:msub><mml:mfrac><mml:mrow><mml:mi>∂</mml:mi><mml:mi>ψ</mml:mi></mml:mrow><mml:mrow><mml:mi>∂</mml:mi><mml:mi>x</mml:mi></mml:mrow></mml:mfrac><mml:mo stretchy="true" form="postfix">)</mml:mo></mml:mrow><mml:mo>+</mml:mo><mml:msub><mml:mi>A</mml:mi><mml:mn>5</mml:mn></mml:msub><mml:mi>ψ</mml:mi><mml:mo>=</mml:mo><mml:mi>F</mml:mi></mml:mrow></mml:math></alternatives></disp-formula></named-content></p>
  <p>In this case, <inline-formula><alternatives>
  <tex-math><![CDATA[A_1 A_4-A_2 A_3>0]]></tex-math>
  <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:mrow><mml:msub><mml:mi>A</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:msub><mml:mi>A</mml:mi><mml:mn>4</mml:mn></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>A</mml:mi><mml:mn>2</mml:mn></mml:msub><mml:msub><mml:mi>A</mml:mi><mml:mn>3</mml:mn></mml:msub><mml:mo>&gt;</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:math></alternatives></inline-formula>
  should be met to ensure its ellipticity. The elliptic condition has
  its own physical meaning in the problems of interest. That is, the
  system is in a steady (or balanced) state that is stable to any small
  perturbation.</p>
  <p>Many problems in meteorology and oceanography can be cast into the
  forms of either Eq. <xref alt="2" rid="eqU003A2">2</xref> or Eq.
  <xref alt="3" rid="eqU003A3">3</xref>. However, some of them are
  formulated in a 3D form (like the QG-omega equation):</p>
  <p><named-content id="eqU003A4" content-type="equation"><disp-formula><alternatives>
  <tex-math><![CDATA[L\left(\psi\right) \equiv \frac{\partial}{\partial z}\left(A_1\frac{\partial \psi}{\partial z}\right) +\frac{\partial}{\partial y}\left(A_2\frac{\partial \psi}{\partial y}\right) +\frac{\partial}{\partial x}\left(A_3\frac{\partial \psi}{\partial x}\right) = F  \tag{4}]]></tex-math>
  <mml:math display="block" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:mrow><mml:mi>L</mml:mi><mml:mrow><mml:mo stretchy="true" form="prefix">(</mml:mo><mml:mi>ψ</mml:mi><mml:mo stretchy="true" form="postfix">)</mml:mo></mml:mrow><mml:mo>≡</mml:mo><mml:mfrac><mml:mi>∂</mml:mi><mml:mrow><mml:mi>∂</mml:mi><mml:mi>z</mml:mi></mml:mrow></mml:mfrac><mml:mrow><mml:mo stretchy="true" form="prefix">(</mml:mo><mml:msub><mml:mi>A</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mfrac><mml:mrow><mml:mi>∂</mml:mi><mml:mi>ψ</mml:mi></mml:mrow><mml:mrow><mml:mi>∂</mml:mi><mml:mi>z</mml:mi></mml:mrow></mml:mfrac><mml:mo stretchy="true" form="postfix">)</mml:mo></mml:mrow><mml:mo>+</mml:mo><mml:mfrac><mml:mi>∂</mml:mi><mml:mrow><mml:mi>∂</mml:mi><mml:mi>y</mml:mi></mml:mrow></mml:mfrac><mml:mrow><mml:mo stretchy="true" form="prefix">(</mml:mo><mml:msub><mml:mi>A</mml:mi><mml:mn>2</mml:mn></mml:msub><mml:mfrac><mml:mrow><mml:mi>∂</mml:mi><mml:mi>ψ</mml:mi></mml:mrow><mml:mrow><mml:mi>∂</mml:mi><mml:mi>y</mml:mi></mml:mrow></mml:mfrac><mml:mo stretchy="true" form="postfix">)</mml:mo></mml:mrow><mml:mo>+</mml:mo><mml:mfrac><mml:mi>∂</mml:mi><mml:mrow><mml:mi>∂</mml:mi><mml:mi>x</mml:mi></mml:mrow></mml:mfrac><mml:mrow><mml:mo stretchy="true" form="prefix">(</mml:mo><mml:msub><mml:mi>A</mml:mi><mml:mn>3</mml:mn></mml:msub><mml:mfrac><mml:mrow><mml:mi>∂</mml:mi><mml:mi>ψ</mml:mi></mml:mrow><mml:mrow><mml:mi>∂</mml:mi><mml:mi>x</mml:mi></mml:mrow></mml:mfrac><mml:mo stretchy="true" form="postfix">)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mi>F</mml:mi></mml:mrow></mml:math></alternatives></disp-formula></named-content></p>
  <p>or in <bold>fourth-order</bold> form (the Munk model):</p>
  <p><named-content id="eqU003A5" content-type="equation"><disp-formula><tex-math><![CDATA[
  \begin{aligned}
  L\left(\psi\right) &\equiv A_1\frac{\partial^4 \psi}{\partial y^4}+A_2\frac{\partial^4 \psi}{\partial y^2 \partial x^2}+A_3\frac{\partial^4 \psi}{\partial x^4} \notag\\
  &+A_4\frac{\partial^2 \psi}{\partial y^2}+A_5\frac{\partial^2 \psi}{\partial y \partial x}+A_6\frac{\partial^2 \psi}{\partial x^2}+A_7\frac{\partial \psi}{\partial y}+A_8\frac{\partial \psi}{\partial x}+A_9\psi = F 
  \end{aligned} \tag{5}
  ]]></tex-math></disp-formula></named-content></p>
  <p>So we implement four basic solvers to take into account the above
  equations <xref alt="2" rid="eqU003A2">2</xref> to
  <xref alt="5" rid="eqU003A5">5</xref>. Most of the problems fit one of
  these four types of solver. However, it is not clear which form, the
  general form Eq. <xref alt="2" rid="eqU003A2">2</xref> or the standard
  form Eq. <xref alt="3" rid="eqU003A3">3</xref>, is preferred for the
  inversion if a problem can be cast into either one.</p>
</sec>
<sec id="summary">
  <title>Summary</title>
  <p><monospace>xinvert</monospace> is an open-source and user-friendly
  <monospace>Python</monospace> package that enables GFD scientists or
  interested amateurs to solve all possible GFD problems in a numerical
  fashion. With the ecosystem of open-source
  <monospace>Python</monospace> packages, in particular
  <monospace>xarray</monospace>
  (<xref alt="Hoyer &amp; Hamman, 2017" rid="ref-HoyerU003A2017" ref-type="bibr">Hoyer
  &amp; Hamman, 2017</xref>), <monospace>dask</monospace>
  (<xref alt="Rocklin, 2015" rid="ref-RocklinU003A2015" ref-type="bibr">Rocklin,
  2015</xref>), and <monospace>numba</monospace>
  (<xref alt="Lam et al., 2015" rid="ref-LamU003A2015" ref-type="bibr">Lam
  et al., 2015</xref>), it is able to satisfy the above
  requirements:</p>
  <list list-type="bullet">
    <list-item>
      <p>All the classical balanced GFD models can be inverted by this
      unified numerical solver;</p>
    </list-item>
    <list-item>
      <p>User APIs
      (<xref alt="Table 1" rid="tableU003A1">Table 1</xref>) are very
      close to the equations: unknowns are on the left-hand side of the
      equal sign <monospace>=</monospace>, whereas the known forcing
      functions are on its right-hand side (other known coefficients are
      also on the left-hand side but are passed in through
      <monospace>mParams</monospace>);</p>
    </list-item>
    <list-item>
      <p>Passing a single <monospace>xarray.DataArray</monospace> is
      usually enough for the inversion. The fact that coordinate
      information is already encapsulated reduces the length of the
      parameter list. In addition, parameters in
      <monospace>mParams</monospace> can be either a constant, or
      varying with a specific dimension (like the Coriolis parameter
      <inline-formula><alternatives>
      <tex-math><![CDATA[f]]></tex-math>
      <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:mi>f</mml:mi></mml:math></alternatives></inline-formula>),
      or fully varying with space and time, due to the use of
      <monospace>xarray</monospace>’s
      (<xref alt="Hoyer &amp; Hamman, 2017" rid="ref-HoyerU003A2017" ref-type="bibr">Hoyer
      &amp; Hamman, 2017</xref>) broadcasting capability;</p>
    </list-item>
    <list-item>
      <p>This package leverages <monospace>numba</monospace>
      (<xref alt="Lam et al., 2015" rid="ref-LamU003A2015" ref-type="bibr">Lam
      et al., 2015</xref>) and <monospace>dask</monospace>
      (<xref alt="Rocklin, 2015" rid="ref-RocklinU003A2015" ref-type="bibr">Rocklin,
      2015</xref>) to support Just-In-Time (JIT) compilation,
      multi-core, and out-of-core computations, and therefore greatly
      increases the speed and efficiency of the inversion.</p>
    </list-item>
  </list>
  <p>Here we summarize some inversion problems in meteorology and
  oceanography into
  <xref alt="Table 1" rid="tableU003A1">Table 1</xref>. The table can be
  extended further if one finds more problems that fit the abstract form
  of Eq. <xref alt="1" rid="eqU003A1">1</xref>.</p>
  <table-wrap>
    <caption>
      <p>Classical inversion problems in GFD. The model names,
      equations, typical references and function calls are listed
      <styled-content id="tableU003A1"></styled-content></p>
    </caption>
    <table>
      <colgroup>
        <col width="50%" />
        <col width="50%" />
      </colgroup>
      <thead>
        <tr>
          <th align="left">Problem names and equations</th>
          <th align="right">Function calls</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td align="left">Streamfunction <inline-formula><alternatives>
          <tex-math><![CDATA[\displaystyle{\nabla^2\psi=\frac{\partial^2 \psi}{\partial y^2}+\frac{\partial^2 \psi}{\partial x^2}=\zeta_k}]]></tex-math>
          <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:mrow><mml:msup><mml:mi>∇</mml:mi><mml:mn>2</mml:mn></mml:msup><mml:mi>ψ</mml:mi><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:msup><mml:mi>∂</mml:mi><mml:mn>2</mml:mn></mml:msup><mml:mi>ψ</mml:mi></mml:mrow><mml:mrow><mml:mi>∂</mml:mi><mml:msup><mml:mi>y</mml:mi><mml:mn>2</mml:mn></mml:msup></mml:mrow></mml:mfrac><mml:mo>+</mml:mo><mml:mfrac><mml:mrow><mml:msup><mml:mi>∂</mml:mi><mml:mn>2</mml:mn></mml:msup><mml:mi>ψ</mml:mi></mml:mrow><mml:mrow><mml:mi>∂</mml:mi><mml:msup><mml:mi>x</mml:mi><mml:mn>2</mml:mn></mml:msup></mml:mrow></mml:mfrac><mml:mo>=</mml:mo><mml:msub><mml:mi>ζ</mml:mi><mml:mi>k</mml:mi></mml:msub></mml:mrow></mml:math></alternatives></inline-formula></td>
          <td align="right"><monospace>psi = invert_Poisson(vork,</monospace><monospace>dims=['Y','X'],</monospace><monospace>mParams=None)</monospace>
          </td>
        </tr>
        <tr>
          <td align="left">Balanced mass field
          (<xref alt="Yuan et al., 2008" rid="ref-YuanU003A2008" ref-type="bibr">Yuan
          et al., 2008</xref>) <inline-formula><alternatives>
          <tex-math><![CDATA[\displaystyle{\nabla^2\Phi=\frac{\partial^2 \Phi}{\partial y^2}+\frac{\partial^2 \Phi}{\partial x^2}=F}]]></tex-math>
          <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:mrow><mml:msup><mml:mi>∇</mml:mi><mml:mn>2</mml:mn></mml:msup><mml:mi>Φ</mml:mi><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:msup><mml:mi>∂</mml:mi><mml:mn>2</mml:mn></mml:msup><mml:mi>Φ</mml:mi></mml:mrow><mml:mrow><mml:mi>∂</mml:mi><mml:msup><mml:mi>y</mml:mi><mml:mn>2</mml:mn></mml:msup></mml:mrow></mml:mfrac><mml:mo>+</mml:mo><mml:mfrac><mml:mrow><mml:msup><mml:mi>∂</mml:mi><mml:mn>2</mml:mn></mml:msup><mml:mi>Φ</mml:mi></mml:mrow><mml:mrow><mml:mi>∂</mml:mi><mml:msup><mml:mi>x</mml:mi><mml:mn>2</mml:mn></mml:msup></mml:mrow></mml:mfrac><mml:mo>=</mml:mo><mml:mi>F</mml:mi></mml:mrow></mml:math></alternatives></inline-formula></td>
          <td align="right"><monospace>Phi = invert_Poisson(F,</monospace><monospace>dims=['Y','X'],</monospace><monospace>mParams=None)</monospace>
          </td>
        </tr>
        <tr>
          <td align="left">Geostrophic streamfunction
          <inline-formula><alternatives>
          <tex-math><![CDATA[\displaystyle{\frac{\partial}{\partial y}\left(f\frac{\partial \psi}{\partial y}\right)+\frac{\partial}{\partial x}\left(f\frac{\partial \psi}{\partial x}\right)=\nabla^2 \Phi}]]></tex-math>
          <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:mrow><mml:mfrac><mml:mi>∂</mml:mi><mml:mrow><mml:mi>∂</mml:mi><mml:mi>y</mml:mi></mml:mrow></mml:mfrac><mml:mrow><mml:mo stretchy="true" form="prefix">(</mml:mo><mml:mi>f</mml:mi><mml:mfrac><mml:mrow><mml:mi>∂</mml:mi><mml:mi>ψ</mml:mi></mml:mrow><mml:mrow><mml:mi>∂</mml:mi><mml:mi>y</mml:mi></mml:mrow></mml:mfrac><mml:mo stretchy="true" form="postfix">)</mml:mo></mml:mrow><mml:mo>+</mml:mo><mml:mfrac><mml:mi>∂</mml:mi><mml:mrow><mml:mi>∂</mml:mi><mml:mi>x</mml:mi></mml:mrow></mml:mfrac><mml:mrow><mml:mo stretchy="true" form="prefix">(</mml:mo><mml:mi>f</mml:mi><mml:mfrac><mml:mrow><mml:mi>∂</mml:mi><mml:mi>ψ</mml:mi></mml:mrow><mml:mrow><mml:mi>∂</mml:mi><mml:mi>x</mml:mi></mml:mrow></mml:mfrac><mml:mo stretchy="true" form="postfix">)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:msup><mml:mi>∇</mml:mi><mml:mn>2</mml:mn></mml:msup><mml:mi>Φ</mml:mi></mml:mrow></mml:math></alternatives></inline-formula></td>
          <td align="right"><monospace>psi = invert_geostrophic(LapPhi,</monospace><monospace>dims=['Y','X'],</monospace><monospace>mParams={f})</monospace>
          </td>
        </tr>
        <tr>
          <td align="left">Eliassen model
          (<xref alt="Eliassen, 1952" rid="ref-EliassenU003A1952" ref-type="bibr">Eliassen,
          1952</xref>) <inline-formula><alternatives>
          <tex-math><![CDATA[\displaystyle{\frac{\partial}{\partial p}\left(A\frac{\partial \psi}{\partial p}+B\frac{\partial \psi}{\partial y}\right)+\frac{\partial}{\partial y}\left(B\frac{\partial \psi}{\partial p}+C\frac{\partial \psi}{\partial y}\right)=F}]]></tex-math>
          <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:mrow><mml:mfrac><mml:mi>∂</mml:mi><mml:mrow><mml:mi>∂</mml:mi><mml:mi>p</mml:mi></mml:mrow></mml:mfrac><mml:mrow><mml:mo stretchy="true" form="prefix">(</mml:mo><mml:mi>A</mml:mi><mml:mfrac><mml:mrow><mml:mi>∂</mml:mi><mml:mi>ψ</mml:mi></mml:mrow><mml:mrow><mml:mi>∂</mml:mi><mml:mi>p</mml:mi></mml:mrow></mml:mfrac><mml:mo>+</mml:mo><mml:mi>B</mml:mi><mml:mfrac><mml:mrow><mml:mi>∂</mml:mi><mml:mi>ψ</mml:mi></mml:mrow><mml:mrow><mml:mi>∂</mml:mi><mml:mi>y</mml:mi></mml:mrow></mml:mfrac><mml:mo stretchy="true" form="postfix">)</mml:mo></mml:mrow><mml:mo>+</mml:mo><mml:mfrac><mml:mi>∂</mml:mi><mml:mrow><mml:mi>∂</mml:mi><mml:mi>y</mml:mi></mml:mrow></mml:mfrac><mml:mrow><mml:mo stretchy="true" form="prefix">(</mml:mo><mml:mi>B</mml:mi><mml:mfrac><mml:mrow><mml:mi>∂</mml:mi><mml:mi>ψ</mml:mi></mml:mrow><mml:mrow><mml:mi>∂</mml:mi><mml:mi>p</mml:mi></mml:mrow></mml:mfrac><mml:mo>+</mml:mo><mml:mi>C</mml:mi><mml:mfrac><mml:mrow><mml:mi>∂</mml:mi><mml:mi>ψ</mml:mi></mml:mrow><mml:mrow><mml:mi>∂</mml:mi><mml:mi>y</mml:mi></mml:mrow></mml:mfrac><mml:mo stretchy="true" form="postfix">)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mi>F</mml:mi></mml:mrow></mml:math></alternatives></inline-formula></td>
          <td align="right"><monospace>psi = invert_Eliassen(F,</monospace><monospace>dims=['Z','Y'],</monospace><monospace>mParams={Angm, Thm})</monospace>
          </td>
        </tr>
        <tr>
          <td align="left">PV inversion for vortex
          (<xref alt="Hoskins et al., 1985" rid="ref-HoskinsU003A1985" ref-type="bibr">Hoskins
          et al., 1985</xref>) <inline-formula><alternatives>
          <tex-math><![CDATA[\displaystyle{\frac{\partial}{\partial \theta}\left(\frac{2\Lambda_0}{r^2}\frac{\partial\Lambda}{\partial \theta}\right)+\frac{\partial}{\partial r}\left(\frac{\Gamma g}{Qr}\frac{\partial\Lambda}{\partial r}\right)=0}]]></tex-math>
          <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:mrow><mml:mfrac><mml:mi>∂</mml:mi><mml:mrow><mml:mi>∂</mml:mi><mml:mi>θ</mml:mi></mml:mrow></mml:mfrac><mml:mrow><mml:mo stretchy="true" form="prefix">(</mml:mo><mml:mfrac><mml:mrow><mml:mn>2</mml:mn><mml:msub><mml:mi>Λ</mml:mi><mml:mn>0</mml:mn></mml:msub></mml:mrow><mml:msup><mml:mi>r</mml:mi><mml:mn>2</mml:mn></mml:msup></mml:mfrac><mml:mfrac><mml:mrow><mml:mi>∂</mml:mi><mml:mi>Λ</mml:mi></mml:mrow><mml:mrow><mml:mi>∂</mml:mi><mml:mi>θ</mml:mi></mml:mrow></mml:mfrac><mml:mo stretchy="true" form="postfix">)</mml:mo></mml:mrow><mml:mo>+</mml:mo><mml:mfrac><mml:mi>∂</mml:mi><mml:mrow><mml:mi>∂</mml:mi><mml:mi>r</mml:mi></mml:mrow></mml:mfrac><mml:mrow><mml:mo stretchy="true" form="prefix">(</mml:mo><mml:mfrac><mml:mrow><mml:mi>Γ</mml:mi><mml:mi>g</mml:mi></mml:mrow><mml:mrow><mml:mi>Q</mml:mi><mml:mi>r</mml:mi></mml:mrow></mml:mfrac><mml:mfrac><mml:mrow><mml:mi>∂</mml:mi><mml:mi>Λ</mml:mi></mml:mrow><mml:mrow><mml:mi>∂</mml:mi><mml:mi>r</mml:mi></mml:mrow></mml:mfrac><mml:mo stretchy="true" form="postfix">)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:math></alternatives></inline-formula></td>
          <td align="right"><monospace>angM = invert_RefState(PV,</monospace><monospace>dims=['Z','Y'],</monospace><monospace>mParams={ang0, Gamma})</monospace>
          </td>
        </tr>
        <tr>
          <td align="left">PV inversion for QG flow
          <inline-formula><alternatives>
          <tex-math><![CDATA[\displaystyle{\frac{\partial}{\partial p}\left(\frac{f^2}{N^2}\frac{\partial \psi}{\partial p}\right)+\frac{\partial^2 \psi}{\partial y^2}=q}]]></tex-math>
          <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:mrow><mml:mfrac><mml:mi>∂</mml:mi><mml:mrow><mml:mi>∂</mml:mi><mml:mi>p</mml:mi></mml:mrow></mml:mfrac><mml:mrow><mml:mo stretchy="true" form="prefix">(</mml:mo><mml:mfrac><mml:msup><mml:mi>f</mml:mi><mml:mn>2</mml:mn></mml:msup><mml:msup><mml:mi>N</mml:mi><mml:mn>2</mml:mn></mml:msup></mml:mfrac><mml:mfrac><mml:mrow><mml:mi>∂</mml:mi><mml:mi>ψ</mml:mi></mml:mrow><mml:mrow><mml:mi>∂</mml:mi><mml:mi>p</mml:mi></mml:mrow></mml:mfrac><mml:mo stretchy="true" form="postfix">)</mml:mo></mml:mrow><mml:mo>+</mml:mo><mml:mfrac><mml:mrow><mml:msup><mml:mi>∂</mml:mi><mml:mn>2</mml:mn></mml:msup><mml:mi>ψ</mml:mi></mml:mrow><mml:mrow><mml:mi>∂</mml:mi><mml:msup><mml:mi>y</mml:mi><mml:mn>2</mml:mn></mml:msup></mml:mrow></mml:mfrac><mml:mo>=</mml:mo><mml:mi>q</mml:mi></mml:mrow></mml:math></alternatives></inline-formula></td>
          <td align="right"><monospace>psi = invert_PV2D(PV,</monospace><monospace>dims=['Z','Y'],</monospace><monospace>mParams={f, N2})</monospace>
          </td>
        </tr>
        <tr>
          <td align="left">Gill-Matsuno model
          (<xref alt="Gill, 1980" rid="ref-GillU003A1980" ref-type="bibr">Gill,
          1980</xref>;
          <xref alt="Matsuno, 1966" rid="ref-MatsunoU003A1966" ref-type="bibr">Matsuno,
          1966</xref>) <inline-formula><alternatives>
          <tex-math><![CDATA[\displaystyle{A\frac{\partial^2 \phi}{\partial y^2}+B\frac{\partial^2 \phi}{\partial x^2}+C\frac{\partial \phi}{\partial y}+D\frac{\partial \phi}{\partial x}+E\phi=Q}]]></tex-math>
          <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:mrow><mml:mi>A</mml:mi><mml:mfrac><mml:mrow><mml:msup><mml:mi>∂</mml:mi><mml:mn>2</mml:mn></mml:msup><mml:mi>ϕ</mml:mi></mml:mrow><mml:mrow><mml:mi>∂</mml:mi><mml:msup><mml:mi>y</mml:mi><mml:mn>2</mml:mn></mml:msup></mml:mrow></mml:mfrac><mml:mo>+</mml:mo><mml:mi>B</mml:mi><mml:mfrac><mml:mrow><mml:msup><mml:mi>∂</mml:mi><mml:mn>2</mml:mn></mml:msup><mml:mi>ϕ</mml:mi></mml:mrow><mml:mrow><mml:mi>∂</mml:mi><mml:msup><mml:mi>x</mml:mi><mml:mn>2</mml:mn></mml:msup></mml:mrow></mml:mfrac><mml:mo>+</mml:mo><mml:mi>C</mml:mi><mml:mfrac><mml:mrow><mml:mi>∂</mml:mi><mml:mi>ϕ</mml:mi></mml:mrow><mml:mrow><mml:mi>∂</mml:mi><mml:mi>y</mml:mi></mml:mrow></mml:mfrac><mml:mo>+</mml:mo><mml:mi>D</mml:mi><mml:mfrac><mml:mrow><mml:mi>∂</mml:mi><mml:mi>ϕ</mml:mi></mml:mrow><mml:mrow><mml:mi>∂</mml:mi><mml:mi>x</mml:mi></mml:mrow></mml:mfrac><mml:mo>+</mml:mo><mml:mi>E</mml:mi><mml:mi>ϕ</mml:mi><mml:mo>=</mml:mo><mml:mi>Q</mml:mi></mml:mrow></mml:math></alternatives></inline-formula></td>
          <td align="right"><monospace>phi = invert_GillMatsuno(Q,</monospace><monospace>dims=['Y','X'],</monospace><monospace>mParams={f, epsilon, Phi})</monospace>
          </td>
        </tr>
        <tr>
          <td align="left">Stommel-Munk model
          (<xref alt="Munk, 1950" rid="ref-MunkU003A1950" ref-type="bibr">Munk,
          1950</xref>;
          <xref alt="Stommel, 1948" rid="ref-StommelU003A1948" ref-type="bibr">Stommel,
          1948</xref>) <inline-formula><alternatives>
          <tex-math><![CDATA[\displaystyle{A\nabla^4\psi-\frac{R}{D}\nabla^2\psi-\beta\frac{\partial \psi}{\partial x}=-\frac{\hat\nabla \cdot \vec{\tau} }{\rho_0 D} }]]></tex-math>
          <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:mrow><mml:mi>A</mml:mi><mml:msup><mml:mi>∇</mml:mi><mml:mn>4</mml:mn></mml:msup><mml:mi>ψ</mml:mi><mml:mo>−</mml:mo><mml:mfrac><mml:mi>R</mml:mi><mml:mi>D</mml:mi></mml:mfrac><mml:msup><mml:mi>∇</mml:mi><mml:mn>2</mml:mn></mml:msup><mml:mi>ψ</mml:mi><mml:mo>−</mml:mo><mml:mi>β</mml:mi><mml:mfrac><mml:mrow><mml:mi>∂</mml:mi><mml:mi>ψ</mml:mi></mml:mrow><mml:mrow><mml:mi>∂</mml:mi><mml:mi>x</mml:mi></mml:mrow></mml:mfrac><mml:mo>=</mml:mo><mml:mo>−</mml:mo><mml:mfrac><mml:mrow><mml:mover><mml:mi>∇</mml:mi><mml:mo accent="true">̂</mml:mo></mml:mover><mml:mo>⋅</mml:mo><mml:mover><mml:mi>τ</mml:mi><mml:mo accent="true">⃗</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:msub><mml:mi>ρ</mml:mi><mml:mn>0</mml:mn></mml:msub><mml:mi>D</mml:mi></mml:mrow></mml:mfrac></mml:mrow></mml:math></alternatives></inline-formula></td>
          <td align="right"><monospace>psi = invert_StommelMunk(curl,</monospace><monospace>dims=['Y','X'],</monospace><monospace>mParams={A, R, D, beta, rho})</monospace>
          </td>
        </tr>
        <tr>
          <td align="left">Fofonoff flow
          (<xref alt="Fofonoff, 1954" rid="ref-FofonoffU003A1954" ref-type="bibr">Fofonoff,
          1954</xref>) <inline-formula><alternatives>
          <tex-math><![CDATA[\displaystyle{\nabla^2\psi-c_0\psi=c_1-f}]]></tex-math>
          <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:mrow><mml:msup><mml:mi>∇</mml:mi><mml:mn>2</mml:mn></mml:msup><mml:mi>ψ</mml:mi><mml:mo>−</mml:mo><mml:msub><mml:mi>c</mml:mi><mml:mn>0</mml:mn></mml:msub><mml:mi>ψ</mml:mi><mml:mo>=</mml:mo><mml:msub><mml:mi>c</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo>−</mml:mo><mml:mi>f</mml:mi></mml:mrow></mml:math></alternatives></inline-formula></td>
          <td align="right"><monospace>psi = invert_Fofonoff(f,</monospace><monospace>dims=['Y','X'],</monospace><monospace>mParams={f, c0, c1})</monospace>
          </td>
        </tr>
        <tr>
          <td align="left">Bretherton flow
          (<xref alt="Bretherton &amp; Haidvogel, 1976" rid="ref-BrethertonU003A1976" ref-type="bibr">Bretherton
          &amp; Haidvogel, 1976</xref>) <inline-formula><alternatives>
          <tex-math><![CDATA[\displaystyle{\nabla^2\psi-\lambda D\psi=-\frac{f_0}{D}\eta_B}]]></tex-math>
          <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:mrow><mml:msup><mml:mi>∇</mml:mi><mml:mn>2</mml:mn></mml:msup><mml:mi>ψ</mml:mi><mml:mo>−</mml:mo><mml:mi>λ</mml:mi><mml:mi>D</mml:mi><mml:mi>ψ</mml:mi><mml:mo>=</mml:mo><mml:mo>−</mml:mo><mml:mfrac><mml:msub><mml:mi>f</mml:mi><mml:mn>0</mml:mn></mml:msub><mml:mi>D</mml:mi></mml:mfrac><mml:msub><mml:mi>η</mml:mi><mml:mi>B</mml:mi></mml:msub></mml:mrow></mml:math></alternatives></inline-formula></td>
          <td align="right"><monospace>psi = invert_BrethertonHaidvogel(topo,</monospace><monospace>dims=['Y','X'],</monospace><monospace>mParams={f, D, lambda})</monospace>
          </td>
        </tr>
        <tr>
          <td align="left">QG-Omega equation
          (<xref alt="Hoskins et al., 1978" rid="ref-HoskinsU003A1978" ref-type="bibr">Hoskins
          et al., 1978</xref>) <inline-formula><alternatives>
          <tex-math><![CDATA[\displaystyle{\frac{\partial}{\partial p}\left(f^2\frac{\partial \omega}{\partial p}\right)+\nabla\cdot\left(S\nabla\omega\right)=F}]]></tex-math>
          <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:mrow><mml:mfrac><mml:mi>∂</mml:mi><mml:mrow><mml:mi>∂</mml:mi><mml:mi>p</mml:mi></mml:mrow></mml:mfrac><mml:mrow><mml:mo stretchy="true" form="prefix">(</mml:mo><mml:msup><mml:mi>f</mml:mi><mml:mn>2</mml:mn></mml:msup><mml:mfrac><mml:mrow><mml:mi>∂</mml:mi><mml:mi>ω</mml:mi></mml:mrow><mml:mrow><mml:mi>∂</mml:mi><mml:mi>p</mml:mi></mml:mrow></mml:mfrac><mml:mo stretchy="true" form="postfix">)</mml:mo></mml:mrow><mml:mo>+</mml:mo><mml:mi>∇</mml:mi><mml:mo>⋅</mml:mo><mml:mrow><mml:mo stretchy="true" form="prefix">(</mml:mo><mml:mi>S</mml:mi><mml:mi>∇</mml:mi><mml:mi>ω</mml:mi><mml:mo stretchy="true" form="postfix">)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mi>F</mml:mi></mml:mrow></mml:math></alternatives></inline-formula></td>
          <td align="right"><monospace>w = invert_Omega(F,</monospace><monospace>dims=['Z','Y','X'],</monospace><monospace>mParams={f, S})</monospace>
          </td>
        </tr>
      </tbody>
    </table>
  </table-wrap>
</sec>
<sec id="usage">
  <title>Usage</title>
  <p><monospace>xinvert</monospace> provides a set of functions with a
  prefix <monospace>invert_</monospace>. Users only need to import the
  function they are interested in and call it to get the inverted
  results (<xref alt="Table 1" rid="tableU003A1">Table 1</xref>). Note
  that the calculation of the forcing function
  <inline-formula><alternatives>
  <tex-math><![CDATA[F]]></tex-math>
  <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:mi>F</mml:mi></mml:math></alternatives></inline-formula>
  (e.g., calculating the vorticity using the velocity vector) on the
  right-hand side of the equation is not the core part of this package.
  But there is a <monospace>FiniteDiff</monospace> utility module with
  which finite difference calculus can be readily performed.</p>
</sec>
<sec id="acknowledgements">
  <title>Acknowledgements</title>
  <p>This work is jointly supported by the National Natural Science
  Foundation of China (42376028, 41931182, 41976023), and the support of
  the Independent Research Project Program of State Key Laboratory of
  Tropical Oceanography (LTOZZ2102). The author gratefully acknowledges
  the use of the HPCC at the South China Sea Institute of oceanology,
  Chinese Academy of Sciences.</p>
</sec>
</body>
<back>
<ref-list>
  <ref id="ref-YuanU003A2008">
    <element-citation publication-type="article-journal">
      <person-group person-group-type="author">
        <name><surname>Yuan</surname><given-names>Zhuojian</given-names></name>
        <name><surname>Wu</surname><given-names>Junjie</given-names></name>
        <name><surname>Cheng</surname><given-names>Xuhua</given-names></name>
        <name><surname>Jian</surname><given-names>Maoqiu</given-names></name>
      </person-group>
      <article-title>The derivation of a numerical diagnostic model for the forcing of the geopotential</article-title>
      <source>Quarterly Journal of the Royal Meteorological Society</source>
      <publisher-name>Ubiquity Press</publisher-name>
      <year iso-8601-date="2008">2008</year>
      <volume>134</volume>
      <issue>637</issue>
      <uri>https://doi.org/10.1002/qj.337</uri>
      <pub-id pub-id-type="doi">10.1002/qj.337</pub-id>
      <fpage>2067</fpage>
      <lpage>2078</lpage>
    </element-citation>
  </ref>
  <ref id="ref-EliassenU003A1952">
    <element-citation publication-type="article-journal">
      <person-group person-group-type="author">
        <name><surname>Eliassen</surname><given-names>Arnt</given-names></name>
      </person-group>
      <article-title>Slow thermally or frictionally controlled meridional circulation in a circular vortex</article-title>
      <source>Astrophisica Norvegica</source>
      <publisher-name>Ubiquity Press</publisher-name>
      <year iso-8601-date="1952">1952</year>
      <volume>5</volume>
      <issue>2</issue>
      <fpage>19</fpage>
      <lpage>60</lpage>
    </element-citation>
  </ref>
  <ref id="ref-GillU003A1980">
    <element-citation publication-type="article-journal">
      <person-group person-group-type="author">
        <name><surname>Gill</surname><given-names>A. E.</given-names></name>
      </person-group>
      <article-title>Some simple solutions for heat-induced tropical circulation</article-title>
      <source>Quarterly Journal of the Royal Meteorological Society</source>
      <publisher-name>Ubiquity Press</publisher-name>
      <year iso-8601-date="1980">1980</year>
      <volume>106</volume>
      <issue>449</issue>
      <uri>https://doi.org/10.1002/qj.49710644905</uri>
      <pub-id pub-id-type="doi">10.1002/qj.49710644905</pub-id>
      <fpage>447</fpage>
      <lpage>462</lpage>
    </element-citation>
  </ref>
  <ref id="ref-MatsunoU003A1966">
    <element-citation publication-type="article-journal">
      <person-group person-group-type="author">
        <name><surname>Matsuno</surname><given-names>Taroh</given-names></name>
      </person-group>
      <article-title>Quasi-geostrophic motions in the equatorial area</article-title>
      <source>Journal of the Meteorological Society of Japan</source>
      <publisher-name>Ubiquity Press</publisher-name>
      <year iso-8601-date="1966">1966</year>
      <volume>44</volume>
      <issue>1</issue>
      <uri>https://doi.org/10.2151/jmsj1965.44.1_25</uri>
      <pub-id pub-id-type="doi">10.2151/jmsj1965.44.1_25</pub-id>
      <fpage>25</fpage>
      <lpage>43</lpage>
    </element-citation>
  </ref>
  <ref id="ref-MunkU003A1950">
    <element-citation publication-type="article-journal">
      <person-group person-group-type="author">
        <name><surname>Munk</surname><given-names>Walter H.</given-names></name>
      </person-group>
      <article-title>On the wind-driven ocean circulation</article-title>
      <source>Journal of the Atmospheric Sciences</source>
      <publisher-name>Ubiquity Press</publisher-name>
      <year iso-8601-date="1950">1950</year>
      <volume>7</volume>
      <issue>2</issue>
      <uri>https://doi.org/10.1175/1520-0469(1950)007&lt;0080:OTWDOC&gt;2.0.CO;2</uri>
      <pub-id pub-id-type="doi">10.1175/1520-0469(1950)007&lt;0080:OTWDOC&gt;2.0.CO;2</pub-id>
      <fpage>80</fpage>
      <lpage>93</lpage>
    </element-citation>
  </ref>
  <ref id="ref-StommelU003A1948">
    <element-citation publication-type="article-journal">
      <person-group person-group-type="author">
        <name><surname>Stommel</surname><given-names>Henry</given-names></name>
      </person-group>
      <article-title>The westward intensification of wind-driven ocean currents</article-title>
      <source>Eos, Transactions American Geophysical Union</source>
      <publisher-name>Ubiquity Press</publisher-name>
      <year iso-8601-date="1948">1948</year>
      <volume>29</volume>
      <issue>2</issue>
      <uri>https://doi.org/10.1029/TR029i002p00202</uri>
      <pub-id pub-id-type="doi">10.1029/TR029i002p00202</pub-id>
      <fpage>202</fpage>
      <lpage>206</lpage>
    </element-citation>
  </ref>
  <ref id="ref-HoskinsU003A1978">
    <element-citation publication-type="article-journal">
      <person-group person-group-type="author">
        <name><surname>Hoskins</surname><given-names>B. J.</given-names></name>
        <name><surname>Draghici</surname><given-names>I.</given-names></name>
        <name><surname>Davies</surname><given-names>H. C.</given-names></name>
      </person-group>
      <article-title>A new look at the ω-equation</article-title>
      <source>Quarterly Journal of the Royal Meteorological Society</source>
      <publisher-name>Ubiquity Press</publisher-name>
      <year iso-8601-date="1978">1978</year>
      <volume>104</volume>
      <issue>439</issue>
      <uri>https://doi.org/10.1002/qj.49710443903</uri>
      <pub-id pub-id-type="doi">10.1002/qj.49710443903</pub-id>
      <fpage>31</fpage>
      <lpage>38</lpage>
    </element-citation>
  </ref>
  <ref id="ref-HoskinsU003A1985">
    <element-citation publication-type="article-journal">
      <person-group person-group-type="author">
        <name><surname>Hoskins</surname><given-names>B. J.</given-names></name>
        <name><surname>McIntyre</surname><given-names>M. E.</given-names></name>
        <name><surname>Robertson</surname><given-names>A. W.</given-names></name>
      </person-group>
      <article-title>On the use and significance of isentropic potential vorticity maps</article-title>
      <source>Quarterly Journal of the Royal Meteorological Society</source>
      <publisher-name>Ubiquity Press</publisher-name>
      <year iso-8601-date="1985">1985</year>
      <volume>111</volume>
      <issue>470</issue>
      <uri>https://doi.org/10.1002/qj.49711147002</uri>
      <pub-id pub-id-type="doi">10.1002/qj.49711147002</pub-id>
      <fpage>877</fpage>
      <lpage>946</lpage>
    </element-citation>
  </ref>
  <ref id="ref-FofonoffU003A1954">
    <element-citation publication-type="article-journal">
      <person-group person-group-type="author">
        <name><surname>Fofonoff</surname><given-names>N. P.</given-names></name>
      </person-group>
      <article-title>Steady flow in a frictionless homogeneous ocean</article-title>
      <source>Journal of Marine Research</source>
      <publisher-name>Ubiquity Press</publisher-name>
      <year iso-8601-date="1954">1954</year>
      <volume>13</volume>
      <uri>https://elischolar.library.yale.edu/journal_of_marine_research/818/</uri>
      <pub-id pub-id-type="doi">10.1357/002224020834442382</pub-id>
      <fpage>254</fpage>
      <lpage>262</lpage>
    </element-citation>
  </ref>
  <ref id="ref-BrethertonU003A1976">
    <element-citation publication-type="article-journal">
      <person-group person-group-type="author">
        <name><surname>Bretherton</surname><given-names>F. P.</given-names></name>
        <name><surname>Haidvogel</surname><given-names>D. B.</given-names></name>
      </person-group>
      <article-title>Two-dimensional turbulence above topography</article-title>
      <source>Journal of Fluid Mechanics</source>
      <publisher-name>Ubiquity Press</publisher-name>
      <year iso-8601-date="1976">1976</year>
      <volume>78</volume>
      <uri>https://www.cambridge.org/core/journals/journal-of-fluid-mechanics/article/twodimensional-turbulence-above-topography/839ED65E9B6684B5D6CFEFBD8108A82E</uri>
      <pub-id pub-id-type="doi">10.1017/S002211207600236X</pub-id>
      <fpage>129</fpage>
      <lpage>154</lpage>
    </element-citation>
  </ref>
  <ref id="ref-HoyerU003A2017">
    <element-citation publication-type="article-journal">
      <person-group person-group-type="author">
        <name><surname>Hoyer</surname><given-names>Stephan</given-names></name>
        <name><surname>Hamman</surname><given-names>Joe</given-names></name>
      </person-group>
      <article-title>Xarray: ND labeled arrays and datasets in Python</article-title>
      <source>Journal of Open Research Software</source>
      <publisher-name>Ubiquity Press</publisher-name>
      <year iso-8601-date="2017">2017</year>
      <volume>5</volume>
      <issue>1</issue>
      <uri>https://doi.org/10.5334/jors.148</uri>
      <pub-id pub-id-type="doi">10.5334/jors.148</pub-id>
    </element-citation>
  </ref>
  <ref id="ref-RocklinU003A2015">
    <element-citation publication-type="article-journal">
      <person-group person-group-type="author">
        <name><surname>Rocklin</surname><given-names>Matthew</given-names></name>
      </person-group>
      <article-title>Dask: Parallel Computation with Blocked algorithms and Task Scheduling</article-title>
      <source>Proceedings of the 14th Python in Science Conference</source>
      <year iso-8601-date="2015">2015</year>
      <date-in-citation content-type="access-date"><year iso-8601-date="2021-11-05">2021</year><month>11</month><day>05</day></date-in-citation>
      <uri>http://doi.org/10.25080/Majora-7b98e3ed-013</uri>
      <pub-id pub-id-type="doi">10.25080/majora-7b98e3ed-013</pub-id>
      <fpage>126</fpage>
      <lpage>132</lpage>
    </element-citation>
  </ref>
  <ref id="ref-DawsonU003A2016">
    <element-citation publication-type="article-journal">
      <person-group person-group-type="author">
        <name><surname>Dawson</surname><given-names>Andrew</given-names></name>
      </person-group>
      <article-title>Windspharm: A high-level library for global wind field computations using spherical harmonics</article-title>
      <source>Journal of Open Research Software</source>
      <year iso-8601-date="2016">2016</year>
      <volume>4</volume>
      <issue>1</issue>
      <uri>https://openresearchsoftware.metajnl.com/articles/10.5334/jors.129</uri>
      <pub-id pub-id-type="doi">10.5334/jors.129</pub-id>
      <fpage>1</fpage>
      <lpage>5</lpage>
    </element-citation>
  </ref>
  <ref id="ref-BurnsU003A2020">
    <element-citation publication-type="article-journal">
      <person-group person-group-type="author">
        <name><surname>Burns</surname><given-names>K. J.</given-names></name>
        <name><surname>M.</surname><given-names>Vasil G.</given-names></name>
        <name><surname>S.</surname><given-names>Oishi J.</given-names></name>
        <name><surname>Lecoanet</surname><given-names>D.</given-names></name>
        <name><surname>Brown</surname><given-names>B. P.</given-names></name>
      </person-group>
      <article-title>Dedalus: A flexible framework for numerical simulations with spectral methods</article-title>
      <source>Physical Review Research</source>
      <publisher-name>Ubiquity Press</publisher-name>
      <year iso-8601-date="2020">2020</year>
      <volume>2</volume>
      <issue>023068</issue>
      <uri>https://journals.aps.org/prresearch/abstract/10.1103/PhysRevResearch.2.023068</uri>
      <pub-id pub-id-type="doi">10.1103/PhysRevResearch.2.023068</pub-id>
      <fpage>1</fpage>
      <lpage>39</lpage>
    </element-citation>
  </ref>
  <ref id="ref-LamU003A2015">
    <element-citation publication-type="paper-conference">
      <person-group person-group-type="author">
        <name><surname>Lam</surname><given-names>Siu Kwan</given-names></name>
        <name><surname>Pitrou</surname><given-names>Antoine</given-names></name>
        <name><surname>Seibert</surname><given-names>Stanley</given-names></name>
      </person-group>
      <article-title>Numba: A LLVM-based Python JIT compiler</article-title>
      <source>Proceedings of the second workshop on the LLVM compiler infrastructure in HPC</source>
      <year iso-8601-date="2015">2015</year>
      <uri>https://doi.org/10.1145/2833157.2833162</uri>
      <pub-id pub-id-type="doi">10.1145/2833157.2833162</pub-id>
      <fpage>1 </fpage>
      <lpage> 6</lpage>
    </element-citation>
  </ref>
</ref-list>
</back>
</article>
