<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE article PUBLIC "-//NLM//DTD JATS (Z39.96) Journal Publishing DTD v1.2 20190208//EN"
                  "JATS-publishing1.dtd">
<article xmlns:mml="http://www.w3.org/1998/Math/MathML" xmlns:xlink="http://www.w3.org/1999/xlink" dtd-version="1.2" article-type="other">
<front>
<journal-meta>
<journal-id></journal-id>
<journal-title-group>
<journal-title>Journal of Open Source Software</journal-title>
<abbrev-journal-title>JOSS</abbrev-journal-title>
</journal-title-group>
<issn publication-format="electronic">2475-9066</issn>
<publisher>
<publisher-name>Open Journals</publisher-name>
</publisher>
</journal-meta>
<article-meta>
<article-id pub-id-type="publisher-id">4284</article-id>
<article-id pub-id-type="doi">10.21105/joss.04284</article-id>
<title-group>
<article-title>adaptr: an R package for simulating and comparing
adaptive clinical trials</article-title>
</title-group>
<contrib-group>
<contrib contrib-type="author">
<contrib-id contrib-id-type="orcid">0000-0001-5799-7655</contrib-id>
<name>
<surname>Granholm</surname>
<given-names>Anders</given-names>
</name>
<xref ref-type="aff" rid="aff-1"/>
</contrib>
<contrib contrib-type="author">
<contrib-id contrib-id-type="orcid">0000-0002-1459-0465</contrib-id>
<name>
<surname>Jensen</surname>
<given-names>Aksel Karl Georg</given-names>
</name>
<xref ref-type="aff" rid="aff-2"/>
</contrib>
<contrib contrib-type="author">
<contrib-id contrib-id-type="orcid">0000-0001-6807-8347</contrib-id>
<name>
<surname>Lange</surname>
<given-names>Theis</given-names>
</name>
<xref ref-type="aff" rid="aff-2"/>
</contrib>
<contrib contrib-type="author">
<contrib-id contrib-id-type="orcid">0000-0003-1023-0371</contrib-id>
<name>
<surname>Kaas-Hansen</surname>
<given-names>Benjamin Skov</given-names>
</name>
<xref ref-type="aff" rid="aff-1"/>
<xref ref-type="aff" rid="aff-2"/>
</contrib>
<aff id="aff-1">
<institution-wrap>
<institution>Department of Intensive Care, Copenhagen University
Hospital - Rigshospitalet, Copenhagen, Denmark</institution>
</institution-wrap>
</aff>
<aff id="aff-2">
<institution-wrap>
<institution>Section of Biostatistics, Department of Public Health,
University of Copenhagen, Copenhagen, Denmark</institution>
</institution-wrap>
</aff>
</contrib-group>
<pub-date date-type="pub" publication-format="electronic" iso-8601-date="2022-03-16">
<day>16</day>
<month>3</month>
<year>2022</year>
</pub-date>
<volume>7</volume>
<issue>72</issue>
<fpage>4284</fpage>
<permissions>
<copyright-statement>Authors of papers retain copyright and release the
work under a Creative Commons Attribution 4.0 International License (CC
BY 4.0)</copyright-statement>
<copyright-year>2022</copyright-year>
<copyright-holder>The article authors</copyright-holder>
<license license-type="open-access" xlink:href="https://creativecommons.org/licenses/by/4.0/">
<license-p>Authors of papers retain copyright and release the work under
a Creative Commons Attribution 4.0 International License (CC BY
4.0)</license-p>
</license>
</permissions>
<kwd-group kwd-group-type="author">
<kwd>R software</kwd>
<kwd>adaptive trials</kwd>
<kwd>clinical trials</kwd>
<kwd>trial design comparison</kwd>
</kwd-group>
</article-meta>
</front>
<body>
<sec id="summary">
  <title>Summary</title>
  <p>The <monospace>adaptr</monospace> <bold>R</bold> package
  facilitates simulation and comparison of adaptive clinical trial
  designs using Bayesian statistical methods. The package supports a
  flexible number of arms, use of a common control arm, pre-specified
  and user-defined outcome- and posterior probability
  distribution-generating functions, fixed- and response-adaptive
  randomisation (RAR), various adaptation rules for arm dropping and
  stopping, calculation of trial design performance metrics, and
  visualisation of results. Simulations are relatively fast, can run in
  parallel, and can be reloaded from previous sessions.</p>
</sec>
<sec id="statement-of-need">
  <title>Statement of need</title>
  <p>Adaptive clinical trials are more flexible and can be more
  efficient than conventional randomised clinical trials (RCTs) with
  fixed sample sizes and allocation ratios
  (<xref alt="Pallmann et al., 2018" rid="ref-pallmann2018" ref-type="bibr">Pallmann
  et al., 2018</xref>). Because more efficient trials may be preferable
  for economic, logistic and ethical reasons, the interest in adaptive
  clinical trials is growing
  (<xref alt="Granholm et al., 2021" rid="ref-granholm2021" ref-type="bibr">Granholm
  et al., 2021</xref>). Planning adaptive trials and comparing adaptive
  trials designs are complex, however, and require statistical
  simulation because simple, closed-form sample size calculations are
  infeasible. Existing software is either closed source/commercial, has
  limited features or flexibility, or is based on graphical user
  interfaces that may hamper reproducibility (unlike scripting-based
  tools)
  (<xref alt="Meyer et al., 2021" rid="ref-meyer2021" ref-type="bibr">Meyer
  et al., 2021</xref>).</p>
</sec>
<sec id="overview-and-features">
  <title>Overview and features</title>
  <p>The <monospace>adaptr</monospace> R package
  (<xref alt="R Core Team, 2021" rid="ref-rcore" ref-type="bibr">R Core
  Team, 2021</xref>) focuses on multi-arm adaptive clinical trials using
  adaptive stopping, arm dropping and/or response-adaptive randomisation
  (<xref alt="Pallmann et al., 2018" rid="ref-pallmann2018" ref-type="bibr">Pallmann
  et al., 2018</xref>;
  <xref alt="Viele, Broglio, et al., 2020" rid="ref-viele2020a" ref-type="bibr">Viele,
  Broglio, et al., 2020</xref>). Many realistic trial designs are
  supported by the built-in functions and more advanced trial designs
  can be simulated with user-defined functions.</p>
  <p><bold>Table 1</bold> gives an overview of the functionality of
  <monospace>adaptr</monospace>:</p>
  <table-wrap>
    <caption>
      <p>Overview of functionality in the <monospace>adaptr</monospace>
      package.</p>
    </caption>
    <table>
      <colgroup>
        <col width="25%" />
        <col width="75%" />
      </colgroup>
      <thead>
        <tr>
          <th>Category</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td><bold>General</bold></td>
          <td><p>Allows for two or more intervention arms and comparison
          of all arms or pairwise comparisons against a common control
          arms.</p>
          <p>Simulations use Bayesian statistics.</p></td>
        </tr>
        <tr>
          <td><bold>Outcomes and</bold> <bold>posteriors</bold></td>
          <td><p>Supports multiple outcome types specified by
          user-defined functions, with built-in convenience functions
          for easy use with binary, binomially distributed and
          continuous, normally distributed outcomes.</p>
          <p>For more flexibility, user-defined functions for generating
          outcomes and sampling from posterior distributions are
          supported; these may use more complex functions provided by
          other packages (e.g., Markov chain Monte Carlo or variational
          inference).</p></td>
        </tr>
        <tr>
          <td><bold>Random</bold> <bold>allocation</bold></td>
          <td><p>Supports fixed and response-adaptive randomisation, and
          combinations thereof, including special handling of control
          group allocation in trials with a common control (e.g.,
          matching highest non-control group allocation ratio and
          square-root-ratio-based allocation
          (<xref alt="Park et al., 2020" rid="ref-park2020" ref-type="bibr">Park
          et al., 2020</xref>;
          <xref alt="Viele, Broglio, et al., 2020" rid="ref-viele2020a" ref-type="bibr">Viele,
          Broglio, et al., 2020</xref>)).</p>
          <p>Supports minimum/maximum allocation limits and
          <italic>softening</italic> non-fixed allocation probabilities
          by raising them to a power
          (<xref alt="Ryan et al., 2020" rid="ref-ryan2020" ref-type="bibr">Ryan
          et al., 2020</xref>) (which may vary throughout the trial) and
          normalising probabilities to sum to 100%.</p></td>
        </tr>
        <tr>
          <td><bold>Adaptation</bold> <bold>rules</bold></td>
          <td><p>Supports probabilistic trial-stopping/arm-dropping
          rules for superiority, inferiority, and practical equivalence
          between all arms in trial designs without a common
          control.</p>
          <p>Supports probabilistic trial-stopping/arm-dropping rules
          for superiority, inferiority, practical equivalence, and
          futility compared to a common control in such designs.</p>
          <p>In trial designs with a common control, a superior arm
          becomes the new control. In these cases equivalence/futility
          testing may be continued (using the new control) or
          disabled.</p></td>
        </tr>
        <tr>
          <td><bold>Performance</bold> <bold>metrics</bold></td>
          <td>Supports the calculation of various trial design
          performance metrics
          (<xref alt="Viele, Broglio, et al., 2020" rid="ref-viele2020a" ref-type="bibr">Viele,
          Broglio, et al., 2020</xref>;
          <xref alt="Viele, Saville, et al., 2020" rid="ref-viele2020b" ref-type="bibr">Viele,
          Saville, et al., 2020</xref>) according to different arm
          selection strategies in trials not ending with
          superiority.</td>
        </tr>
        <tr>
          <td><bold>Visualisation</bold></td>
          <td>Offers graphical summaries of the overall or arm-specific
          statuses over time across multiple simulations (such as still
          <italic>recruting</italic> or <italic>trial stopped/arm
          dropped</italic> for various reasons), and relevant
          arm-specific metrics (e.g., allocation probabilities) over
          time across single/multiple trial simulations.</td>
        </tr>
        <tr>
          <td><bold>Technical</bold></td>
          <td><p>Supports parallel execution on multiple cores using
          <bold>R</bold>’s built-in <monospace>parallel</monospace>
          package.</p>
          <p>Allows reproducible results with seeding.</p>
          <p>Supports saving/loading large trial objects and
          <italic>growing</italic> previous simulation objects.</p>
          <p>Uses base <bold>R</bold> with no required external
          dependencies; optional plotting functionality does, however,
          require the <monospace>ggplot2</monospace>-package
          (<xref alt="Wickham et al., 2019" rid="ref-wickham2019" ref-type="bibr">Wickham
          et al., 2019</xref>).</p></td>
        </tr>
      </tbody>
    </table>
  </table-wrap>
  <p>Adaptive analyses are conducted at specified recruitment numbers,
  after random allocation of simulated patients to currently active
  arms. Both fixed and response-adaptive randomisation (RAR) as well as
  combinations (including several restrictions of RAR) are supported
  (<xref alt="Pallmann et al., 2018" rid="ref-pallmann2018" ref-type="bibr">Pallmann
  et al., 2018</xref>;
  <xref alt="Park et al., 2020" rid="ref-park2020" ref-type="bibr">Park
  et al., 2020</xref>;
  <xref alt="Ryan et al., 2020" rid="ref-ryan2020" ref-type="bibr">Ryan
  et al., 2020</xref>;
  <xref alt="The Adaptive Platform Trials Coalition, 2019" rid="ref-apt2019" ref-type="bibr">The
  Adaptive Platform Trials Coalition, 2019</xref>). Outcomes are then
  generated, followed by drawing samples from the posterior
  distributions; the packages comes with built-in functions for
  generating outcomes and posteriors using fast models with conjugate,
  flat priors
  (<xref alt="Ryan et al., 2019" rid="ref-ryan2019" ref-type="bibr">Ryan
  et al., 2019</xref>), but more advanced estimation are allowed using
  user-defined functions.</p>
  <p>Posterior draws are used to calculate probabilities for (i)
  enforcing adaptive trial-stopping/arm-dropping rules with respect to
  superiority, inferiority, equivalence and/or futility, (ii) assessing
  the trial’s final status (superiority, inferiority, equivalence,
  futility, or stopped at a maximum pre-specified sample size), and
  (iii) adjusting allocation probabilities if RAR is used. Single or
  multiple trial simulations can be run, saved and grown, and summarised
  using multiple relevant performance metrics
  (<xref alt="Viele, Broglio, et al., 2020" rid="ref-viele2020a" ref-type="bibr">Viele,
  Broglio, et al., 2020</xref>;
  <xref alt="Viele, Saville, et al., 2020" rid="ref-viele2020b" ref-type="bibr">Viele,
  Saville, et al., 2020</xref>). Performance metrics can be calculated
  under different assumptions about the preferable intervention in
  clinical practice should the trials not end with superiority.</p>
</sec>
<sec id="functions-and-workflow">
  <title>Functions and workflow</title>
  <p>An overview of the principal functions in
  <monospace>adaptr</monospace> is given in <bold>Table 2</bold>:</p>
  <table-wrap>
    <caption>
      <p>Overview of user-facing functions in
      <monospace>adaptr</monospace>.</p>
    </caption>
    <table>
      <colgroup>
        <col width="30%" />
        <col width="70%" />
      </colgroup>
      <thead>
        <tr>
          <th>Function name</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td><p><bold><monospace>setup_trial</monospace></bold>,</p>
          <p><monospace>setup_trial_binom</monospace>,</p>
          <p><monospace>setup_trial_norm</monospace></p></td>
          <td><p>Defines the adaptive trial specification including
          arms, true outcome rates, stopping rules, outcome/posterior
          generating functions, and summary settings.</p>
          <p>Full flexibility is provided by
          <bold><monospace>setup_trial</monospace></bold>; the
          convenience functions <monospace>setup_trial_binom</monospace>
          and <monospace>setup_trial_norm</monospace> provide sensible
          defaults for binary, binomially distributed and continuous,
          normally distributed outcomes, respectively.</p></td>
        </tr>
        <tr>
          <td><bold><monospace>run_trial</monospace></bold></td>
          <td>Runs a single simulation using a trial specification
          defined with <monospace>setup_trial</monospace>.</td>
        </tr>
        <tr>
          <td><bold><monospace>run_trials</monospace></bold></td>
          <td>Runs multiple trial simulations using a trial
          specification defined with <monospace>setup_trial</monospace>.
          Can save simulation objects to external files and load/grow
          previous simulations.</td>
        </tr>
        <tr>
          <td><bold><monospace>extract_results</monospace></bold></td>
          <td>Extracts key results and (partial) performance metrics
          from multiple simulations conducted by
          <monospace>run_trials</monospace> according to a specified arm
          selection strategy for simulations not ending in superiority.
          Returns a tidy <monospace>data.frame</monospace> with one
          simulation per row
          (<xref alt="Wickham et al., 2019" rid="ref-wickham2019" ref-type="bibr">Wickham
          et al., 2019</xref>).</td>
        </tr>
        <tr>
          <td><bold><monospace>summary</monospace></bold></td>
          <td>Summarises, in a human-friendly way, key results and
          calculates overall performance metrics for multiple
          simulations according to a specified arm selection strategy
          for simulations not ending in superiority.</td>
        </tr>
        <tr>
          <td><bold><monospace>plot_status</monospace></bold></td>
          <td>Plots the overall statuses or arm-specific statuses for
          multiple simulations over the course of the simulated
          trials.</td>
        </tr>
        <tr>
          <td><bold><monospace>plot_history</monospace></bold></td>
          <td>Plots the history of relevant metrics in each arm for one
          or multiple simulations over the course of the simulated
          trial(s).</td>
        </tr>
        <tr>
          <td><bold><monospace>print</monospace></bold></td>
          <td>Print methods for printing the outputs of most of the
          included functions in a human-friendly way.</td>
        </tr>
      </tbody>
    </table>
  </table-wrap>
  <p><monospace>adaptr</monospace> is available on
  <ext-link ext-link-type="uri" xlink:href="https://CRAN.R-project.org/package=adaptr">CRAN</ext-link>
  and
  <ext-link ext-link-type="uri" xlink:href="https://github.com/INCEPTdk/adaptr/">GitHub</ext-link>,
  where a
  <ext-link ext-link-type="uri" xlink:href="https://inceptdk.github.io/adaptr/">stand-alone
  website</ext-link> with the package documentation is also available.
  <monospace>adaptr</monospace> can be installed using one of the
  following commands:</p>
  <code language="r script">install.packages(&quot;adaptr&quot;) # CRAN

# install.packages(&quot;remotes&quot;)
remotes::install_github(&quot;INCEPTdk/adaptr&quot;) # GitHub</code>
  <p>Once installed, as any other R package, it is loaded with:</p>
  <code language="r script">library(adaptr)
#&gt; Loading adaptr package (version 1.0.0).
#&gt; See 'help(&quot;adaptr&quot;)' or 'vignette(&quot;Overview&quot;, &quot;adaptr&quot;)' for help.
#&gt; Further information available on https://github.com/INCEPTdk/adaptr/.</code>
  <p>An adaptive trial design is specified with the generic
  <monospace>setup_trial</monospace> function (requires user-defined
  functions to generate/compare outcomes), or one of the helper
  functions <monospace>setup_trial_binom</monospace> or
  <monospace>setup_trial_norm</monospace> (wrappers around
  <monospace>setup_trial</monospace> with appropriate functions for
  generating outcomes and sampling from posterior distributions). For
  example, a simple four-arm trial with a binary, binomially distributed
  outcome can be specified with:</p>
  <code language="r script">binom_trial &lt;- setup_trial_binom(
   # Treatment arms
   arms = c(&quot;Control&quot;, &quot;Experimental A&quot;, &quot;Experimental B&quot;, &quot;Experimental C&quot;),

   # True event rates
   true_ys = c(0.25, 0.30, 0.22, 0.19),

   # Time of adaptive analyses
   # - first analysis when 400 patients are included, then after every 100
   data_looks = seq(from = 400, to = 2000, by = 100),

   # Name of the common control (leave undefined if no common control is desired)
   control = &quot;Control&quot;,

   # Use square-root-ratio-based allocation (sqrt(number of non-control arms):1
   # for each non-control arm), with fixed control group allocation and RAR in
   # the non-control arms
   control_prob_fixed = &quot;sqrt-based&quot;,

   # Define stopping rules
   superiority = 0.99, # Superiority probability threshold
   inferiority = 0.01, # Inferiority probability threshold
   equivalence_prob = 0.85, # Equivalence probability threshold
   equivalence_diff = 0.05, # Equivalence difference
   equivalence_only_first = TRUE, # Only assess equivalence for first control

   # Restrict non-fixed allocation ratios (limit extreme RAR)
   soften_power = 0.5
)

print(binom_trial)
#&gt; Trial specification: generic binomially distributed outcome trial
#&gt; * Undesirable outcome
#&gt; * Common control arm: Control
#&gt; * Control arm probability fixed at 0.366 (for 4 arms), 0.414 (for 3 arms),
#&gt; 0.5 (for 2 arms)
#&gt; * Best arm: Experimental C
#&gt;
#&gt; Arms, true outcomes, starting allocation probabilities
#&gt; and allocation probability limits:
#&gt;            arms true_ys start_probs fixed_probs min_probs max_probs
#&gt;         Control    0.25       0.366       0.366        NA        NA
#&gt;  Experimental A    0.30       0.211          NA        NA        NA
#&gt;  Experimental B    0.22       0.211          NA        NA        NA
#&gt;  Experimental C    0.19       0.211          NA        NA        NA
#&gt;
#&gt; Maximum sample size: 2000
#&gt; Maximum number of data looks: 17
#&gt; Planned data looks after:  400, 500, 600, 700, 800, 900, 1000, 1100,
#&gt; 1200, 1300, 1400, 1500, 1600, 1700, 1800, 1900, 2000 patients
#&gt;
#&gt; Superiority threshold: 0.99
#&gt; Inferiority threshold: 0.01
#&gt; Equivalence threshold: 0.85 (only checked for first control)
#&gt; Absolute equivalence difference: 0.05
#&gt; No futility threshold
#&gt; Soften power for all analyses: 0.5</code>
  <p>Once specified, simulating a single trial is easy:</p>
  <code language="r script">run_trial(binom_trial, seed = 202203) # Fixed random seed
#&gt; Single simulation result: generic binomially distributed outcome trial
#&gt; * Undesirable outcome
#&gt; * Initial/final common control arms: Control/Experimental C
#&gt;
#&gt; Final status: inconclusive, stopped at maximum sample size
#&gt; Final/maximum allowed sample sizes: 2000/2000 (100.0%)
#&gt;
#&gt; Final trial results:
#&gt;            arms true_ys sum_ys  ns raw_ests post_ests post_errs lo_cri hi_cri
#&gt;         Control    0.25     42 145    0.290     0.293    0.0375  0.223  0.366
#&gt;  Experimental A    0.30     27  87    0.310     0.314    0.0492  0.223  0.415
#&gt;  Experimental B    0.22    192 888    0.216     0.217    0.0138  0.190  0.245
#&gt;  Experimental C    0.19    165 880    0.188     0.188    0.0133  0.163  0.215
#&gt;  final_status status_look status_probs final_alloc
#&gt;      inferior         400       0.0032       0.366
#&gt;      inferior         400       0.0036       0.211
#&gt;        active          NA           NA       0.500
#&gt;       control          NA           NA       0.500
#&gt;
#&gt; Simulation details:
#&gt; * Random seed: 202203
#&gt; * Credible interval width: 95%
#&gt; * Number of posterior draws: 5000
#&gt; * Posterior estimation method: medians with MAD-SDs</code>
  <p>—so is running multiple trials, for example 1000. If
  <monospace>cores</monospace> &gt; 1, simulations are runs in parallel
  on the number of cores specified. Setting
  <monospace>sparse = FALSE</monospace> keeps all intermediate
  simulation results; this is required for
  <monospace>plot_history</monospace> (see below) but makes the object a
  lot larger (in this case, by a factor 15).</p>
  <code language="r script">sims &lt;- run_trials(trial_spec = binom_trial, n_rep = 1000, cores = 4,
                   base_seed = 202204, sparse = FALSE)</code>
  <sec id="numerical-results">
    <title>Numerical results</title>
    <p>We summarise the results, assuming the control arm would be used
    in clinical practice in case of inconclusive trials (unless dropped
    early):</p>
    <code language="r script">summary(sims, select_strategy = &quot;control&quot;)
#&gt; Multiple simulation results: generic binomially distributed outcome trial
#&gt; * Undesirable outcome
#&gt; * Number of simulations: 1000
#&gt; * Number of simulations summarised: 1000 (all trials)
#&gt; * Common control arm: Control
#&gt; * Selection strategy: first control if available (otherwise no selection)
#&gt; * Treatment effect compared to: no comparison
#&gt;
#&gt; Performance metrics (using posterior estimates):
#&gt; * Sample sizes: mean 1708.3 (SD: 438.0) | median 2000.0 (IQR: 1500.0 to
#&gt; 2000.0)
#&gt; * Total summarised outcomes: mean 382.5 (SD: 96.4) | median 422.0 (IQR:
#&gt; 338.8 to 449.0)
#&gt; * Total summarised outcome rates: mean 0.225 (SD: 0.014) | median 0.225
#&gt; (IQR: 0.216 to 0.234)
#&gt; * Conclusive: 45.2%
#&gt; * Superiority: 39.0%
#&gt; * Equivalence: 6.2%
#&gt; * Futility: 0.0% [not assessed]
#&gt; * Inconclusive at max sample size: 54.8%
#&gt; * Selection probabilities: Control: 24.0% | Experimental A: 0.0% |
#&gt; Experimental B: 1.3% | Experimental C: 33.1% | None: 41.6%
#&gt; * RMSE: 0.02742
#&gt; * RMSE treatment effect: 0.04741
#&gt; * Ideal design percentage: 77.0%
#&gt;
#&gt; Simulation details:
#&gt; * Simulation time: 19.9 secs
#&gt; * Base random seed: 202204
#&gt; * Credible interval width: 95%
#&gt; * Number of posterior draws: 5000
#&gt; * Estimation method: posterior medians with MAD-SDs</code>
    <p>Alternatively, we can get <italic>tidy</italic> results
    (<xref alt="Wickham et al., 2019" rid="ref-wickham2019" ref-type="bibr">Wickham
    et al., 2019</xref>) for each simulation using the same selection
    strategy as above:</p>
    <code language="r script">extr_res &lt;- extract_results(sims, select_strategy = &quot;control&quot;)

head(extr_res) # Print results for first six simulations
#&gt;   sim final_n sum_ys  ratio_ys final_status   superior_arm   selected_arm
#&gt; 1   1    2000    436 0.2180000          max           &lt;NA&gt;           &lt;NA&gt;
#&gt; 2   2    2000    452 0.2260000          max           &lt;NA&gt;           &lt;NA&gt;
#&gt; 3   3    1800    389 0.2161111  superiority Experimental C Experimental C
#&gt; 4   4    2000    440 0.2200000          max           &lt;NA&gt;           &lt;NA&gt;
#&gt; 5   5     500    118 0.2360000  superiority Experimental B Experimental B
#&gt; 6   6     900    182 0.2022222  superiority Experimental C Experimental C
#&gt;         sq_err   sq_err_te
#&gt; 1           NA          NA
#&gt; 2           NA          NA
#&gt; 3 0.0004297484 0.004184831
#&gt; 4           NA          NA
#&gt; 5 0.0078199784 0.015558136
#&gt; 6 0.0019097953 0.001558565</code>
  </sec>
  <sec id="visual-summaries">
    <title>Visual summaries</title>
    <p>We can plot the overall trial statuses at each adaptive analysis
    using:</p>
    <code language="r script">plot_status(sims)</code>
    <fig>
      <caption><p>Status plot</p></caption>
      <graphic mimetype="image" mime-subtype="png" xlink:href="media/image1.png" xlink:title="" />
    </fig>
    <p>The overall allocation probabilities in each arm (y axis) against
    the total number of patients included in the trial (x axis) are
    plotted using:</p>
    <code language="r script"># Requires sparse = FALSE in run_trials
plot_history(sims, x_value = &quot;total n&quot;, y_value = &quot;prob&quot;)</code>
    <fig>
      <caption><p>Allocation probabilities history plot</p></caption>
      <graphic mimetype="image" mime-subtype="png" xlink:href="media/image2.png" xlink:title="" />
    </fig>
    <p>Arm-specific statuses and additional metrics over time may be
    plotted as well.</p>
  </sec>
</sec>
<sec id="discussion">
  <title>Discussion</title>
  <p>We have developed a flexible, extensible and comprehensive
  <bold>R</bold> package that allows relatively easy and efficient
  simulation of adaptive clinical trials using various features with
  few, well-documented user-facing functions.</p>
  <p>The package facilitates planning of adaptive clinical trials and
  comparison of trial designs using combinations of the most important
  and common adaptive features. In addition to the efficient convenience
  functions provided for common outcome types, more complex models are
  supported but may increase simulation time substantially and require
  (highly) parallel execution on multiple cores locally and/or remotely
  using cloud computing.</p>
  <p>Compared to other open-source solutions
  (<xref alt="Meyer et al., 2021" rid="ref-meyer2021" ref-type="bibr">Meyer
  et al., 2021</xref>), <monospace>adaptr</monospace> comprises a
  completely functional and well-documented <bold>R</bold> package with
  support for multiple complex randomisation strategies, different
  stopping rules with detailed control, full support for user-defined
  outcome-/posterior-generating functions, parallel computation, easy
  calculation of various trial design performance metrics according to
  different arm selection strategies for trials not ending in
  superiority, and visualisation of relevant metrics across single or
  multiple simulations. While relatively feature-rich, the package
  currently has some limitations. These primarily include the lack of a
  ‘flooring’ option (stopping allocation to arms when their
  probabilities of being the best fall below a certain threshold,
  possibly with subsequent resumption of allocation
  (<xref alt="Viele, Broglio, et al., 2020" rid="ref-viele2020a" ref-type="bibr">Viele,
  Broglio, et al., 2020</xref>)), inability to add arms during the
  conduct (as done in adaptive platform trials
  (<xref alt="The Adaptive Platform Trials Coalition, 2019" rid="ref-apt2019" ref-type="bibr">The
  Adaptive Platform Trials Coalition, 2019</xref>); this is complex and
  not supported in most other software
  (<xref alt="Meyer et al., 2021" rid="ref-meyer2021" ref-type="bibr">Meyer
  et al., 2021</xref>)) and the lack of separate stopping
  rules/allocation ratios in subgroups or enrichment (which is similarly
  complex
  (<xref alt="The Adaptive Platform Trials Coalition, 2019" rid="ref-apt2019" ref-type="bibr">The
  Adaptive Platform Trials Coalition, 2019</xref>)). Finally, the
  package uses Bayesian statistical methods as these are well-suited for
  adaptive trials and easily extended; frequentist statistical methods
  are not supported.</p>
  <p>In conclusion, the <monospace>adaptr</monospace> <bold>R</bold>
  package provides a feature-rich and extensible open-source,
  scripting-based solution for planning, simulating and comparing
  adaptive clinical trials.</p>
</sec>
<sec id="acknowledgement">
  <title>Acknowledgement</title>
  <p><monospace>adaptr</monospace> has been developed as part of the
  <ext-link ext-link-type="uri" xlink:href="https://www.incept.dk">Intensive
  Care Platform Trial</ext-link> programme, which has primarily been
  funded by a grant from
  <ext-link ext-link-type="uri" xlink:href="https://www.sygeforsikring.dk">Sygeforsikringen
  “danmark”</ext-link>.</p>
</sec>
</body>
<back>
<ref-list>
  <ref id="ref-pallmann2018">
    <element-citation publication-type="article-journal">
      <person-group person-group-type="author">
        <name><surname>Pallmann</surname><given-names>P</given-names></name>
        <name><surname>Bedding</surname><given-names>AW</given-names></name>
        <name><surname>Choodari-Oskooei</surname><given-names>B</given-names></name>
        <name><surname>Dimairo</surname><given-names>M</given-names></name>
        <name><surname>Flight</surname><given-names>L</given-names></name>
        <name><surname>Hampson</surname><given-names>LV</given-names></name>
        <name><surname>Holmes</surname><given-names>J</given-names></name>
        <name><surname>Mander</surname><given-names>AP</given-names></name>
        <name><surname>Odondi</surname><given-names>L</given-names></name>
        <name><surname>Sydes</surname><given-names>MR</given-names></name>
        <name><surname>Villar</surname><given-names>SS</given-names></name>
        <name><surname>Wason</surname><given-names>JMS</given-names></name>
        <name><surname>Weir</surname><given-names>CJ</given-names></name>
        <name><surname>Wheeler</surname><given-names>GM</given-names></name>
        <name><surname>Yap</surname><given-names>C</given-names></name>
        <name><surname>Jaki</surname><given-names>T</given-names></name>
      </person-group>
      <article-title>Adaptive designs in clinical trials: Why use them, and how to run and report them</article-title>
      <source>BMC Medicine</source>
      <year iso-8601-date="2018">2018</year>
      <volume>16</volume>
      <pub-id pub-id-type="doi">10.1186/s12916-018-1017-7</pub-id>
      <fpage>29</fpage>
      <lpage></lpage>
    </element-citation>
  </ref>
  <ref id="ref-granholm2021">
    <element-citation publication-type="article-journal">
      <person-group person-group-type="author">
        <name><surname>Granholm</surname><given-names>A</given-names></name>
        <name><surname>Alhazzani</surname><given-names>W</given-names></name>
        <name><surname>Derde</surname><given-names>LPG</given-names></name>
        <name><surname>Angus</surname><given-names>DC</given-names></name>
        <name><surname>Zampieri</surname><given-names>FG</given-names></name>
        <name><surname>Hammond</surname><given-names>NE</given-names></name>
        <name><surname>Sweeney</surname><given-names>RM</given-names></name>
        <name><surname>Myatra</surname><given-names>SN</given-names></name>
        <name><surname>Azoulay</surname><given-names>E</given-names></name>
        <name><surname>Rowan</surname><given-names>K</given-names></name>
        <name><surname>Young</surname><given-names>PJ</given-names></name>
        <name><surname>Perner</surname><given-names>A</given-names></name>
        <name><surname>Møller</surname><given-names>MH</given-names></name>
      </person-group>
      <article-title>Randomised clinical trials in critical care: Past, present and future</article-title>
      <source>Intensive Care Medicine</source>
      <year iso-8601-date="2021">2021</year>
      <pub-id pub-id-type="doi">10.1007/s00134-021-06587-9</pub-id>
    </element-citation>
  </ref>
  <ref id="ref-meyer2021">
    <element-citation publication-type="article-journal">
      <person-group person-group-type="author">
        <name><surname>Meyer</surname><given-names>EL</given-names></name>
        <name><surname>Mesenbrink</surname><given-names>P</given-names></name>
        <name><surname>Mielke</surname><given-names>T</given-names></name>
        <name><surname>Parke</surname><given-names>T</given-names></name>
        <name><surname>Evans</surname><given-names>D</given-names></name>
        <name><surname>König</surname><given-names>F</given-names></name>
        <string-name>on behalf of EU-PEARL (EU Patient-cEntric clinicAl tRial pLatforms) Consortium</string-name>
      </person-group>
      <article-title>Systematic review of available software for multi-arm multi-stage and platform clinical trial design</article-title>
      <source>Trials</source>
      <year iso-8601-date="2021">2021</year>
      <volume>22</volume>
      <pub-id pub-id-type="doi">10.1186/s13063-021-05130-x</pub-id>
      <fpage>183</fpage>
      <lpage></lpage>
    </element-citation>
  </ref>
  <ref id="ref-viele2020a">
    <element-citation publication-type="article-journal">
      <person-group person-group-type="author">
        <name><surname>Viele</surname><given-names>K</given-names></name>
        <name><surname>Broglio</surname><given-names>K</given-names></name>
        <name><surname>McGlothlin</surname><given-names>A</given-names></name>
        <name><surname>Saville</surname><given-names>BR</given-names></name>
      </person-group>
      <article-title>Comparison of methods for control allocation in multiple arm studies using response adaptive randomization</article-title>
      <source>Clinical Trials</source>
      <year iso-8601-date="2020">2020</year>
      <volume>17</volume>
      <pub-id pub-id-type="doi">10.1177/1740774519877836</pub-id>
      <fpage>52</fpage>
      <lpage>60</lpage>
    </element-citation>
  </ref>
  <ref id="ref-viele2020b">
    <element-citation publication-type="article-journal">
      <person-group person-group-type="author">
        <name><surname>Viele</surname><given-names>K</given-names></name>
        <name><surname>Saville</surname><given-names>BR</given-names></name>
        <name><surname>McGlothlin</surname><given-names>A</given-names></name>
        <name><surname>Broglio</surname><given-names>K</given-names></name>
      </person-group>
      <article-title>Comparison of response adaptive randomization features in multiarm clinical trials with control</article-title>
      <source>Pharmaceutical Statistics</source>
      <year iso-8601-date="2020">2020</year>
      <volume>19</volume>
      <pub-id pub-id-type="doi">10.1002/pst.2015</pub-id>
      <fpage>602</fpage>
      <lpage>612</lpage>
    </element-citation>
  </ref>
  <ref id="ref-rcore">
    <element-citation publication-type="book">
      <person-group person-group-type="author">
        <string-name>R Core Team</string-name>
      </person-group>
      <source>R: A language and environment for statistical computing</source>
      <publisher-name>R Foundation for Statistical Computing</publisher-name>
      <publisher-loc>Vienna, Austria</publisher-loc>
      <year iso-8601-date="2021">2021</year>
      <uri>https://www.R-project.org/</uri>
    </element-citation>
  </ref>
  <ref id="ref-wickham2019">
    <element-citation publication-type="article-journal">
      <person-group person-group-type="author">
        <name><surname>Wickham</surname><given-names>H</given-names></name>
        <name><surname>Averick</surname><given-names>M</given-names></name>
        <name><surname>Bryan</surname><given-names>J</given-names></name>
        <name><surname>Chang</surname><given-names>W</given-names></name>
        <name><surname>D’Agostino</surname><given-names>L</given-names></name>
        <name><surname>Francois</surname><given-names>R</given-names></name>
        <name><surname>Grolemund</surname><given-names>G</given-names></name>
        <name><surname>Hayes</surname><given-names>A</given-names></name>
        <name><surname>Henry</surname><given-names>L</given-names></name>
        <name><surname>Hester</surname><given-names>J</given-names></name>
        <name><surname>Kuhn</surname><given-names>M</given-names></name>
        <name><surname>Pedersen</surname><given-names>TL</given-names></name>
        <name><surname>Miller</surname><given-names>E</given-names></name>
        <name><surname>Bache</surname><given-names>SM</given-names></name>
        <name><surname>Müller</surname><given-names>K</given-names></name>
        <name><surname>Ooms</surname><given-names>J</given-names></name>
        <name><surname>Robinson</surname><given-names>D</given-names></name>
        <name><surname>Seidel</surname><given-names>DP</given-names></name>
        <name><surname>Spinu</surname><given-names>V</given-names></name>
        <name><surname>Takahashi</surname><given-names>K</given-names></name>
        <name><surname>Vaughan</surname><given-names>D</given-names></name>
        <name><surname>Wilke</surname><given-names>C</given-names></name>
        <name><surname>Woo</surname><given-names>K</given-names></name>
        <name><surname>Yutani</surname><given-names>H</given-names></name>
      </person-group>
      <article-title>Welcome to the tidyverse</article-title>
      <source>Journal of Open Source Software</source>
      <year iso-8601-date="2019">2019</year>
      <volume>4</volume>
      <pub-id pub-id-type="doi">10.21105/joss.01686</pub-id>
      <fpage>1686</fpage>
      <lpage></lpage>
    </element-citation>
  </ref>
  <ref id="ref-apt2019">
    <element-citation publication-type="article-journal">
      <person-group person-group-type="author">
        <string-name>The Adaptive Platform Trials Coalition</string-name>
      </person-group>
      <article-title>Adaptive platform trials: Definition, design, conduct and reporting considerations</article-title>
      <source>Nature Reviews Drug Discovery</source>
      <year iso-8601-date="2019">2019</year>
      <volume>18</volume>
      <pub-id pub-id-type="doi">10.1038/s41573-019-0034-3</pub-id>
      <fpage>797</fpage>
      <lpage>807</lpage>
    </element-citation>
  </ref>
  <ref id="ref-park2020">
    <element-citation publication-type="article-journal">
      <person-group person-group-type="author">
        <name><surname>Park</surname><given-names>JJH</given-names></name>
        <name><surname>Harari</surname><given-names>O</given-names></name>
        <name><surname>Dron</surname><given-names>L</given-names></name>
        <name><surname>Lester</surname><given-names>RT</given-names></name>
        <name><surname>Thorlund</surname><given-names>K</given-names></name>
        <name><surname>Mills</surname><given-names>EJ</given-names></name>
      </person-group>
      <article-title>An overview of platform trials with a checklist for clinical readers</article-title>
      <source>Journal of Clinical Epidemiology</source>
      <year iso-8601-date="2020">2020</year>
      <volume>125</volume>
      <pub-id pub-id-type="doi">10.1016/j.jclinepi.2020.04.025</pub-id>
      <fpage>1</fpage>
      <lpage>8</lpage>
    </element-citation>
  </ref>
  <ref id="ref-ryan2020">
    <element-citation publication-type="article-journal">
      <person-group person-group-type="author">
        <name><surname>Ryan</surname><given-names>EG</given-names></name>
        <name><surname>Lamb</surname><given-names>SE</given-names></name>
        <name><surname>Williamson</surname><given-names>E</given-names></name>
        <name><surname>Gates</surname><given-names>S</given-names></name>
      </person-group>
      <article-title>Bayesian adaptive designs for multi-arm trials: An orthopaedic case study</article-title>
      <source>Trials</source>
      <year iso-8601-date="2020">2020</year>
      <volume>21</volume>
      <pub-id pub-id-type="doi">10.1186/s13063-019-4021-0</pub-id>
      <fpage>83</fpage>
      <lpage></lpage>
    </element-citation>
  </ref>
  <ref id="ref-ryan2019">
    <element-citation publication-type="article-journal">
      <person-group person-group-type="author">
        <name><surname>Ryan</surname><given-names>EG</given-names></name>
        <name><surname>Harrison</surname><given-names>EM</given-names></name>
        <name><surname>Pearse</surname><given-names>RM</given-names></name>
        <name><surname>Gates</surname><given-names>S</given-names></name>
      </person-group>
      <article-title>Perioperative haemodynamic therapy for major gastrointestinal surgery: The effect of a bayesian approach to interpreting the findings of a randomised controlled trial</article-title>
      <source>BMJ Open</source>
      <year iso-8601-date="2019">2019</year>
      <volume>9</volume>
      <pub-id pub-id-type="doi">10.1136/bmjopen-2018-024256</pub-id>
      <fpage>e024256</fpage>
      <lpage></lpage>
    </element-citation>
  </ref>
</ref-list>
</back>
</article>
