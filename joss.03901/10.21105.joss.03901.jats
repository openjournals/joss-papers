<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE article PUBLIC "-//NLM//DTD JATS (Z39.96) Journal Publishing DTD v1.2 20190208//EN"
                  "JATS-publishing1.dtd">
<article xmlns:mml="http://www.w3.org/1998/Math/MathML" xmlns:xlink="http://www.w3.org/1999/xlink" dtd-version="1.2" article-type="other">
<front>
<journal-meta>
<journal-id></journal-id>
<journal-title-group>
<journal-title>Journal of Open Source Software</journal-title>
<abbrev-journal-title>JOSS</abbrev-journal-title>
</journal-title-group>
<issn publication-format="electronic">2475-9066</issn>
<publisher>
<publisher-name>Open Journals</publisher-name>
</publisher>
</journal-meta>
<article-meta>
<article-id pub-id-type="publisher-id">3901</article-id>
<article-id pub-id-type="doi">10.21105/joss.03901</article-id>
<title-group>
<article-title>bistablehistory: an R package for history-dependent
analysis of perceptual time series</article-title>
</title-group>
<contrib-group>
<contrib contrib-type="author">
<contrib-id contrib-id-type="orcid">0000-0002-8738-8591</contrib-id>
<name>
<surname>Pastukhov</surname>
<given-names>Alexander</given-names>
</name>
<xref ref-type="aff" rid="aff-1"/>
<xref ref-type="aff" rid="aff-2"/>
</contrib>
<aff id="aff-1">
<institution-wrap>
<institution>Department of General Psychology and Methodology,
University of Bamberg, Bamberg, Bavaria, Germany.</institution>
</institution-wrap>
</aff>
<aff id="aff-2">
<institution-wrap>
<institution>Forschungsgruppe EPÆG (Ergonomics, Psychological Æsthetics,
Gestalt), Bamberg, Bavaria, Germany.</institution>
</institution-wrap>
</aff>
</contrib-group>
<pub-date date-type="pub" publication-format="electronic" iso-8601-date="2021-10-01">
<day>1</day>
<month>10</month>
<year>2021</year>
</pub-date>
<volume>7</volume>
<issue>70</issue>
<fpage>3901</fpage>
<permissions>
<copyright-statement>Authors of papers retain copyright and release the
work under a Creative Commons Attribution 4.0 International License (CC
BY 4.0)</copyright-statement>
<copyright-year>2022</copyright-year>
<copyright-holder>The article authors</copyright-holder>
<license license-type="open-access" xlink:href="https://creativecommons.org/licenses/by/4.0/">
<license-p>Authors of papers retain copyright and release the work under
a Creative Commons Attribution 4.0 International License (CC BY
4.0)</license-p>
</license>
</permissions>
<kwd-group kwd-group-type="author">
<kwd>R</kwd>
<kwd>vision</kwd>
<kwd>time series</kwd>
<kwd>binocular riavlry</kwd>
</kwd-group>
</article-meta>
</front>
<body>
<sec id="summary">
  <title>Summary</title>
  <p>Our perception is subject to a process of adaptation that changes
  its operating properties
  (<xref alt="Clifford et al., 2007" rid="ref-Clifford2007" ref-type="bibr">Clifford
  et al., 2007</xref>). This process manifests itself in a plethora of
  perceptual illusions and so-called aftereffects. It also plays an
  important role during the perception of multistable stimuli, such as a
  Necker cube (Fig. 1A). These are compatible with several, typically
  two, comparably likely perceptual interpretations. In the case of the
  Necker cube, one can perceive it as “upwards” or “downwards”, and
  during continuous viewing the perception switches between these
  alternatives (Fig. 1B).</p>
  <fig>
    <caption><p><bold>Figure 1. Perception of Necker cube
    stimulus.</bold> A) Necker cube. B) Schematic time series of
    perceptual alternations. C) Example distribution of perceptual
    dominance phases’ duration fitting with the Gamma distribution.
    <styled-content id="figU003Afig1"></styled-content></p></caption>
    <graphic mimetype="image" mime-subtype="png" xlink:href="media/fig1.png" xlink:title="" />
  </fig>
  <p>Typically, time series for such multistable stimuli are fitted
  using the Gamma distribution (Fig. 1C). This assumes that individual
  dominance phase durations are exchangeable, i.e., the order in which
  they are drawn is unimportant. However, this ignores the effect of
  prior perception through adaptation
  (<xref alt="Ee, 2009" rid="ref-VanEe2009" ref-type="bibr">Ee,
  2009</xref>) that makes individual dominance phases serially dependent
  on prior ones, violating assumptions about independent and identically
  distributed samples. In other words, each dominance phase is drawn
  from its specific distribution, whose parameters are also determined
  by the prior perceptual history. The
  <monospace>bistablehistory</monospace> package solves this problem by
  accounting for the slow accumulation process via a homogeneous
  first-order process
  (<xref alt="Pastukhov &amp; Braun, 2011" rid="ref-PastukhovBraun2011" ref-type="bibr">Pastukhov
  &amp; Braun, 2011</xref>), providing tools for fitting time series
  using various distributions. It also allows for fitting while
  accounting for additional random or fixed factors. In addition, it
  provides a tool for extracting the estimated accumulated adaptation or
  computing it directly for further usage. The package aims to
  streamline the time series analysis for perceptual multistability and
  experiments on continuous perception in general.</p>
  <p>The package is built using the Stan probabilistic programming
  language
  (<xref alt="Carpenter et al., 2017" rid="ref-carpenter2017stan" ref-type="bibr">Carpenter
  et al., 2017</xref>). Thus, it provides posterior distributions, the
  ability to compare models via information criteria
  (<xref alt="Vehtari et al., 2017" rid="ref-loo" ref-type="bibr">Vehtari
  et al., 2017</xref>), etc. In addition, the package provides Stan code
  for performing the estimation and an example that explains how to
  implement a custom Stan model that relies on it. The source code for
  <monospace>bistablehistory</monospace> has been archived to Zenodo
  with the linked DOI: Pastukhov
  (<xref alt="2021" rid="ref-zenodo" ref-type="bibr">2021</xref>).</p>
</sec>
<sec id="statement-of-need">
  <title>Statement of Need</title>
  <p>Analysis of time series from psychophysical experiments,
  particularly on multistable perception, frequently requires taking
  into account the slow accumulation of adaptation. R has an extensive
  toolset for working with time-series, e.g., see
  <ext-link ext-link-type="uri" xlink:href="https://cran.r-project.org/web/views/TimeSeries.html">cran.r-project.org/web/views/TimeSeries.html</ext-link>,
  using frequentist
  (<xref alt="Hyndman &amp; Khandakar, 2008" rid="ref-forecast" ref-type="bibr">Hyndman
  &amp; Khandakar, 2008</xref>) and Bayesian
  (<xref alt="Alonzo &amp; Cruz, 2020" rid="ref-varstan" ref-type="bibr">Alonzo
  &amp; Cruz, 2020</xref>) approaches. The purpose of
  <italic>bistablehistory</italic> package is to extend the existing
  tools by incorporating fitting of cumulative history via a homogeneous
  first-order process, which is more accurate
  (<xref alt="Pastukhov &amp; Braun, 2011" rid="ref-PastukhovBraun2011" ref-type="bibr">Pastukhov
  &amp; Braun, 2011</xref>) than commonly used approximation via an
  autocorrelation coefficient
  (<xref alt="Ee, 2009" rid="ref-VanEe2009" ref-type="bibr">Ee,
  2009</xref>). The package simplifies both computing cumulative history
  and its use directly as part of a statistical (generalized) linear
  model fitted by a package function.</p>
</sec>
<sec id="cumulative-history-computation">
  <title>Cumulative history computation</title>
  <p>The cumulative history for a perceptual state is computed via a
  homogeneous first-order process (for details on first order linear
  differential equations, please refer to chapter 2 in Wilson
  (<xref alt="1999" rid="ref-Wilson1999" ref-type="bibr">1999</xref>)):
  <disp-formula><alternatives>
  <tex-math><![CDATA[\tag{1}\frac{dh_i}{dt} = \frac{1}{\tau} (-h_i + S_i(t))]]></tex-math>
  <mml:math display="block" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:mrow><mml:mfrac><mml:mrow><mml:mi>d</mml:mi><mml:msub><mml:mi>h</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow><mml:mrow><mml:mi>d</mml:mi><mml:mi>t</mml:mi></mml:mrow></mml:mfrac><mml:mo>=</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:mi>τ</mml:mi></mml:mfrac><mml:mrow><mml:mo stretchy="true" form="prefix">(</mml:mo><mml:mo>−</mml:mo><mml:msub><mml:mi>h</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mi>S</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mrow><mml:mo stretchy="true" form="prefix">(</mml:mo><mml:mi>t</mml:mi><mml:mo stretchy="true" form="postfix">)</mml:mo></mml:mrow><mml:mo stretchy="true" form="postfix">)</mml:mo></mml:mrow></mml:mrow></mml:math></alternatives></disp-formula></p>
  <p>where <inline-formula><alternatives>
  <tex-math><![CDATA[\tau]]></tex-math>
  <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:mi>τ</mml:mi></mml:math></alternatives></inline-formula>
  is the time constant, <inline-formula><alternatives>
  <tex-math><![CDATA[h_i]]></tex-math>
  <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:msub><mml:mi>h</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:math></alternatives></inline-formula>
  is cumulative history and <inline-formula><alternatives>
  <tex-math><![CDATA[S_i(t)]]></tex-math>
  <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:mrow><mml:msub><mml:mi>S</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mrow><mml:mo stretchy="true" form="prefix">(</mml:mo><mml:mi>t</mml:mi><mml:mo stretchy="true" form="postfix">)</mml:mo></mml:mrow></mml:mrow></mml:math></alternatives></inline-formula>
  is the current signal level for the ith perceptual state, so that
  <disp-formula><alternatives>
  <tex-math><![CDATA[\tag{2}
  S(t) = \begin{cases}
    1 & \text{if state $i$ is dominant}\\
    0 & \text{if state $i$ is suppessed}\\
    S_{mixed} & \text{if it is a mixed/transition phase and $0 ≥ S_{mixed} ≥1 $}
  \end{cases}]]></tex-math>
  <mml:math display="block" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:mrow><mml:mi>S</mml:mi><mml:mrow><mml:mo stretchy="true" form="prefix">(</mml:mo><mml:mi>t</mml:mi><mml:mo stretchy="true" form="postfix">)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mrow><mml:mo stretchy="true" form="prefix">{</mml:mo><mml:mtable><mml:mtr><mml:mtd columnalign="left"><mml:mn>1</mml:mn></mml:mtd><mml:mtd columnalign="left"><mml:mrow><mml:mtext mathvariant="normal">if state </mml:mtext><mml:mspace width="0.333em"></mml:mspace></mml:mrow><mml:mi>i</mml:mi><mml:mrow><mml:mspace width="0.333em"></mml:mspace><mml:mtext mathvariant="normal"> is dominant</mml:mtext></mml:mrow></mml:mtd></mml:mtr><mml:mtr><mml:mtd columnalign="left"><mml:mn>0</mml:mn></mml:mtd><mml:mtd columnalign="left"><mml:mrow><mml:mtext mathvariant="normal">if state </mml:mtext><mml:mspace width="0.333em"></mml:mspace></mml:mrow><mml:mi>i</mml:mi><mml:mrow><mml:mspace width="0.333em"></mml:mspace><mml:mtext mathvariant="normal"> is suppessed</mml:mtext></mml:mrow></mml:mtd></mml:mtr><mml:mtr><mml:mtd columnalign="left"><mml:msub><mml:mi>S</mml:mi><mml:mrow><mml:mi>m</mml:mi><mml:mi>i</mml:mi><mml:mi>x</mml:mi><mml:mi>e</mml:mi><mml:mi>d</mml:mi></mml:mrow></mml:msub></mml:mtd><mml:mtd columnalign="left"><mml:mrow><mml:mtext mathvariant="normal">if it is a mixed/transition phase and </mml:mtext><mml:mspace width="0.333em"></mml:mspace></mml:mrow><mml:mrow><mml:mn>0</mml:mn><mml:mo>≥</mml:mo><mml:msub><mml:mi>S</mml:mi><mml:mrow><mml:mi>m</mml:mi><mml:mi>i</mml:mi><mml:mi>x</mml:mi><mml:mi>e</mml:mi><mml:mi>d</mml:mi></mml:mrow></mml:msub><mml:mo>≥</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:mrow></mml:math></alternatives></disp-formula></p>
  <p>where <inline-formula><alternatives>
  <tex-math><![CDATA[S_{mixed}]]></tex-math>
  <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:msub><mml:mi>S</mml:mi><mml:mrow><mml:mi>m</mml:mi><mml:mi>i</mml:mi><mml:mi>x</mml:mi><mml:mi>e</mml:mi><mml:mi>d</mml:mi></mml:mrow></mml:msub></mml:math></alternatives></inline-formula>
  corresponds to the <monospace>mixed_state</monospace> parameter that
  can be either specified (the <monospace>fit_cumhist()</monospace>
  function uses a default of <monospace>0.5</monospace>) or fitted. The
  general solution for the equation (see Theorem 1 in Wilson
  (<xref alt="1999" rid="ref-Wilson1999" ref-type="bibr">1999</xref>),
  chapter 2, page 15) is</p>
  <p><disp-formula><alternatives>
  <tex-math><![CDATA[\tag{3}h_i(t) = A e^{-t/\tau} + \frac{1}{\tau} \int_{0}^{t} e^{-(t'-t)/\tau} S(t') dt']]></tex-math>
  <mml:math display="block" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:mrow><mml:msub><mml:mi>h</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mrow><mml:mo stretchy="true" form="prefix">(</mml:mo><mml:mi>t</mml:mi><mml:mo stretchy="true" form="postfix">)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mi>A</mml:mi><mml:msup><mml:mi>e</mml:mi><mml:mrow><mml:mo>−</mml:mo><mml:mi>t</mml:mi><mml:mi>/</mml:mi><mml:mi>τ</mml:mi></mml:mrow></mml:msup><mml:mo>+</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:mi>τ</mml:mi></mml:mfrac><mml:msubsup><mml:mo>∫</mml:mo><mml:mn>0</mml:mn><mml:mi>t</mml:mi></mml:msubsup><mml:msup><mml:mi>e</mml:mi><mml:mrow><mml:mo>−</mml:mo><mml:mrow><mml:mo stretchy="true" form="prefix">(</mml:mo><mml:mi>t</mml:mi><mml:mi>′</mml:mi><mml:mo>−</mml:mo><mml:mi>t</mml:mi><mml:mo stretchy="true" form="postfix">)</mml:mo></mml:mrow><mml:mi>/</mml:mi><mml:mi>τ</mml:mi></mml:mrow></mml:msup><mml:mi>S</mml:mi><mml:mrow><mml:mo stretchy="true" form="prefix">(</mml:mo><mml:mi>t</mml:mi><mml:mi>′</mml:mi><mml:mo stretchy="true" form="postfix">)</mml:mo></mml:mrow><mml:mi>d</mml:mi><mml:mi>t</mml:mi><mml:mi>′</mml:mi></mml:mrow></mml:math></alternatives></disp-formula></p>
  <p>where <inline-formula><alternatives>
  <tex-math><![CDATA[A]]></tex-math>
  <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:mi>A</mml:mi></mml:math></alternatives></inline-formula>
  is chosen to satisfy the initial condition. Assuming a constant signal
  <inline-formula><alternatives>
  <tex-math><![CDATA[S]]></tex-math>
  <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:mi>S</mml:mi></mml:math></alternatives></inline-formula>,
  we obtain <disp-formula><alternatives>
  <tex-math><![CDATA[\tag{4}h_i(t) = A e^{-t/\tau} + S_i \cdot (1 - e^{-t/\tau})]]></tex-math>
  <mml:math display="block" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:mrow><mml:msub><mml:mi>h</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mrow><mml:mo stretchy="true" form="prefix">(</mml:mo><mml:mi>t</mml:mi><mml:mo stretchy="true" form="postfix">)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mi>A</mml:mi><mml:msup><mml:mi>e</mml:mi><mml:mrow><mml:mo>−</mml:mo><mml:mi>t</mml:mi><mml:mi>/</mml:mi><mml:mi>τ</mml:mi></mml:mrow></mml:msup><mml:mo>+</mml:mo><mml:msub><mml:mi>S</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>⋅</mml:mo><mml:mrow><mml:mo stretchy="true" form="prefix">(</mml:mo><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:msup><mml:mi>e</mml:mi><mml:mrow><mml:mo>−</mml:mo><mml:mi>t</mml:mi><mml:mi>/</mml:mi><mml:mi>τ</mml:mi></mml:mrow></mml:msup><mml:mo stretchy="true" form="postfix">)</mml:mo></mml:mrow></mml:mrow></mml:math></alternatives></disp-formula></p>
  <p>For the cumulative history, we are interested in
  <inline-formula><alternatives>
  <tex-math><![CDATA[h_i(t + \Delta t)]]></tex-math>
  <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:mrow><mml:msub><mml:mi>h</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mrow><mml:mo stretchy="true" form="prefix">(</mml:mo><mml:mi>t</mml:mi><mml:mo>+</mml:mo><mml:mi>Δ</mml:mi><mml:mi>t</mml:mi><mml:mo stretchy="true" form="postfix">)</mml:mo></mml:mrow></mml:mrow></mml:math></alternatives></inline-formula>:
  a change following a dominance phase that starts at time
  <inline-formula><alternatives>
  <tex-math><![CDATA[t]]></tex-math>
  <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:mi>t</mml:mi></mml:math></alternatives></inline-formula>,
  ends at time <inline-formula><alternatives>
  <tex-math><![CDATA[t + \Delta t]]></tex-math>
  <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:mrow><mml:mi>t</mml:mi><mml:mo>+</mml:mo><mml:mi>Δ</mml:mi><mml:mi>t</mml:mi></mml:mrow></mml:math></alternatives></inline-formula>,
  and has a constant signal strength <inline-formula><alternatives>
  <tex-math><![CDATA[S_i]]></tex-math>
  <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:msub><mml:mi>S</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:math></alternatives></inline-formula>.
  Assuming that a dominance phase starts at
  <inline-formula><alternatives>
  <tex-math><![CDATA[t=0]]></tex-math>
  <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:mrow><mml:mi>t</mml:mi><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:math></alternatives></inline-formula>
  and substituting into the equation 4, <inline-formula><alternatives>
  <tex-math><![CDATA[h_i(0) = A]]></tex-math>
  <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:mrow><mml:msub><mml:mi>h</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mrow><mml:mo stretchy="true" form="prefix">(</mml:mo><mml:mn>0</mml:mn><mml:mo stretchy="true" form="postfix">)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mi>A</mml:mi></mml:mrow></mml:math></alternatives></inline-formula>.
  In other words, constant <inline-formula><alternatives>
  <tex-math><![CDATA[A]]></tex-math>
  <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:mi>A</mml:mi></mml:math></alternatives></inline-formula>
  is equal to cumulative history state before the dominance phase onset
  and, therefore, the relative signal strength during the dominance
  phase is determined by the difference between the signal strength and
  the initial cumulative history value: <inline-formula><alternatives>
  <tex-math><![CDATA[S_i - h_i(0)]]></tex-math>
  <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:mrow><mml:msub><mml:mi>S</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>h</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mrow><mml:mo stretchy="true" form="prefix">(</mml:mo><mml:mn>0</mml:mn><mml:mo stretchy="true" form="postfix">)</mml:mo></mml:mrow></mml:mrow></mml:math></alternatives></inline-formula>.
  Thus <disp-formula><alternatives>
  <tex-math><![CDATA[\tag{5} h_i(\Delta t) = h_i(0) + (S - h_i(0)) \cdot (1 - e^{-\Delta t/\tau})]]></tex-math>
  <mml:math display="block" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:mrow><mml:msub><mml:mi>h</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mrow><mml:mo stretchy="true" form="prefix">(</mml:mo><mml:mi>Δ</mml:mi><mml:mi>t</mml:mi><mml:mo stretchy="true" form="postfix">)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:msub><mml:mi>h</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mrow><mml:mo stretchy="true" form="prefix">(</mml:mo><mml:mn>0</mml:mn><mml:mo stretchy="true" form="postfix">)</mml:mo></mml:mrow><mml:mo>+</mml:mo><mml:mrow><mml:mo stretchy="true" form="prefix">(</mml:mo><mml:mi>S</mml:mi><mml:mo>−</mml:mo><mml:msub><mml:mi>h</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mrow><mml:mo stretchy="true" form="prefix">(</mml:mo><mml:mn>0</mml:mn><mml:mo stretchy="true" form="postfix">)</mml:mo></mml:mrow><mml:mo stretchy="true" form="postfix">)</mml:mo></mml:mrow><mml:mo>⋅</mml:mo><mml:mrow><mml:mo stretchy="true" form="prefix">(</mml:mo><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:msup><mml:mi>e</mml:mi><mml:mrow><mml:mo>−</mml:mo><mml:mi>Δ</mml:mi><mml:mi>t</mml:mi><mml:mi>/</mml:mi><mml:mi>τ</mml:mi></mml:mrow></mml:msup><mml:mo stretchy="true" form="postfix">)</mml:mo></mml:mrow></mml:mrow></mml:math></alternatives></disp-formula>
  <disp-formula><alternatives>
  <tex-math><![CDATA[\tag{6} h_i(\Delta t) = S + (h_i(0) - S)  \cdot e^{-\Delta t/\tau}]]></tex-math>
  <mml:math display="block" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:mrow><mml:msub><mml:mi>h</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mrow><mml:mo stretchy="true" form="prefix">(</mml:mo><mml:mi>Δ</mml:mi><mml:mi>t</mml:mi><mml:mo stretchy="true" form="postfix">)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mi>S</mml:mi><mml:mo>+</mml:mo><mml:mrow><mml:mo stretchy="true" form="prefix">(</mml:mo><mml:msub><mml:mi>h</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mrow><mml:mo stretchy="true" form="prefix">(</mml:mo><mml:mn>0</mml:mn><mml:mo stretchy="true" form="postfix">)</mml:mo></mml:mrow><mml:mo>−</mml:mo><mml:mi>S</mml:mi><mml:mo stretchy="true" form="postfix">)</mml:mo></mml:mrow><mml:mo>⋅</mml:mo><mml:msup><mml:mi>e</mml:mi><mml:mrow><mml:mo>−</mml:mo><mml:mi>Δ</mml:mi><mml:mi>t</mml:mi><mml:mi>/</mml:mi><mml:mi>τ</mml:mi></mml:mrow></mml:msup></mml:mrow></mml:math></alternatives></disp-formula></p>
  <p>The figure below shows accumulation over time for three different
  initial values (<inline-formula><alternatives>
  <tex-math><![CDATA[h(0)]]></tex-math>
  <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:mrow><mml:mi>h</mml:mi><mml:mrow><mml:mo stretchy="true" form="prefix">(</mml:mo><mml:mn>0</mml:mn><mml:mo stretchy="true" form="postfix">)</mml:mo></mml:mrow></mml:mrow></mml:math></alternatives></inline-formula>),
  signal strength (<inline-formula><alternatives>
  <tex-math><![CDATA[S]]></tex-math>
  <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:mi>S</mml:mi></mml:math></alternatives></inline-formula>),
  and time constants (<inline-formula><alternatives>
  <tex-math><![CDATA[tau]]></tex-math>
  <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:mrow><mml:mi>t</mml:mi><mml:mi>a</mml:mi><mml:mi>u</mml:mi></mml:mrow></mml:math></alternatives></inline-formula>).
  Note that the package allows one to either specify and fit both the
  time constant (argument <monospace>tau</monospace> in
  <monospace>fit_cumhist()</monospace> function) and the initial history
  value at the block (<monospace>history_init</monospace> argument).</p>
  <fig>
    <caption><p><bold>Figure 2. Cumulative history for different initial
    conditions, signal strength, and time constants.</bold>
    <styled-content id="figU003Afig2"></styled-content></p></caption>
    <graphic mimetype="image" mime-subtype="png" xlink:href="media/fig2.png" xlink:title="" />
  </fig>
  <p>For a bistable case, there are two history states, one for each
  perceptual state. Therefore, we compute a history as a difference of
  cumulative histories: <disp-formula><alternatives>
  <tex-math><![CDATA[\tag{7}\Delta h(t, \tau) = h_{suppressed}(t, \tau) - h_{dominant}(t, \tau) ]]></tex-math>
  <mml:math display="block" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:mrow><mml:mi>Δ</mml:mi><mml:mi>h</mml:mi><mml:mrow><mml:mo stretchy="true" form="prefix">(</mml:mo><mml:mi>t</mml:mi><mml:mo>,</mml:mo><mml:mi>τ</mml:mi><mml:mo stretchy="true" form="postfix">)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:msub><mml:mi>h</mml:mi><mml:mrow><mml:mi>s</mml:mi><mml:mi>u</mml:mi><mml:mi>p</mml:mi><mml:mi>p</mml:mi><mml:mi>r</mml:mi><mml:mi>e</mml:mi><mml:mi>s</mml:mi><mml:mi>s</mml:mi><mml:mi>e</mml:mi><mml:mi>d</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo stretchy="true" form="prefix">(</mml:mo><mml:mi>t</mml:mi><mml:mo>,</mml:mo><mml:mi>τ</mml:mi><mml:mo stretchy="true" form="postfix">)</mml:mo></mml:mrow><mml:mo>−</mml:mo><mml:msub><mml:mi>h</mml:mi><mml:mrow><mml:mi>d</mml:mi><mml:mi>o</mml:mi><mml:mi>m</mml:mi><mml:mi>i</mml:mi><mml:mi>n</mml:mi><mml:mi>a</mml:mi><mml:mi>n</mml:mi><mml:mi>t</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo stretchy="true" form="prefix">(</mml:mo><mml:mi>t</mml:mi><mml:mo>,</mml:mo><mml:mi>τ</mml:mi><mml:mo stretchy="true" form="postfix">)</mml:mo></mml:mrow></mml:mrow></mml:math></alternatives></disp-formula>
  where <inline-formula><alternatives>
  <tex-math><![CDATA[h_{dominant}]]></tex-math>
  <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:msub><mml:mi>h</mml:mi><mml:mrow><mml:mi>d</mml:mi><mml:mi>o</mml:mi><mml:mi>m</mml:mi><mml:mi>i</mml:mi><mml:mi>n</mml:mi><mml:mi>a</mml:mi><mml:mi>n</mml:mi><mml:mi>t</mml:mi></mml:mrow></mml:msub></mml:math></alternatives></inline-formula>
  and <inline-formula><alternatives>
  <tex-math><![CDATA[h_{suppressed}]]></tex-math>
  <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:msub><mml:mi>h</mml:mi><mml:mrow><mml:mi>s</mml:mi><mml:mi>u</mml:mi><mml:mi>p</mml:mi><mml:mi>p</mml:mi><mml:mi>r</mml:mi><mml:mi>e</mml:mi><mml:mi>s</mml:mi><mml:mi>s</mml:mi><mml:mi>e</mml:mi><mml:mi>d</mml:mi></mml:mrow></mml:msub></mml:math></alternatives></inline-formula>
  are history states for currently dominant and suppressed states,
  respectively. <italic>E.g.</italic>, if a left eye dominates during
  the following phase, <inline-formula><alternatives>
  <tex-math><![CDATA[h_{dominant} = h_{left}]]></tex-math>
  <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:mrow><mml:msub><mml:mi>h</mml:mi><mml:mrow><mml:mi>d</mml:mi><mml:mi>o</mml:mi><mml:mi>m</mml:mi><mml:mi>i</mml:mi><mml:mi>n</mml:mi><mml:mi>a</mml:mi><mml:mi>n</mml:mi><mml:mi>t</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mi>h</mml:mi><mml:mrow><mml:mi>l</mml:mi><mml:mi>e</mml:mi><mml:mi>f</mml:mi><mml:mi>t</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></alternatives></inline-formula>
  and <inline-formula><alternatives>
  <tex-math><![CDATA[h_{suppressed} = h_{right}]]></tex-math>
  <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:mrow><mml:msub><mml:mi>h</mml:mi><mml:mrow><mml:mi>s</mml:mi><mml:mi>u</mml:mi><mml:mi>p</mml:mi><mml:mi>p</mml:mi><mml:mi>r</mml:mi><mml:mi>e</mml:mi><mml:mi>s</mml:mi><mml:mi>s</mml:mi><mml:mi>e</mml:mi><mml:mi>d</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mi>h</mml:mi><mml:mrow><mml:mi>r</mml:mi><mml:mi>i</mml:mi><mml:mi>g</mml:mi><mml:mi>h</mml:mi><mml:mi>t</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></alternatives></inline-formula>
  and vice versa.</p>
</sec>
<sec id="usage-and-features">
  <title>Usage and Features</title>
  <p>The main function is <monospace>fit_cumhist()</monospace>, which
  takes a data frame with time-series as a first argument. In addition,
  you need to specify the name of the column that codes the perceptual
  state (<monospace>state</monospace> argument) and a column that holds
  either dominance phase duration (<monospace>duration</monospace>) or
  its onset (<monospace>onset</monospace>). The code below is the
  simplest case scenario, fitting data using the Gamma distribution
  (default family) for a single run of a single participant. By default,
  the function fits the time constant <inline-formula><alternatives>
  <tex-math><![CDATA[\tau]]></tex-math>
  <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:mi>τ</mml:mi></mml:math></alternatives></inline-formula>
  for slowly accumulating adaptation but uses default values for other
  parameters that influence history computation.</p>
  <code language="r script">library(bistablehistory)
data(br_singleblock)
gamma_fit &lt;- fit_cumhist(br_singleblock,
                        state=&quot;State&quot;,
                        duration=&quot;Duration&quot;,
                        refresh=0)</code>
  <p>Alternatively, one can specify the <italic>onset</italic> of
  individual dominance phases to compute their duration.</p>
  <code language="r script">gamma_fit &lt;- fit_cumhist(br_singleblock,
                        state=&quot;State&quot;,
                        onset=&quot;Time&quot;)</code>
  <p>Utility functions simplify extracting information about fitted
  parameters. For example, one can look at the fitted value for history
  time constant using <monospace>history_tau()</monospace></p>
  <code language="r script">history_tau(gamma_fit)</code>
  <p>or the main effect of history for both parameters of gamma
  distribution via</p>
  <code language="r script">historyef(gamma_fit)</code>
  <p>extract an estimate of perceptual history / adaptation using
  <monospace>extract_history()</monospace> function</p>
  <code language="r script">H &lt;- extract_history(gam_fit)</code>
  <p>or compute an expected duration for each dominance phase via
  <monospace>predict()</monospace></p>
  <code language="r script">br_singleblock$Predicted &lt;- predict(gam_fit)</code>
  <p>The package extends the analysis to multiple experimental runs (via
  the <monospace>run</monospace> argument that specifies a variable that
  identifies individual runs), to experimental sessions (via the
  <monospace>session</monospace> argument) that are assumed to have
  different average dominance phase durations
  (<xref alt="Suzuki &amp; Grabowecky, 2007" rid="ref-Suzuki2007" ref-type="bibr">Suzuki
  &amp; Grabowecky, 2007</xref>), and to multiple participants (via
  <monospace>random_effect</monospace> argument). It also allows
  incorporating fixed effects, although they are restricted to
  continuous metric variables (see a vignette on reusing model code
  directly in Stan for overcoming these limitations).</p>
  <p>The example below demonstrates an analysis for many observers
  (<monospace>random_effect = &quot;Observer&quot;</monospace>) who
  performed multiple runs
  (<monospace>run = &quot;Block&quot;</monospace>) taking into account
  when the dominance phase occurred
  (<monospace>fixed_effects = &quot;LogTime&quot;</monospace>). It also
  uses custom prior for <monospace>tau</monospace> parameter and custom
  control parameters for the Stan sampler. Please refer to “Usage
  Examples” vignette for details on these and other settings.</p>
  <code language="r script">library(bistablehistory)
library(tidyverse)

data(kde)
kde$LogTime &lt;- log(kde$Time)
kde_fit &lt;- fit_cumhist(kde,
                       state = &quot;State&quot;,
                       duration = &quot;Duration&quot;,
                       random_effect = &quot;Observer&quot;,
                       fixed_effects = &quot;LogTime&quot;,
                       run = &quot;Block&quot;,
                       tau = &quot;1|random&quot;,
                       history_priors = list(&quot;tau&quot;=c(log(0.5), 0.3)),
                       chains = 4,
                       control = list(max_treedepth = 15,
                                      adapt_delta = 0.99))
  </code>
  <p>Models fits can be compared via information criteria. Specifically,
  the log-likelihood is stored in a <monospace>log_lik</monospace>
  parameter that can be directly using
  <monospace>loo::extract_log_lik()</monospace> function (see package
  (<xref alt="Vehtari et al., 2020" rid="ref-loo_package" ref-type="bibr">Vehtari
  et al., 2020</xref>)) or used to compute either a leave-one-out
  cross-validation (via <monospace>loo()</monospace> convenience
  function) or WAIC (via <monospace>waic()</monospace>). These are
  information criteria that can be used for model comparison the same
  way as Akaike (AIC), Bayesian (BIC), or deviance (DIC) information
  criteria. The latter can also be computed from log-likelihood, but
  WAIC and LOOCV are both recommended for multi-level models, see
  (<xref alt="Vehtari et al., 2017" rid="ref-loo" ref-type="bibr">Vehtari
  et al., 2017</xref>). The model comparison itself can be performed via
  <monospace>loo::loo_compare()</monospace> function from the
  <monospace>loo</monospace> package.</p>
  <code language="r script">library(loo)
fit1 &lt;- fit_cumhist(br_singleblock,
                    state=&quot;State&quot;,
                    onset=&quot;Time&quot;)
                        
br_singleblock$LogTime &lt;- log(br_singleblock$Time)
fit2 &lt;- fit_cumhist(br_singleblock,
                    state=&quot;State&quot;,
                    onset=&quot;Time&quot;,
                    fixed_effects = &quot;LogTime&quot;)
                    
loo::loo_compare(list(&quot;null&quot; = loo(fit1),
                      &quot;+logTime&quot; = loo(fit2)))</code>
</sec>
</body>
<back>
<ref-list>
  <ref id="ref-PastukhovBraun2011">
    <element-citation publication-type="article-journal">
      <person-group person-group-type="author">
        <name><surname>Pastukhov</surname><given-names>Alexander</given-names></name>
        <name><surname>Braun</surname><given-names>Jochen</given-names></name>
      </person-group>
      <article-title>Cumulative history quantifies the role of neural adaptation in multistable perception</article-title>
      <source>Journal of Vision</source>
      <year iso-8601-date="2011-09">2011</year><month>09</month>
      <volume>11</volume>
      <issue>10</issue>
      <issn>1534-7362</issn>
      <uri>http://jov.arvojournals.org/Article.aspx?doi=10.1167/11.10.12 https://doi.org/10.1167/11.10.12</uri>
      <pub-id pub-id-type="doi">10.1167/11.10.12</pub-id>
      <pub-id pub-id-type="pmid">21931128</pub-id>
      <fpage>12</fpage>
      <lpage>12</lpage>
    </element-citation>
  </ref>
  <ref id="ref-zenodo">
    <element-citation publication-type="article-journal">
      <person-group person-group-type="author">
        <name><surname>Pastukhov</surname><given-names>Alexander</given-names></name>
      </person-group>
      <article-title>Cumulative history analaysis for bistable perception time series</article-title>
      <publisher-name>Zenodo</publisher-name>
      <year iso-8601-date="2021-10">2021</year><month>10</month>
      <pub-id pub-id-type="doi">10.5281/zenodo.5851674</pub-id>
    </element-citation>
  </ref>
  <ref id="ref-Clifford2007">
    <element-citation publication-type="article-journal">
      <person-group person-group-type="author">
        <name><surname>Clifford</surname><given-names>Colin W. G.</given-names></name>
        <name><surname>Webster</surname><given-names>Michael a</given-names></name>
        <name><surname>Stanley</surname><given-names>Garrett B</given-names></name>
        <name><surname>Stocker</surname><given-names>Alan a</given-names></name>
        <name><surname>Kohn</surname><given-names>Adam</given-names></name>
        <name><surname>Sharpee</surname><given-names>Tatyana O</given-names></name>
        <name><surname>Schwartz</surname><given-names>Odelia</given-names></name>
      </person-group>
      <article-title>Visual adaptation: Neural, psychological and computational aspects</article-title>
      <source>Vision Research</source>
      <year iso-8601-date="2007-11">2007</year><month>11</month>
      <volume>47</volume>
      <issue>25</issue>
      <pub-id pub-id-type="doi">10.1016/j.visres.2007.08.023</pub-id>
      <pub-id pub-id-type="pmid">17936871</pub-id>
      <fpage>3125</fpage>
      <lpage>3131</lpage>
    </element-citation>
  </ref>
  <ref id="ref-VanEe2009">
    <element-citation publication-type="article-journal">
      <person-group person-group-type="author">
        <name><surname>Ee</surname><given-names>Raymond van</given-names></name>
      </person-group>
      <article-title>Stochastic variations in sensory awareness are driven by noisy neuronal adaptation: evidence from serial correlations in perceptual bistability</article-title>
      <source>Journal of the Optical Society of America A</source>
      <year iso-8601-date="2009-12">2009</year><month>12</month>
      <volume>26</volume>
      <issue>12</issue>
      <issn>1084-7529</issn>
      <uri>https://www.osapublishing.org/abstract.cfm?URI=josaa-26-12-2612 http://www.ncbi.nlm.nih.gov/pubmed/19956332</uri>
      <pub-id pub-id-type="doi">10.1364/JOSAA.26.002612</pub-id>
      <pub-id pub-id-type="pmid">19956332</pub-id>
      <fpage>2612</fpage>
      <lpage></lpage>
    </element-citation>
  </ref>
  <ref id="ref-carpenter2017stan">
    <element-citation publication-type="article-journal">
      <person-group person-group-type="author">
        <name><surname>Carpenter</surname><given-names>Bob</given-names></name>
        <name><surname>Gelman</surname><given-names>Andrew</given-names></name>
        <name><surname>Hoffman</surname><given-names>Matthew D</given-names></name>
        <name><surname>Lee</surname><given-names>Daniel</given-names></name>
        <name><surname>Goodrich</surname><given-names>Ben</given-names></name>
        <name><surname>Betancourt</surname><given-names>Michael</given-names></name>
        <name><surname>Brubaker</surname><given-names>Marcus</given-names></name>
        <name><surname>Guo</surname><given-names>Jiqiang</given-names></name>
        <name><surname>Li</surname><given-names>Peter</given-names></name>
        <name><surname>Riddell</surname><given-names>Allen</given-names></name>
      </person-group>
      <article-title>Stan: A probabilistic programming language</article-title>
      <source>Journal of statistical software</source>
      <publisher-name>Columbia Univ., New York, NY (United States); Harvard Univ., Cambridge, MA (United States)</publisher-name>
      <year iso-8601-date="2017">2017</year>
      <volume>76</volume>
      <issue>1</issue>
      <pub-id pub-id-type="doi">10.18637/jss.v076.i01</pub-id>
    </element-citation>
  </ref>
  <ref id="ref-loo">
    <element-citation publication-type="article-journal">
      <person-group person-group-type="author">
        <name><surname>Vehtari</surname><given-names>Aki</given-names></name>
        <name><surname>Gelman</surname><given-names>Andrew</given-names></name>
        <name><surname>Gabry</surname><given-names>Jonah</given-names></name>
      </person-group>
      <article-title>Practical bayesian model evaluation using leave-one-out cross-validation and WAIC</article-title>
      <source>Statistics and Computing</source>
      <year iso-8601-date="2017">2017</year>
      <volume>27</volume>
      <pub-id pub-id-type="doi">10.1007/s11222-016-9696-4</pub-id>
      <fpage>1413</fpage>
      <lpage>1432</lpage>
    </element-citation>
  </ref>
  <ref id="ref-Wilson1999">
    <element-citation publication-type="book">
      <person-group person-group-type="author">
        <name><surname>Wilson</surname><given-names>Hugh R</given-names></name>
      </person-group>
      <source>Spikes, Decisions &amp; Actions: Dynamical Foundations of Neuroscience</source>
      <publisher-name>Oxford University Press</publisher-name>
      <publisher-loc>Oxford UK</publisher-loc>
      <year iso-8601-date="1999">1999</year>
      <fpage>324</fpage>
      <lpage></lpage>
    </element-citation>
  </ref>
  <ref id="ref-loo_package">
    <element-citation>
      <person-group person-group-type="author">
        <name><surname>Vehtari</surname><given-names>Aki</given-names></name>
        <name><surname>Gabry</surname><given-names>Jonah</given-names></name>
        <name><surname>Magnusson</surname><given-names>Mans</given-names></name>
        <name><surname>Yao</surname><given-names>Yuling</given-names></name>
        <name><surname>Bürkner</surname><given-names>Paul-Christian</given-names></name>
        <name><surname>Paananen</surname><given-names>Topi</given-names></name>
        <name><surname>Gelman</surname><given-names>Andrew</given-names></name>
      </person-group>
      <article-title>Loo: Efficient leave-one-out cross-validation and WAIC for bayesian models</article-title>
      <year iso-8601-date="2020">2020</year>
      <uri>https://mc-stan.org/loo/</uri>
    </element-citation>
  </ref>
  <ref id="ref-Suzuki2007">
    <element-citation publication-type="article-journal">
      <person-group person-group-type="author">
        <name><surname>Suzuki</surname><given-names>Satoru</given-names></name>
        <name><surname>Grabowecky</surname><given-names>Marcia</given-names></name>
      </person-group>
      <article-title>Long-term speeding in perceptual switches mediated by attention-dependent plasticity in cortical visual processing.</article-title>
      <source>Neuron</source>
      <year iso-8601-date="2007-11">2007</year><month>11</month>
      <volume>56</volume>
      <issue>4</issue>
      <issn>0896-6273</issn>
      <uri>http://www.ncbi.nlm.nih.gov/pubmed/18031689</uri>
      <pub-id pub-id-type="doi">10.1016/j.neuron.2007.09.028</pub-id>
      <pub-id pub-id-type="pmid">18031689</pub-id>
      <fpage>741</fpage>
      <lpage>53</lpage>
    </element-citation>
  </ref>
  <ref id="ref-varstan">
    <element-citation publication-type="article-journal">
      <person-group person-group-type="author">
        <name><surname>Alonzo</surname><given-names>Izhar Asael</given-names></name>
        <name><surname>Cruz</surname><given-names>Cristian</given-names></name>
      </person-group>
      <article-title>varstan: An R package for Bayesian time series models with Stan</article-title>
      <source>ARXIV Preprint</source>
      <year iso-8601-date="2020">2020</year>
    </element-citation>
  </ref>
  <ref id="ref-forecast">
    <element-citation publication-type="article-journal">
      <person-group person-group-type="author">
        <name><surname>Hyndman</surname><given-names>Rob J</given-names></name>
        <name><surname>Khandakar</surname><given-names>Yeasmin</given-names></name>
      </person-group>
      <article-title>Automatic time series forecasting: The forecast package for R</article-title>
      <source>Journal of Statistical Software</source>
      <year iso-8601-date="2008">2008</year>
      <volume>26</volume>
      <issue>3</issue>
      <pub-id pub-id-type="doi">10.18637/jss.v027.i03</pub-id>
      <fpage>1</fpage>
      <lpage>22</lpage>
    </element-citation>
  </ref>
</ref-list>
</back>
</article>
