<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE article PUBLIC "-//NLM//DTD JATS (Z39.96) Journal Publishing DTD v1.2 20190208//EN"
                  "JATS-publishing1.dtd">
<article xmlns:mml="http://www.w3.org/1998/Math/MathML" xmlns:xlink="http://www.w3.org/1999/xlink" dtd-version="1.2" article-type="other">
<front>
<journal-meta>
<journal-id></journal-id>
<journal-title-group>
<journal-title>Journal of Open Source Software</journal-title>
<abbrev-journal-title>JOSS</abbrev-journal-title>
</journal-title-group>
<issn publication-format="electronic">2475-9066</issn>
<publisher>
<publisher-name>Open Journals</publisher-name>
</publisher>
</journal-meta>
<article-meta>
<article-id pub-id-type="publisher-id">6963</article-id>
<article-id pub-id-type="doi">10.21105/joss.06963</article-id>
<title-group>
<article-title>OpenCCM: An Open-Source Continuous Compartmental
Modelling Package</article-title>
</title-group>
<contrib-group>
<contrib contrib-type="author">
<contrib-id contrib-id-type="orcid">https://orcid.org/0000-0002-0233-0172</contrib-id>
<name>
<surname>Vasile</surname>
<given-names>Alexandru Andrei</given-names>
</name>
<xref ref-type="aff" rid="aff-1"/>
</contrib>
<contrib contrib-type="author">
<contrib-id contrib-id-type="orcid">https://orcid.org/0009-0005-6832-1761</contrib-id>
<name>
<surname>Tino</surname>
<given-names>Matthew Peres</given-names>
</name>
<xref ref-type="aff" rid="aff-1"/>
</contrib>
<contrib contrib-type="author">
<contrib-id contrib-id-type="orcid">https://orcid.org/0009-0008-4703-3711</contrib-id>
<name>
<surname>Aseri</surname>
<given-names>Yuvraj</given-names>
</name>
<xref ref-type="aff" rid="aff-1"/>
</contrib>
<contrib contrib-type="author" corresp="yes">
<contrib-id contrib-id-type="orcid">https://orcid.org/0000-0002-1772-0376</contrib-id>
<name>
<surname>Abukhdeir</surname>
<given-names>Nasser Mohieddin</given-names>
</name>
<xref ref-type="aff" rid="aff-1"/>
<xref ref-type="aff" rid="aff-2"/>
<xref ref-type="aff" rid="aff-3"/>
<xref ref-type="corresp" rid="cor-1"><sup>*</sup></xref>
</contrib>
<aff id="aff-1">
<institution-wrap>
<institution>Department of Chemical Engineering, University of Waterloo,
Ontario, Canada</institution>
</institution-wrap>
</aff>
<aff id="aff-2">
<institution-wrap>
<institution>Department of Physics and Astronomy, University of
Waterloo, Ontario, Canada</institution>
</institution-wrap>
</aff>
<aff id="aff-3">
<institution-wrap>
<institution>Waterloo Institute for Nanotechnology, University of
Waterloo, Ontario, Canada</institution>
</institution-wrap>
</aff>
</contrib-group>
<author-notes>
<corresp id="cor-1">* E-mail: <email></email></corresp>
</author-notes>
<volume>9</volume>
<issue>102</issue>
<fpage>6963</fpage>
<permissions>
<copyright-statement>Authors of papers retain copyright and release the
work under a Creative Commons Attribution 4.0 International License (CC
BY 4.0)</copyright-statement>
<copyright-year>2022</copyright-year>
<copyright-holder>The article authors</copyright-holder>
<license license-type="open-access" xlink:href="https://creativecommons.org/licenses/by/4.0/">
<license-p>Authors of papers retain copyright and release the work under
a Creative Commons Attribution 4.0 International License (CC BY
4.0)</license-p>
</license>
</permissions>
<kwd-group kwd-group-type="author">
<kwd>Python</kwd>
<kwd>compartmental modelling</kwd>
<kwd>reduced order modelling</kwd>
<kwd>model order reduction</kwd>
<kwd>computational fluid dynamics</kwd>
</kwd-group>
</article-meta>
</front>
<body>
<sec id="summary">
  <title>Summary</title>
  <p><monospace>OpenCCM</monospace> is a compartmental modelling
  (<xref alt="Jourdan et al., 2019" rid="ref-Jourdan2019" ref-type="bibr">Jourdan
  et al., 2019</xref>) software package based on recently developed
  fully automated flow alignment compartmentalization methods
  (<xref alt="Vasile et al., 2024" rid="ref-Vasile2024" ref-type="bibr">Vasile
  et al., 2024</xref>). It is primarily intended for large-scale
  flow-based processes with weak coupling between composition changes,
  e.g., through (bio)chemical reactions, and convective mass transport
  in the system. Compartmental modelling is an important approach used
  to develop reduced-order models
  (<xref alt="Benner et al., 2020" rid="ref-Benner2020" ref-type="bibr">Benner
  et al., 2020</xref>;
  <xref alt="Chinesta et al., 2017" rid="ref-Chinesta2017" ref-type="bibr">Chinesta
  et al., 2017</xref>) using a priori knowledge of process hydrodynamics
  (<xref alt="Jourdan et al., 2019" rid="ref-Jourdan2019" ref-type="bibr">Jourdan
  et al., 2019</xref>). Compartmental modelling methods, such as those
  implemented in <monospace>OpenCCM</monospace>, enable simulations of
  these processes with far less computational complexity while still
  capturing the key aspects of process dynamics.</p>
  <p><monospace>OpenCCM</monospace> integrates with two multiphysics
  simulation software packages, <monospace>OpenCMP</monospace>
  (<xref alt="Monte et al., 2022" rid="ref-Monte2022" ref-type="bibr">Monte
  et al., 2022</xref>) and <monospace>OpenFOAM</monospace>
  (<xref alt="Greenshields, 2024" rid="ref-greenshields2024" ref-type="bibr">Greenshields,
  2024</xref>), allowing for ease of transferring simulation data for
  compartmentalization. Additionally, it provides users with built-in
  functionality for computing residence times and exporting for use in
  other simulation or visualization software, including
  <monospace>ParaView</monospace>
  (<xref alt="Ayachit, 2015" rid="ref-Paraview" ref-type="bibr">Ayachit,
  2015</xref>). Post-processing methods are included for mapping
  simulation results from compartment domains to the original simulation
  domain, which are useful for visualization purposes and for further
  simulations in using other software (e.g., multi-scale modelling).</p>
</sec>
<sec id="statement-of-need">
  <title>Statement of Need</title>
  <p>Simulation-based design and analysis continue to be widely applied
  in the research and development of physicochemical processes.
  Processes with large differences in characteristic time and length
  scales result in the infeasibility of direct multiphysics simulations
  due to computational limitations. This imposes significant
  computational costs, which severely reduce the utility of these
  simulations for entire classes of processes. Compartmental modeling is
  well-suited for such applications because it enables the generatation
  of reduced-order models which are less computationally demanding,
  frequently by orders of magnitude, compared to direct continuum
  mechanical simulations. This is enabled by taking advantage, when
  present, of weak couplings between the short and long-time-scale
  dynamic phenomena.</p>
  <p>However, several barriers prevent the more widespread use of
  compartmental models. The largest of these is the lack of software for
  automating the generation compartmental models. Closed-source software
  packages, specifically <monospace>AMBER</monospace>
  (<xref alt="Quintessa, n.d." rid="ref-Amber" ref-type="bibr">Quintessa,
  n.d.</xref>), exists for manually creating and solving well-mixed
  compartment networks. However, the cost of these packages are
  prohibitive for much of the research community and it lacks automated
  compartmentalization. Open-source software,
  <monospace>Cantera</monospace>
  (<xref alt="Goodwin et al., 2023" rid="ref-Cantera" ref-type="bibr">Goodwin
  et al., 2023</xref>), also exists to solve compartment networks.
  However, it does not incorporate flow information, when available,
  either from direct observation or continuum mechanical simulations.
  Furthermore, neither of these software allow for the usage and direct
  transfer of flow information from continuum mechanical simulations,
  such as computational fluid dynamics (CFD) simulations, which are
  typically feasible over short (hydrodynamic) time scales.</p>
  <p>The overall aim of <monospace>OpenCCM</monospace> is to fill the
  need for an open-source compartmental modeling package that is
  user-friendly, compatible with a variety of simulation package
  back-ends (e.g., <monospace>OpenFOAM</monospace> and
  <monospace>OpenCMP</monospace>), and which fits into the user’s
  existing simulation and post-processing software toolchain, i.e.,
  <monospace>ParaView</monospace>.</p>
</sec>
<sec id="features">
  <title>Features</title>
  <table-wrap>
    <table>
      <colgroup>
        <col width="23%" />
        <col width="77%" />
      </colgroup>
      <thead>
        <tr>
          <th><bold>FEATURE</bold></th>
          <th><bold>DESCRIPTION</bold></th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>Model support</td>
          <td>Accepts <monospace>OpenCMP</monospace>
          (<xref alt="Monte et al., 2022" rid="ref-Monte2022" ref-type="bibr">Monte
          et al., 2022</xref>) and <monospace>OpenFOAM</monospace>
          (<xref alt="Greenshields, 2024" rid="ref-greenshields2024" ref-type="bibr">Greenshields,
          2024</xref>) results</td>
        </tr>
        <tr>
          <td>————————-</td>
          <td>————————————————————————————-</td>
        </tr>
        <tr>
          <td>Compartmentalization</td>
          <td>Single-phase flow-based compartment identification</td>
        </tr>
        <tr>
          <td>————————-</td>
          <td>————————————————————————————-</td>
        </tr>
        <tr>
          <td>Compartmental Modelling</td>
          <td>Plug Flow Reactors (PFRs)-in-series-based model</td>
        </tr>
        <tr>
          <td></td>
          <td>Previous state-of-the-art Continous Stirred-tank reactor
          (CSTR)-based models</td>
        </tr>
        <tr>
          <td>————————-</td>
          <td>————————————————————————————-</td>
        </tr>
        <tr>
          <td>CM Simulations</td>
          <td>Linear, non-linear, and reversible arbitrary
          reactions</td>
        </tr>
        <tr>
          <td></td>
          <td>1st Order upwinding finite-difference-based</td>
        </tr>
        <tr>
          <td></td>
          <td>Adaptive time-stepping</td>
        </tr>
        <tr>
          <td>————————-</td>
          <td>————————————————————————————-</td>
        </tr>
        <tr>
          <td>Post-Processing</td>
          <td>Residence time distribution</td>
        </tr>
        <tr>
          <td>————————-</td>
          <td>————————————————————————————-</td>
        </tr>
        <tr>
          <td>Output</td>
          <td>Intermediary mesh format</td>
        </tr>
        <tr>
          <td></td>
          <td>Labeled compartments in <monospace>Paraview</monospace>
          format</td>
        </tr>
        <tr>
          <td></td>
          <td>Concentrations from CM simulations in both
          <monospace>Paraview</monospace> and simulation package
          format</td>
        </tr>
        <tr>
          <td>————————-</td>
          <td>————————————————————————————-</td>
        </tr>
        <tr>
          <td>Performance</td>
          <td>Multi-threading</td>
        </tr>
        <tr>
          <td></td>
          <td>Caching of intermediary results to speed up subsequent
          runs</td>
        </tr>
      </tbody>
    </table>
  </table-wrap>
</sec>
<sec id="user-interface">
  <title>User Interface</title>
  <p>The <monospace>OpenCCM</monospace> Python package can be used via
  text-based configuration files centred around the command line
  interface (CLI), where each simulation run/project is self-contained
  in a project directory. In addition to the
  <monospace>OpenCCM</monospace> configuration files, the required
  contents include flow information from one of two open-source
  simulation packages: <monospace>OpenCMP</monospace> or
  <monospace>OpenFOAM</monospace>. For <monospace>OpenCMP</monospace>
  three files are required:</p>
  <list list-type="order">
    <list-item>
      <label>1)</label>
      <p>The <monospace>OpenCMP</monospace> config file,</p>
    </list-item>
    <list-item>
      <label>2)</label>
      <p>The mesh on which the simulation was run, and</p>
    </list-item>
    <list-item>
      <label>3)</label>
      <p>The .sol solution file containing the velocity profile to
      create the compartmental model.</p>
    </list-item>
  </list>
  <p>For <monospace>OpenFOAM</monospace>, two sub-directories are
  required:</p>
  <list list-type="order">
    <list-item>
      <label>1)</label>
      <p>The <monospace>constant/</monospace> directory, which contains
      the mesh information in ASCII format,</p>
    </list-item>
    <list-item>
      <label>2)</label>
      <p>A directory containing the simulation results, which will be
      used to create the compartmental model saved in ASCII format.</p>
    </list-item>
  </list>
  <p>The path to the solution directory is specified in the
  <monospace>OpenCCM</monospace> configuration file and the
  <monospace>constant/</monospace> directory is assumed to be in the
  same parent folder. <monospace>OpenCCM</monospace> will create several
  output directories: <monospace>log/</monospace>, which contains
  detailed debugging information (if enabled);
  <monospace>cache/</monospace>, which contains intermediary files; and
  <monospace>output_ccm/</monospace>, which contains both simulation
  results of the compartmental model (in various user-specified formats)
  and <monospace>ParaView</monospace> files for visualization.</p>
  <p>A sample config file, <monospace>CONFIG</monospace>, which outlines
  the available parameters, is included in the main directory. An
  excerpt of it, showing the compartmental modeling parameters, is shown
  below. Square brackets indicate parameters with default values along
  with those values indicated inside the brackets.</p>
  <preformat>[COMPARTMENT MODELLING]
# Whether to use PFRs-in-series or a CSTR to model each compartment.
model                   = PFR
# Volumetric flow through a single facet
# below which the flow is considered 0.
flow_threshold_facet    = [1e-15]
# Volumetric flow threshold through a surface
# below which the flow is considered 0.
flow_threshold          = [1e-15]
# Maximum allowable difference (in % of compartment volume) 
# between connections to merge them into one location.
dist_threshold          = [5 / 100]
# Absolute tolerances for checking that mass is conserved 
# after the flow optimization is performed.
atol_opt                = [1e-2]</preformat>
</sec>
<sec id="reaction-configuration-file">
  <title>Reaction Configuration File</title>
  <p>The chemical reaction parser in <monospace>OpenCCM</monospace>
  reads and parses the reaction configuration files and can handle
  general reaction equations of the form,</p>
  <p><monospace>aA + bB + [...] -&gt; cC + dD + [...]</monospace></p>
  <p>with associated numeric rate constants. It intentionally does not
  support the standard <monospace>&lt;-&gt;</monospace> symbol for
  reversible chemical reactions, so that each independent reaction has
  an explicitly defined rate constant. Therefore, a reversible reaction
  must be written as two independent forward reactions, each with its
  own rate constant. Each species <italic>label</italic> can contain
  letters and numbers, but cannot contain brackets or special
  characters, e.g., “(”, “)”, “+”, “-”, “^”. Kinetic rate constants must
  be expressed as positive real numbers in standard or scientific
  notation. Additionally, each reaction/rate pair must have a unique
  <italic>identifier</italic> (i.e., R1, R2). For example, the
  reversible reaction,</p>
  <p><disp-formula><alternatives>
  <tex-math><![CDATA[2\textrm{NaCl} + \textrm{CaCO}_3 \Leftrightarrow \textrm{Na}_2\textrm{CO}_3 + \textrm{CaCl}_2]]></tex-math>
  <mml:math display="block" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:mrow><mml:mn>2</mml:mn><mml:mtext mathvariant="normal">NaCl</mml:mtext><mml:mo>+</mml:mo><mml:msub><mml:mtext mathvariant="normal">CaCO</mml:mtext><mml:mn>3</mml:mn></mml:msub><mml:mo>⇔</mml:mo><mml:msub><mml:mtext mathvariant="normal">Na</mml:mtext><mml:mn>2</mml:mn></mml:msub><mml:msub><mml:mtext mathvariant="normal">CO</mml:mtext><mml:mn>3</mml:mn></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mtext mathvariant="normal">CaCl</mml:mtext><mml:mn>2</mml:mn></mml:msub></mml:mrow></mml:math></alternatives></disp-formula></p>
  <p>with <inline-formula><alternatives>
  <tex-math><![CDATA[k_f = 5e-2]]></tex-math>
  <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:mrow><mml:msub><mml:mi>k</mml:mi><mml:mi>f</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mn>5</mml:mn><mml:mi>e</mml:mi><mml:mo>−</mml:mo><mml:mn>2</mml:mn></mml:mrow></mml:math></alternatives></inline-formula>
  and <inline-formula><alternatives>
  <tex-math><![CDATA[k_r = 2]]></tex-math>
  <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:mrow><mml:msub><mml:mi>k</mml:mi><mml:mi>r</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mn>2</mml:mn></mml:mrow></mml:math></alternatives></inline-formula>
  (chosen to be dimensionless for example). A configuration file for
  this reversible reaction may then be:</p>
  <preformat>[REACTIONS]
R1: 2NaCl   + CaCO3 -&gt;  Na2CO3 + CaCl2
R2:  Na2CO3 + CaCl2 -&gt; 2NaCl   + CaCO3

[RATES]
R1: 5e-2
R2: 2</preformat>
  <p>where <bold>R1</bold> and <bold>R2</bold> are the reaction
  <italic>identifiers</italic> for the forward and reverse reactions,
  respectively.</p>
  <p>An example reaction config file,
  <monospace>CONFIG_REACTIONS</monospace>, is provided in the main
  package directory.</p>
</sec>
<sec id="examples-of-usage">
  <title>Examples of Usage</title>
  <p>Several examples are provided in the <monospace>OpenCCM</monospace>
  documentation, which demonstrates the using of both
  <monospace>OpenCMP</monospace> and <monospace>OpenFOAM</monospace>
  simulation-based flow information for compartmentalization. One
  example, located in
  <monospace>examples/OpenCMP/pipe_with_recird_2d/</monospace>, uses the
  geometry from
  (<xref alt="Vasile et al., 2024" rid="ref-Vasile2024" ref-type="bibr">Vasile
  et al., 2024</xref>) and shows how to execute the needed CFD
  simulation for flow information (both using
  <monospace>OpenCMP</monospace> and <monospace>OpenFOAM</monospace>),
  create/visualize the compartmental model results, and compare the
  predicted RTD to the reference result directly from CFD
  simulation.</p>
  <p>For this illustrative example, the steady-state hydrodynamic
  flow-profile is obtained by running the <monospace>OpenCMP</monospace>
  simulation through the <monospace>run_OpenCMP.py</monospace> script in
  the folder. The resulting flow profile was opened in
  <monospace>ParaView</monospace> and a line integral convolution
  visualization of the velocity field is shown below, coloured by
  velocity magnitude.</p>
  <fig>
    <caption><p>Visualization of hydrodynamics from CFD simulation with
    line integral convolutions indicating local flow direction and color
    corresponding to velocity magnitude.</p></caption>
    <graphic mimetype="image" mime-subtype="png" xlink:href="lic_domain.png" />
  </fig>
  <p>The underlying velocity field data is then processed using
  <monospace>OpenCCM</monospace> to generate a network of compartments
  by executing the <monospace>run_compartment.py</monospace> script. The
  figure below shows each element of the original mesh coloured
  according to the compartment to which it belongs.</p>
  <fig>
    <caption><p>Visualization of flow-informed compartmentalization with
    coloring corresponding to compartment number.</p></caption>
    <graphic mimetype="image" mime-subtype="png" xlink:href="labelled_compartments.png" />
  </fig>
  <p>That network of compartments is further processed, as each
  compartment is represented by a series of plug-flow reactors (PFRs).
  The resulting network (graph) of PFRs is shown in the figure below.
  Nodes are the centres of the PFRs and edges are connections (flows)
  between PFRs.</p>
  <fig>
    <caption><p>Undirectly graph of the compartment network resulting
    from both (i) flow-information compartmentalization and (ii) the use
    of spatially-varying compartment approximations
    (PFRs).</p></caption>
    <graphic mimetype="application" mime-subtype="pdf" xlink:href="compartment_network.pdf" />
  </fig>
  <sec id="rtd-curves">
    <title>RTD Curves</title>
    <p>The residence time distribution (RTD) curve from both the CFD and
    compartmental model (CM) simulations is computed using the script in
    the supplementary material of
    (<xref alt="Vasile et al., 2024" rid="ref-Vasile2024" ref-type="bibr">Vasile
    et al., 2024</xref>).</p>
    <fig>
      <caption><p>Residence time distribution curves for CFD and CM
      simulations.</p></caption>
      <graphic mimetype="application" mime-subtype="pdf" xlink:href="cfd_vs_pfr_vs_cstr.pdf" />
    </fig>
  </sec>
  <sec id="reactions">
    <title>Reactions</title>
    <p>Finally, to demonstrate how to simulate chemical reaction, an
    example is included using the reversible reaction system from
    above:</p>
    <p><disp-formula><alternatives>
    <tex-math><![CDATA[2\textrm{NaCl} + \textrm{CaCO}_3 \Leftrightarrow \textrm{Na}_2\textrm{CO}_3 + \textrm{CaCl}_2]]></tex-math>
    <mml:math display="block" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:mrow><mml:mn>2</mml:mn><mml:mtext mathvariant="normal">NaCl</mml:mtext><mml:mo>+</mml:mo><mml:msub><mml:mtext mathvariant="normal">CaCO</mml:mtext><mml:mn>3</mml:mn></mml:msub><mml:mo>⇔</mml:mo><mml:msub><mml:mtext mathvariant="normal">Na</mml:mtext><mml:mn>2</mml:mn></mml:msub><mml:msub><mml:mtext mathvariant="normal">CO</mml:mtext><mml:mn>3</mml:mn></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mtext mathvariant="normal">CaCl</mml:mtext><mml:mn>2</mml:mn></mml:msub></mml:mrow></mml:math></alternatives></disp-formula></p>
    <p>with <inline-formula><alternatives>
    <tex-math><![CDATA[k_f = 5e-2]]></tex-math>
    <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:mrow><mml:msub><mml:mi>k</mml:mi><mml:mi>f</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mn>5</mml:mn><mml:mi>e</mml:mi><mml:mo>−</mml:mo><mml:mn>2</mml:mn></mml:mrow></mml:math></alternatives></inline-formula>
    and <inline-formula><alternatives>
    <tex-math><![CDATA[k_r = 2]]></tex-math>
    <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:mrow><mml:msub><mml:mi>k</mml:mi><mml:mi>r</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mn>2</mml:mn></mml:mrow></mml:math></alternatives></inline-formula>
    as the forward and backward rate constants (chosen to be
    dimensionless for example). All species have an initial
    dimensionless concentration of <inline-formula><alternatives>
    <tex-math><![CDATA[0]]></tex-math>
    <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:mn>0</mml:mn></mml:math></alternatives></inline-formula>
    and have inlet boundary dimensionless concentration values of
    <inline-formula><alternatives>
    <tex-math><![CDATA[[\textrm{NaCl}] = [\textrm{CaCO}_3] = 1]]></tex-math>
    <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:mrow><mml:mrow><mml:mo stretchy="true" form="prefix">[</mml:mo><mml:mtext mathvariant="normal">NaCl</mml:mtext><mml:mo stretchy="true" form="postfix">]</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mrow><mml:mo stretchy="true" form="prefix">[</mml:mo><mml:msub><mml:mtext mathvariant="normal">CaCO</mml:mtext><mml:mn>3</mml:mn></mml:msub><mml:mo stretchy="true" form="postfix">]</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:math></alternatives></inline-formula>
    and <inline-formula><alternatives>
    <tex-math><![CDATA[[\textrm{Na}_2\textrm{CO}_3] = [\textrm{CaCl}_2] = 0]]></tex-math>
    <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:mrow><mml:mrow><mml:mo stretchy="true" form="prefix">[</mml:mo><mml:msub><mml:mtext mathvariant="normal">Na</mml:mtext><mml:mn>2</mml:mn></mml:msub><mml:msub><mml:mtext mathvariant="normal">CO</mml:mtext><mml:mn>3</mml:mn></mml:msub><mml:mo stretchy="true" form="postfix">]</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mrow><mml:mo stretchy="true" form="prefix">[</mml:mo><mml:msub><mml:mtext mathvariant="normal">CaCl</mml:mtext><mml:mn>2</mml:mn></mml:msub><mml:mo stretchy="true" form="postfix">]</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:math></alternatives></inline-formula>.
    The equations and conditions have already been specified, and the
    simulation can be run by using the
    <monospace>run_compartment_w_rxn.py</monospace> script. Note that
    when this script is run multiple times, computational times
    following the first will be much shorter in that the compartmental
    model is pre-computed (stored within the project directory).</p>
    <p>To analyze the results, the equilibrium values for this
    reversible system are calculated as follows:</p>
    <p><disp-formula><alternatives>
    <tex-math><![CDATA[ k_f [\textrm{NaCl}]^2[\textrm{CaCO}_3] = k_r [\textrm{Na}_2\textrm{CO}_3][\textrm{CaCl}_2] ]]></tex-math>
    <mml:math display="block" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:mrow><mml:msub><mml:mi>k</mml:mi><mml:mi>f</mml:mi></mml:msub><mml:msup><mml:mrow><mml:mo stretchy="true" form="prefix">[</mml:mo><mml:mtext mathvariant="normal">NaCl</mml:mtext><mml:mo stretchy="true" form="postfix">]</mml:mo></mml:mrow><mml:mn>2</mml:mn></mml:msup><mml:mrow><mml:mo stretchy="true" form="prefix">[</mml:mo><mml:msub><mml:mtext mathvariant="normal">CaCO</mml:mtext><mml:mn>3</mml:mn></mml:msub><mml:mo stretchy="true" form="postfix">]</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:msub><mml:mi>k</mml:mi><mml:mi>r</mml:mi></mml:msub><mml:mrow><mml:mo stretchy="true" form="prefix">[</mml:mo><mml:msub><mml:mtext mathvariant="normal">Na</mml:mtext><mml:mn>2</mml:mn></mml:msub><mml:msub><mml:mtext mathvariant="normal">CO</mml:mtext><mml:mn>3</mml:mn></mml:msub><mml:mo stretchy="true" form="postfix">]</mml:mo></mml:mrow><mml:mrow><mml:mo stretchy="true" form="prefix">[</mml:mo><mml:msub><mml:mtext mathvariant="normal">CaCl</mml:mtext><mml:mn>2</mml:mn></mml:msub><mml:mo stretchy="true" form="postfix">]</mml:mo></mml:mrow></mml:mrow></mml:math></alternatives></disp-formula>
    <disp-formula><alternatives>
    <tex-math><![CDATA[ \frac{k_f}{k_r} = \frac{[\textrm{Na}_2\textrm{CO}_3][\textrm{CaCl}_2]}{[\textrm{NaCl}]^2[\textrm{CaCO}_3]} ]]></tex-math>
    <mml:math display="block" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:mrow><mml:mfrac><mml:msub><mml:mi>k</mml:mi><mml:mi>f</mml:mi></mml:msub><mml:msub><mml:mi>k</mml:mi><mml:mi>r</mml:mi></mml:msub></mml:mfrac><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mrow><mml:mo stretchy="true" form="prefix">[</mml:mo><mml:msub><mml:mtext mathvariant="normal">Na</mml:mtext><mml:mn>2</mml:mn></mml:msub><mml:msub><mml:mtext mathvariant="normal">CO</mml:mtext><mml:mn>3</mml:mn></mml:msub><mml:mo stretchy="true" form="postfix">]</mml:mo></mml:mrow><mml:mrow><mml:mo stretchy="true" form="prefix">[</mml:mo><mml:msub><mml:mtext mathvariant="normal">CaCl</mml:mtext><mml:mn>2</mml:mn></mml:msub><mml:mo stretchy="true" form="postfix">]</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:msup><mml:mrow><mml:mo stretchy="true" form="prefix">[</mml:mo><mml:mtext mathvariant="normal">NaCl</mml:mtext><mml:mo stretchy="true" form="postfix">]</mml:mo></mml:mrow><mml:mn>2</mml:mn></mml:msup><mml:mrow><mml:mo stretchy="true" form="prefix">[</mml:mo><mml:msub><mml:mtext mathvariant="normal">CaCO</mml:mtext><mml:mn>3</mml:mn></mml:msub><mml:mo stretchy="true" form="postfix">]</mml:mo></mml:mrow></mml:mrow></mml:mfrac></mml:mrow></mml:math></alternatives></disp-formula>
    <disp-formula><alternatives>
    <tex-math><![CDATA[ \frac{5 \times 10^{-2}}{2} = \frac{(x)(x)}{(1-2x)^2(1-x)} ]]></tex-math>
    <mml:math display="block" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:mrow><mml:mfrac><mml:mrow><mml:mn>5</mml:mn><mml:mo>×</mml:mo><mml:msup><mml:mn>10</mml:mn><mml:mrow><mml:mi>−</mml:mi><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:mrow><mml:mn>2</mml:mn></mml:mfrac><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mrow><mml:mo stretchy="true" form="prefix">(</mml:mo><mml:mi>x</mml:mi><mml:mo stretchy="true" form="postfix">)</mml:mo></mml:mrow><mml:mrow><mml:mo stretchy="true" form="prefix">(</mml:mo><mml:mi>x</mml:mi><mml:mo stretchy="true" form="postfix">)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:msup><mml:mrow><mml:mo stretchy="true" form="prefix">(</mml:mo><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:mn>2</mml:mn><mml:mi>x</mml:mi><mml:mo stretchy="true" form="postfix">)</mml:mo></mml:mrow><mml:mn>2</mml:mn></mml:msup><mml:mrow><mml:mo stretchy="true" form="prefix">(</mml:mo><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:mi>x</mml:mi><mml:mo stretchy="true" form="postfix">)</mml:mo></mml:mrow></mml:mrow></mml:mfrac></mml:mrow></mml:math></alternatives></disp-formula>
    <disp-formula><alternatives>
    <tex-math><![CDATA[ x \approx 0.1147 ]]></tex-math>
    <mml:math display="block" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:mrow><mml:mi>x</mml:mi><mml:mo>≈</mml:mo><mml:mn>0.1147</mml:mn></mml:mrow></mml:math></alternatives></disp-formula></p>
    <p>where <monospace>x</monospace> is the change in
    <inline-formula><alternatives>
    <tex-math><![CDATA[\textrm{CaCO}_3]]></tex-math>
    <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:msub><mml:mtext mathvariant="normal">CaCO</mml:mtext><mml:mn>3</mml:mn></mml:msub></mml:math></alternatives></inline-formula>,
    in dimensionless units.</p>
    <p>The expected equilibrium concentrations for the four species are:
    <inline-formula><alternatives>
    <tex-math><![CDATA[[\textrm{NaCl}] = 0.7706]]></tex-math>
    <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:mrow><mml:mrow><mml:mo stretchy="true" form="prefix">[</mml:mo><mml:mtext mathvariant="normal">NaCl</mml:mtext><mml:mo stretchy="true" form="postfix">]</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mn>0.7706</mml:mn></mml:mrow></mml:math></alternatives></inline-formula>,
    <inline-formula><alternatives>
    <tex-math><![CDATA[[\textrm{CaCO}_3] = 0.8853]]></tex-math>
    <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:mrow><mml:mrow><mml:mo stretchy="true" form="prefix">[</mml:mo><mml:msub><mml:mtext mathvariant="normal">CaCO</mml:mtext><mml:mn>3</mml:mn></mml:msub><mml:mo stretchy="true" form="postfix">]</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mn>0.8853</mml:mn></mml:mrow></mml:math></alternatives></inline-formula>,
    <inline-formula><alternatives>
    <tex-math><![CDATA[[\textrm{Na}_2\textrm{CO}_3] = 0.1147]]></tex-math>
    <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:mrow><mml:mrow><mml:mo stretchy="true" form="prefix">[</mml:mo><mml:msub><mml:mtext mathvariant="normal">Na</mml:mtext><mml:mn>2</mml:mn></mml:msub><mml:msub><mml:mtext mathvariant="normal">CO</mml:mtext><mml:mn>3</mml:mn></mml:msub><mml:mo stretchy="true" form="postfix">]</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mn>0.1147</mml:mn></mml:mrow></mml:math></alternatives></inline-formula>,
    and <inline-formula><alternatives>
    <tex-math><![CDATA[[\textrm{CaCl}_2] = 0.1147]]></tex-math>
    <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:mrow><mml:mrow><mml:mo stretchy="true" form="prefix">[</mml:mo><mml:msub><mml:mtext mathvariant="normal">CaCl</mml:mtext><mml:mn>2</mml:mn></mml:msub><mml:mo stretchy="true" form="postfix">]</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mn>0.1147</mml:mn></mml:mrow></mml:math></alternatives></inline-formula>.
    Based on the figures below and from direct inspection of the CM
    simulation results, correct steady-state values are obtained at the
    reactor outlet.</p>
    <p><inline-graphic mimetype="application" mime-subtype="pdf" xlink:href="system_response_NaCl.pdf">
      <alt-text>Input/Output Concentrations for NaCl.</alt-text>
    </inline-graphic>
    <inline-graphic mimetype="application" mime-subtype="pdf" xlink:href="system_response_CaCO3.pdf">
      <alt-text>Input/Output Concentrations for CaCO3.</alt-text>
    </inline-graphic>
    <inline-graphic mimetype="application" mime-subtype="pdf" xlink:href="system_response_Na2CO3.pdf">
      <alt-text>Input/Output Concentrations for Na2CO3.</alt-text>
    </inline-graphic>
    <inline-graphic mimetype="application" mime-subtype="pdf" xlink:href="system_response_CaCl2.pdf">
      <alt-text>Input/Output Concentrations for CaCl2.</alt-text>
    </inline-graphic></p>
    <p>To output the <monospace>ParaView</monospace> visualizations,
    change <monospace>output_VTK</monospace> to
    <monospace>True</monospace> in the <monospace>CONFIG</monospace>
    file and re-run the simulation.</p>
  </sec>
</sec>
<sec id="acknowledgements">
  <title>Acknowledgements</title>
  <p>This research was supported by the Natural Sciences and Engineering
  Research Council of Canada (NSERC) and the Digital Research Alliance
  of Canada.</p>
</sec>
</body>
<back>
<ref-list>
  <title></title>
  <ref id="ref-Cantera">
    <element-citation>
      <person-group person-group-type="author">
        <name><surname>Goodwin</surname><given-names>David G.</given-names></name>
        <name><surname>Moffat</surname><given-names>Harry K.</given-names></name>
        <name><surname>Schoegl</surname><given-names>Ingmar</given-names></name>
        <name><surname>Speth</surname><given-names>Raymond L.</given-names></name>
        <name><surname>Weber</surname><given-names>Bryan W.</given-names></name>
      </person-group>
      <article-title>Cantera: An object-oriented software toolkit for chemical kinetics, thermodynamics, and transport processes</article-title>
      <publisher-name>https://www.cantera.org</publisher-name>
      <year iso-8601-date="2023">2023</year>
      <pub-id pub-id-type="doi">10.5281/zenodo.8137090</pub-id>
    </element-citation>
  </ref>
  <ref id="ref-Amber">
    <element-citation>
      <person-group person-group-type="author">
        <name><surname>Quintessa</surname></name>
      </person-group>
      <article-title>Compartment modelling software</article-title>
      <publisher-name>Quintessa; Online</publisher-name>
      <date-in-citation content-type="access-date"><year iso-8601-date="2024-01-03">2024</year><month>01</month><day>03</day></date-in-citation>
      <uri>https://www.quintessa.org/software/AMBER</uri>
    </element-citation>
  </ref>
  <ref id="ref-greenshields2024">
    <element-citation publication-type="book">
      <person-group person-group-type="author">
        <name><surname>Greenshields</surname><given-names>Christopher</given-names></name>
      </person-group>
      <source>OpenFOAM v12 user guide</source>
      <publisher-name>The OpenFOAM Foundation</publisher-name>
      <publisher-loc>London, UK</publisher-loc>
      <year iso-8601-date="2024">2024</year>
      <uri>https://doc.cfd.direct/openfoam/user-guide-v12</uri>
    </element-citation>
  </ref>
  <ref id="ref-Monte2022">
    <element-citation publication-type="article-journal">
      <person-group person-group-type="author">
        <name><surname>Monte</surname><given-names>Elizabeth Julia</given-names></name>
        <name><surname>Vasile</surname><given-names>Alexandru Andrei</given-names></name>
        <name><surname>Lowman</surname><given-names>James</given-names></name>
        <name><surname>Abukhdeir</surname><given-names>Nasser Mohieddin</given-names></name>
      </person-group>
      <article-title>OpenCMP: An Open-Source Computational Multiphysics Package</article-title>
      <source>Journal of Open Source Software</source>
      <year iso-8601-date="2022-05">2022</year><month>05</month>
      <date-in-citation content-type="access-date"><year iso-8601-date="2023-05-23">2023</year><month>05</month><day>23</day></date-in-citation>
      <volume>7</volume>
      <issue>73</issue>
      <issn>2475-9066</issn>
      <pub-id pub-id-type="doi">10.21105/joss.03742</pub-id>
      <fpage>3742</fpage>
      <lpage></lpage>
    </element-citation>
  </ref>
  <ref id="ref-Vasile2024">
    <element-citation publication-type="article-journal">
      <person-group person-group-type="author">
        <name><surname>Vasile</surname><given-names>Alexandru Andrei</given-names></name>
        <name><surname>Aucoin</surname><given-names>Marc G.</given-names></name>
        <name><surname>Budman</surname><given-names>Hector</given-names></name>
        <name><surname>Abukhdeir</surname><given-names>Nasser Mohieddin</given-names></name>
      </person-group>
      <article-title>A flow alignment-informed method for compartmental modelling</article-title>
      <source>Computers &amp; Chemical Engineering</source>
      <year iso-8601-date="2024">2024</year>
      <volume>185</volume>
      <issn>0098-1354</issn>
      <uri>https://www.sciencedirect.com/science/article/pii/S0098135424000681</uri>
      <pub-id pub-id-type="doi">10.1016/j.compchemeng.2024.108650</pub-id>
      <fpage>108650</fpage>
      <lpage></lpage>
    </element-citation>
  </ref>
  <ref id="ref-Jourdan2019">
    <element-citation publication-type="article-journal">
      <person-group person-group-type="author">
        <name><surname>Jourdan</surname><given-names>Nicolas</given-names></name>
        <name><surname>Neveux</surname><given-names>Thibaut</given-names></name>
        <name><surname>Potier</surname><given-names>Olivier</given-names></name>
        <name><surname>Kanniche</surname><given-names>Mohamed</given-names></name>
        <name><surname>Wicks</surname><given-names>Jim</given-names></name>
        <name><surname>Nopens</surname><given-names>Ingmar</given-names></name>
        <name><surname>Rehman</surname><given-names>Usman</given-names></name>
        <name><surname>Le Moullec</surname><given-names>Yann</given-names></name>
      </person-group>
      <article-title>Compartmental modelling in chemical engineering: A critical review</article-title>
      <source>Chemical Engineering Science</source>
      <year iso-8601-date="2019">2019</year>
      <volume>210</volume>
      <issn>0009-2509</issn>
      <uri>https://www.sciencedirect.com/science/article/pii/S0009250919306888</uri>
      <pub-id pub-id-type="doi">10.1016/j.ces.2019.115196</pub-id>
      <fpage>115196</fpage>
      <lpage></lpage>
    </element-citation>
  </ref>
  <ref id="ref-Chinesta2017">
    <element-citation publication-type="chapter">
      <person-group person-group-type="author">
        <name><surname>Chinesta</surname><given-names>Francisco</given-names></name>
        <name><surname>Huerta</surname><given-names>Antonio</given-names></name>
        <name><surname>Rozza</surname><given-names>Gianluigi</given-names></name>
        <name><surname>Willcox</surname><given-names>Karen</given-names></name>
      </person-group>
      <article-title>Model reduction methods</article-title>
      <source>Encyclopedia of computational mechanics second edition</source>
      <publisher-name>John Wiley &amp; Sons, Ltd</publisher-name>
      <year iso-8601-date="2017">2017</year>
      <isbn>9781119176817</isbn>
      <uri>https://onlinelibrary.wiley.com/doi/abs/10.1002/9781119176817.ecm2110</uri>
      <pub-id pub-id-type="doi">10.1002/9781119176817.ecm2110</pub-id>
      <fpage>1</fpage>
      <lpage>36</lpage>
    </element-citation>
  </ref>
  <ref id="ref-Benner2020">
    <element-citation publication-type="book">
      <source>Model Order Reduction: Volume 3 Applications</source>
      <person-group person-group-type="editor">
        <name><surname>Benner</surname><given-names>Peter</given-names></name>
        <name><surname>Schilders</surname><given-names>Wil</given-names></name>
        <name><surname>Grivet-Talocia</surname><given-names>Stefano</given-names></name>
        <name><surname>Quarteroni</surname><given-names>Alfio</given-names></name>
        <name><surname>Rozza</surname><given-names>Gianluigi</given-names></name>
        <name><surname>Miguel Silveira</surname><given-names>Luís</given-names></name>
      </person-group>
      <publisher-name>De Gruyter</publisher-name>
      <year iso-8601-date="2020">2020</year>
      <date-in-citation content-type="access-date"><year iso-8601-date="2023-08-14">2023</year><month>08</month><day>14</day></date-in-citation>
      <pub-id pub-id-type="doi">10.1515/9783110499001</pub-id>
    </element-citation>
  </ref>
  <ref id="ref-Paraview">
    <element-citation publication-type="book">
      <person-group person-group-type="author">
        <name><surname>Ayachit</surname><given-names>Utkarsh</given-names></name>
      </person-group>
      <source>The paraview guide: A parallel visualization application</source>
      <publisher-name>Kitware, Inc.</publisher-name>
      <year iso-8601-date="2015">2015</year>
    </element-citation>
  </ref>
</ref-list>
</back>
</article>
