<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE article PUBLIC "-//NLM//DTD JATS (Z39.96) Journal Publishing DTD v1.2 20190208//EN"
                  "JATS-publishing1.dtd">
<article xmlns:mml="http://www.w3.org/1998/Math/MathML" xmlns:xlink="http://www.w3.org/1999/xlink" dtd-version="1.2" article-type="other">
<front>
<journal-meta>
<journal-id></journal-id>
<journal-title-group>
<journal-title>Journal of Open Source Software</journal-title>
<abbrev-journal-title>JOSS</abbrev-journal-title>
</journal-title-group>
<issn publication-format="electronic">2475-9066</issn>
<publisher>
<publisher-name>Open Journals</publisher-name>
</publisher>
</journal-meta>
<article-meta>
<article-id pub-id-type="publisher-id">8618</article-id>
<article-id pub-id-type="doi">10.21105/joss.08618</article-id>
<title-group>
<article-title>pylevin: efficient numerical integration of integrals
containing up to three Bessel functions</article-title>
</title-group>
<contrib-group>
<contrib contrib-type="author" corresp="yes">
<contrib-id contrib-id-type="orcid">https://orcid.org/0000-0001-5404-8753</contrib-id>
<name>
<surname>Reischke</surname>
<given-names>Robert</given-names>
</name>
<xref ref-type="aff" rid="aff-1"/>
<xref ref-type="corresp" rid="cor-1"><sup>*</sup></xref>
</contrib>
<aff id="aff-1">
<institution-wrap>
<institution>Argelander Institut fuer Astronomie, Germany</institution>
</institution-wrap>
</aff>
</contrib-group>
<author-notes>
<corresp id="cor-1">* E-mail: <email></email></corresp>
</author-notes>
<pub-date date-type="pub" publication-format="electronic" iso-8601-date="2025-02-24">
<day>24</day>
<month>2</month>
<year>2025</year>
</pub-date>
<volume>10</volume>
<issue>115</issue>
<fpage>8618</fpage>
<permissions>
<copyright-statement>Authors of papers retain copyright and release the
work under a Creative Commons Attribution 4.0 International License (CC
BY 4.0)</copyright-statement>
<copyright-year>2025</copyright-year>
<copyright-holder>The article authors</copyright-holder>
<license license-type="open-access" xlink:href="https://creativecommons.org/licenses/by/4.0/">
<license-p>Authors of papers retain copyright and release the work under
a Creative Commons Attribution 4.0 International License (CC BY
4.0)</license-p>
</license>
</permissions>
<kwd-group kwd-group-type="author">
<kwd>Python</kwd>
<kwd>numerical integration</kwd>
<kwd>oscillatory functions</kwd>
</kwd-group>
</article-meta>
</front>
<body>
<sec id="summary">
  <title>Summary</title>
  <p>Bessel functions naturally occur in physical systems with some
  degree of rotational symmetry. Theoretical predictions of observables,
  therefore, often involve integrals over those functions that are not
  solvable analytically and have to be treated numerically instead.
  However, standard integration techniques such as quadrature generally
  fail to solve these integrals efficiently and reliably due to the
  rapid oscillations of the Bessel functions. Providing general tools to
  compute these types of integrals quickly is therefore paramount.
  <monospace>pylevin</monospace> can calculate the following types of
  frequently encountered integrals</p>
  <p><disp-formula><alternatives>
  <tex-math><![CDATA[
  I_{\ell_1\ell_2\ell_3}(k_1,k_2,k_3) = \int_{a}^{b} \mathrm{d}x\,f(x) \prod_{i=1}^N \mathcal{J}_{\ell_i}(k_ix)\,,\quad N= 1,2,3\,,
  ]]></tex-math>
  <mml:math display="block" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:mrow><mml:msub><mml:mi>I</mml:mi><mml:mrow><mml:msub><mml:mo>‚Ñì</mml:mo><mml:mn>1</mml:mn></mml:msub><mml:msub><mml:mo>‚Ñì</mml:mo><mml:mn>2</mml:mn></mml:msub><mml:msub><mml:mo>‚Ñì</mml:mo><mml:mn>3</mml:mn></mml:msub></mml:mrow></mml:msub><mml:mrow><mml:mo stretchy="true" form="prefix">(</mml:mo><mml:msub><mml:mi>k</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>k</mml:mi><mml:mn>2</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>k</mml:mi><mml:mn>3</mml:mn></mml:msub><mml:mo stretchy="true" form="postfix">)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:msubsup><mml:mo>‚à´</mml:mo><mml:mi>a</mml:mi><mml:mi>b</mml:mi></mml:msubsup><mml:mi mathvariant="normal">d</mml:mi><mml:mi>x</mml:mi><mml:mspace width="0.167em"></mml:mspace><mml:mi>f</mml:mi><mml:mrow><mml:mo stretchy="true" form="prefix">(</mml:mo><mml:mi>x</mml:mi><mml:mo stretchy="true" form="postfix">)</mml:mo></mml:mrow><mml:munderover><mml:mo>‚àè</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>N</mml:mi></mml:munderover><mml:msub><mml:mi>ùí•</mml:mi><mml:msub><mml:mo>‚Ñì</mml:mo><mml:mi>i</mml:mi></mml:msub></mml:msub><mml:mrow><mml:mo stretchy="true" form="prefix">(</mml:mo><mml:msub><mml:mi>k</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mi>x</mml:mi><mml:mo stretchy="true" form="postfix">)</mml:mo></mml:mrow><mml:mspace width="0.167em"></mml:mspace><mml:mo>,</mml:mo><mml:mspace width="1.0em"></mml:mspace><mml:mi>N</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mn>2</mml:mn><mml:mo>,</mml:mo><mml:mn>3</mml:mn><mml:mspace width="0.167em"></mml:mspace><mml:mo>,</mml:mo></mml:mrow></mml:math></alternatives></disp-formula></p>
  <p>where <inline-formula><alternatives>
  <tex-math><![CDATA[\mathcal{J}_\ell(x)]]></tex-math>
  <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:mrow><mml:msub><mml:mi>ùí•</mml:mi><mml:mo>‚Ñì</mml:mo></mml:msub><mml:mrow><mml:mo stretchy="true" form="prefix">(</mml:mo><mml:mi>x</mml:mi><mml:mo stretchy="true" form="postfix">)</mml:mo></mml:mrow></mml:mrow></mml:math></alternatives></inline-formula>
  denotes a spherical or cylindrical Bessel function of order
  <inline-formula><alternatives>
  <tex-math><![CDATA[\ell]]></tex-math>
  <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:mo>‚Ñì</mml:mo></mml:math></alternatives></inline-formula>
  and <inline-formula><alternatives>
  <tex-math><![CDATA[f(x)]]></tex-math>
  <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:mrow><mml:mi>f</mml:mi><mml:mrow><mml:mo stretchy="true" form="prefix">(</mml:mo><mml:mi>x</mml:mi><mml:mo stretchy="true" form="postfix">)</mml:mo></mml:mrow></mml:mrow></mml:math></alternatives></inline-formula>
  can be any non-oscillatory function, i.e., with frequencies much lower
  than the one of the product of Bessel functions.</p>
</sec>
<sec id="statement-of-need">
  <title>Statement of need</title>
  <p>Typical approaches for numerically estimating integrals over highly
  oscillatory integrands are based on Fast Fourier Transforms (FFTLog)
  (<xref alt="Fang et al., 2020" rid="ref-fang_2020" ref-type="bibr">Fang
  et al., 2020</xref>;
  <xref alt="Grasshorn Gebhardt &amp; Jeong, 2018" rid="ref-grasshorn_2018" ref-type="bibr">Grasshorn
  Gebhardt &amp; Jeong, 2018</xref>;
  <xref alt="Sch√∂neberg et al., 2018" rid="ref-schoneberg_2018" ref-type="bibr">Sch√∂neberg
  et al., 2018</xref>) and asymptotic expansions
  (<xref alt="Iserles &amp; N√∏rsett, 2005" rid="ref-iserles_efficient_2005" ref-type="bibr">Iserles
  &amp; N√∏rsett, 2005</xref>;
  <xref alt="Levin, 1996" rid="ref-levin_1996" ref-type="bibr">Levin,
  1996</xref>). In <monospace>pylevin</monospace>, we implement one of
  the former methods, specifically, the adaptive Levin collocation
  (<xref alt="Chen et al., 2022" rid="ref-chen_2022" ref-type="bibr">Chen
  et al., 2022</xref>;
  <xref alt="Leonard et al., 2023" rid="ref-leonard_2023" ref-type="bibr">Leonard
  et al., 2023</xref>;
  <xref alt="Levin, 1996" rid="ref-levin_1996" ref-type="bibr">Levin,
  1996</xref>). Extending and improving the work done in Zieser &amp;
  Merkel
  (<xref alt="2016" rid="ref-zieser_2016" ref-type="bibr">2016</xref>),
  <monospace>pylevin</monospace> can solve integrals of the type
  <inline-formula><alternatives>
  <tex-math><![CDATA[I_{\ell_1\ell_2\ell_3}(k_1,k_2,k_3)]]></tex-math>
  <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:mrow><mml:msub><mml:mi>I</mml:mi><mml:mrow><mml:msub><mml:mo>‚Ñì</mml:mo><mml:mn>1</mml:mn></mml:msub><mml:msub><mml:mo>‚Ñì</mml:mo><mml:mn>2</mml:mn></mml:msub><mml:msub><mml:mo>‚Ñì</mml:mo><mml:mn>3</mml:mn></mml:msub></mml:mrow></mml:msub><mml:mrow><mml:mo stretchy="true" form="prefix">(</mml:mo><mml:msub><mml:mi>k</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>k</mml:mi><mml:mn>2</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>k</mml:mi><mml:mn>3</mml:mn></mml:msub><mml:mo stretchy="true" form="postfix">)</mml:mo></mml:mrow></mml:mrow></mml:math></alternatives></inline-formula>
  (see summary).</p>
  <p>The main code is implemented in <monospace>C++</monospace> and
  wrapped into <monospace>python</monospace> using
  <monospace>pybind</monospace>. Due to the way
  <monospace>pylevin</monospace> implements Levin‚Äôs method, it makes
  extensive use of precomputed quantities, allowing the function
  <inline-formula><alternatives>
  <tex-math><![CDATA[f(x)]]></tex-math>
  <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:mrow><mml:mi>f</mml:mi><mml:mrow><mml:mo stretchy="true" form="prefix">(</mml:mo><mml:mi>x</mml:mi><mml:mo stretchy="true" form="postfix">)</mml:mo></mml:mrow></mml:mrow></mml:math></alternatives></inline-formula>
  to be updated and making successive calls to the integration routine
  an order of magnitude faster than the first. An aspect that is
  particularly important for situations where the same type of integral
  needs to be evaluated many times for slightly different
  <inline-formula><alternatives>
  <tex-math><![CDATA[f(x)]]></tex-math>
  <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:mrow><mml:mi>f</mml:mi><mml:mrow><mml:mo stretchy="true" form="prefix">(</mml:mo><mml:mi>x</mml:mi><mml:mo stretchy="true" form="postfix">)</mml:mo></mml:mrow></mml:mrow></mml:math></alternatives></inline-formula>.
  This is, for example, the case in inference when running Markov Chain
  Monte-Carlo.</p>
  <p>In contrast to other implementations of highly oscillatory
  integrals, <monospace>pylevin</monospace> is very flexible: it is not
  hardcoded or tailored to a particular application, and it is entirely
  agnostic to the integrand. Furthermore, it implements integrals over
  three Bessel functions for the first time. These are, for example,
  required in many cosmological applications for higher-order
  statistics. Due to its implementation in a statically typed compiled
  language, it is also swift, while making use of the convenience and
  widespread use of <monospace>python</monospace> via
  <monospace>pybind</monospace>.</p>
</sec>
<sec id="examples">
  <title>Examples</title>
  <p>The way <monospace>pylevin</monospace> works is that one first
  defines an integrand, <inline-formula><alternatives>
  <tex-math><![CDATA[f(x)]]></tex-math>
  <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:mrow><mml:mi>f</mml:mi><mml:mrow><mml:mo stretchy="true" form="prefix">(</mml:mo><mml:mi>x</mml:mi><mml:mo stretchy="true" form="postfix">)</mml:mo></mml:mrow></mml:mrow></mml:math></alternatives></inline-formula>,
  the integral type (spherical or cylindrical Bessel functions and
  <inline-formula><alternatives>
  <tex-math><![CDATA[N]]></tex-math>
  <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:mi>N</mml:mi></mml:math></alternatives></inline-formula>),
  and whether the interpolation of the integrand should be carried out
  logarithmically.</p>
  <code language="python">x = np.geomspace(1e-5,100,100)
f_of_x = x**3 + (x**2 + x)
integral_type = 0 
number_omp_threads = 1 
interploate_logx = True
interploate_logy = True
lp_single = levin.pylevin(integral_type,
                          x,
                          f_of_x[:, None],
                          logx,
                          logy,
                          number_omp_threads)</code>
  <p>Note that the broadcasting of <monospace>f_of_x</monospace> is
  required, as one can, in principle, pass many different integrands at
  the same time, and the code always expects this dimension. We can then
  define the values <inline-formula><alternatives>
  <tex-math><![CDATA[k]]></tex-math>
  <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:mi>k</mml:mi></mml:math></alternatives></inline-formula>
  and <inline-formula><alternatives>
  <tex-math><![CDATA[\ell]]></tex-math>
  <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:mo>‚Ñì</mml:mo></mml:math></alternatives></inline-formula>
  at which we want to evaluate the integral, which are all
  one-dimensional arrays of the same shape. Additionally, we also have
  to allocate the memory for the result, which is stored in-place:</p>
  <code language="python">k = np.geomspace(1e-3,1e4,1000)
ell = (5*np.ones_like(k)).astype(int) 
result_levin = np.zeros((len(k), 1)) 
lp_single.levin_integrate_bessel_single(x[0]*np.ones_like(k),
                                        x[-1]*np.ones_like(k),
                                        k,
                                        ell,
                                        False,
                                        result_levin)</code>
  <p>If we had passed more integrands before, the results must have the
  corresponding shape in the second dimension. For more detailed
  examples, we refer to the example notebook on GitHub and to the
  API.</p>
  <p>We now demonstrate the performance of
  <monospace>pylevin</monospace> on a single core on an Apple M3 and
  compare it to <monospace>scipy.integrate.quad</monospace>, an adaptive
  quadrature. The relative accuracy required for both methods is set to
  <inline-formula><alternatives>
  <tex-math><![CDATA[10^{-3}]]></tex-math>
  <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:msup><mml:mn>10</mml:mn><mml:mrow><mml:mi>‚àí</mml:mi><mml:mn>3</mml:mn></mml:mrow></mml:msup></mml:math></alternatives></inline-formula>.
  We use the following two integrals as an example:</p>
  <p><disp-formula><alternatives>
  <tex-math><![CDATA[
  I_2 = \;\int_{10^{-5}}^{100} \mathrm{d}x \;(x^3 + x^2 + x)j_{10}(kx)j_5(kx)\;, 
  ]]></tex-math>
  <mml:math display="block" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:mrow><mml:msub><mml:mi>I</mml:mi><mml:mn>2</mml:mn></mml:msub><mml:mo>=</mml:mo><mml:mspace width="0.278em"></mml:mspace><mml:msubsup><mml:mo>‚à´</mml:mo><mml:msup><mml:mn>10</mml:mn><mml:mrow><mml:mi>‚àí</mml:mi><mml:mn>5</mml:mn></mml:mrow></mml:msup><mml:mn>100</mml:mn></mml:msubsup><mml:mi mathvariant="normal">d</mml:mi><mml:mi>x</mml:mi><mml:mspace width="0.278em"></mml:mspace><mml:mrow><mml:mo stretchy="true" form="prefix">(</mml:mo><mml:msup><mml:mi>x</mml:mi><mml:mn>3</mml:mn></mml:msup><mml:mo>+</mml:mo><mml:msup><mml:mi>x</mml:mi><mml:mn>2</mml:mn></mml:msup><mml:mo>+</mml:mo><mml:mi>x</mml:mi><mml:mo stretchy="true" form="postfix">)</mml:mo></mml:mrow><mml:msub><mml:mi>j</mml:mi><mml:mn>10</mml:mn></mml:msub><mml:mrow><mml:mo stretchy="true" form="prefix">(</mml:mo><mml:mi>k</mml:mi><mml:mi>x</mml:mi><mml:mo stretchy="true" form="postfix">)</mml:mo></mml:mrow><mml:msub><mml:mi>j</mml:mi><mml:mn>5</mml:mn></mml:msub><mml:mrow><mml:mo stretchy="true" form="prefix">(</mml:mo><mml:mi>k</mml:mi><mml:mi>x</mml:mi><mml:mo stretchy="true" form="postfix">)</mml:mo></mml:mrow><mml:mspace width="0.278em"></mml:mspace><mml:mo>,</mml:mo></mml:mrow></mml:math></alternatives></disp-formula>
  <disp-formula><alternatives>
  <tex-math><![CDATA[
  I_3 = \;\int_{10^{-5}}^{100} \mathrm{d}x \;(x^3 + x^2 + x)j_{10}(kx)j_5(kx)j_{15}(kx)\;,
  ]]></tex-math>
  <mml:math display="block" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:mrow><mml:msub><mml:mi>I</mml:mi><mml:mn>3</mml:mn></mml:msub><mml:mo>=</mml:mo><mml:mspace width="0.278em"></mml:mspace><mml:msubsup><mml:mo>‚à´</mml:mo><mml:msup><mml:mn>10</mml:mn><mml:mrow><mml:mi>‚àí</mml:mi><mml:mn>5</mml:mn></mml:mrow></mml:msup><mml:mn>100</mml:mn></mml:msubsup><mml:mi mathvariant="normal">d</mml:mi><mml:mi>x</mml:mi><mml:mspace width="0.278em"></mml:mspace><mml:mrow><mml:mo stretchy="true" form="prefix">(</mml:mo><mml:msup><mml:mi>x</mml:mi><mml:mn>3</mml:mn></mml:msup><mml:mo>+</mml:mo><mml:msup><mml:mi>x</mml:mi><mml:mn>2</mml:mn></mml:msup><mml:mo>+</mml:mo><mml:mi>x</mml:mi><mml:mo stretchy="true" form="postfix">)</mml:mo></mml:mrow><mml:msub><mml:mi>j</mml:mi><mml:mn>10</mml:mn></mml:msub><mml:mrow><mml:mo stretchy="true" form="prefix">(</mml:mo><mml:mi>k</mml:mi><mml:mi>x</mml:mi><mml:mo stretchy="true" form="postfix">)</mml:mo></mml:mrow><mml:msub><mml:mi>j</mml:mi><mml:mn>5</mml:mn></mml:msub><mml:mrow><mml:mo stretchy="true" form="prefix">(</mml:mo><mml:mi>k</mml:mi><mml:mi>x</mml:mi><mml:mo stretchy="true" form="postfix">)</mml:mo></mml:mrow><mml:msub><mml:mi>j</mml:mi><mml:mn>15</mml:mn></mml:msub><mml:mrow><mml:mo stretchy="true" form="prefix">(</mml:mo><mml:mi>k</mml:mi><mml:mi>x</mml:mi><mml:mo stretchy="true" form="postfix">)</mml:mo></mml:mrow><mml:mspace width="0.278em"></mml:mspace><mml:mo>,</mml:mo></mml:mrow></mml:math></alternatives></disp-formula></p>
  <p>The result of <inline-formula><alternatives>
  <tex-math><![CDATA[I_2]]></tex-math>
  <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:msub><mml:mi>I</mml:mi><mml:mn>2</mml:mn></mml:msub></mml:math></alternatives></inline-formula>
  is shown on the left and for <inline-formula><alternatives>
  <tex-math><![CDATA[I_3]]></tex-math>
  <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:msub><mml:mi>I</mml:mi><mml:mn>3</mml:mn></mml:msub></mml:math></alternatives></inline-formula>
  on the right in
  <xref alt="[fig:figure1]" rid="figU003Afigure1">[fig:figure1]</xref>.
  In order for the quadrature to converge over an extended
  <inline-formula><alternatives>
  <tex-math><![CDATA[k]]></tex-math>
  <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:mi>k</mml:mi></mml:math></alternatives></inline-formula>-range,
  the number of maximum sub-intervals was increased to
  <inline-formula><alternatives>
  <tex-math><![CDATA[10^3]]></tex-math>
  <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:msup><mml:mn>10</mml:mn><mml:mn>3</mml:mn></mml:msup></mml:math></alternatives></inline-formula>
  (<inline-formula><alternatives>
  <tex-math><![CDATA[2\times 10^3]]></tex-math>
  <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:mrow><mml:mn>2</mml:mn><mml:mo>√ó</mml:mo><mml:msup><mml:mn>10</mml:mn><mml:mn>3</mml:mn></mml:msup></mml:mrow></mml:math></alternatives></inline-formula>)
  for <inline-formula><alternatives>
  <tex-math><![CDATA[I_2]]></tex-math>
  <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:msub><mml:mi>I</mml:mi><mml:mn>2</mml:mn></mml:msub></mml:math></alternatives></inline-formula>
  (<inline-formula><alternatives>
  <tex-math><![CDATA[I_3]]></tex-math>
  <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:msub><mml:mi>I</mml:mi><mml:mn>3</mml:mn></mml:msub></mml:math></alternatives></inline-formula>).
  The grey-shaded area indicates where the quadrature fails to reach
  convergence even after this change. It is therefore clear that
  <monospace>pylevin</monospace> is more accurate and around three to
  four orders of magnitude faster than standard integration
  routines.</p>
  <fig>
    <caption><p>Speed and accuracy comparison of
    <monospace>pylevin</monospace> (shown in dashed red) against a
    standard adaptive quadrature (shown in solid blue). The runtime for
    the two methods is given in the legend. For adaptive quadrature, the
    maximum number of subintervals was set to 1000 (the default is 50).
    The grey shaded region indicates when the quadrature starts to fail.
    The bottom panel shows the relative difference between the two
    methods. <bold>Left</bold>: Result of the integral
    <inline-formula><alternatives>
    <tex-math><![CDATA[I_2]]></tex-math>
    <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:msub><mml:mi>I</mml:mi><mml:mn>2</mml:mn></mml:msub></mml:math></alternatives></inline-formula>.
    <bold>Right</bold>: Result of the integral
    <inline-formula><alternatives>
    <tex-math><![CDATA[I_3]]></tex-math>
    <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:msub><mml:mi>I</mml:mi><mml:mn>3</mml:mn></mml:msub></mml:math></alternatives></inline-formula>.
    <styled-content id="figU003Afigure1"></styled-content></p></caption>
    <graphic mimetype="application" mime-subtype="pdf" xlink:href="paper_plot_joss.pdf" />
  </fig>
</sec>
<sec id="comparison-with-various-codes">
  <title>Comparison with various codes</title>
  <p>In addition to the benchmark, <monospace>pylevin</monospace> is
  compared with more specialised codes that mostly solve integrals over
  single Bessel functions. All computing times presented here are
  averages over several runs. The comparison was conducted on an M3
  processor with 8 cores (4 performance cores).</p>
  <sec id="hankel">
    <title><monospace>hankel</monospace></title>
    <p>We compute the following Hankel transformation using
    <monospace>pylevin</monospace> and Ogata‚Äôs method (Ogata
    (<xref alt="2005" rid="ref-ogata_2005" ref-type="bibr">2005</xref>)),
    as implemented in the <monospace>hankel</monospace> package (Murray
    &amp; Poulin
    (<xref alt="2019" rid="ref-murray_2019" ref-type="bibr">2019</xref>)).</p>
    <p><disp-formula><alternatives>
    <tex-math><![CDATA[
    \mathrm{integral}(k) = \int_0^\infty\frac{x^2}{x^2+1}J_0(kx)\;\mathrm{d}x\;,
    ]]></tex-math>
    <mml:math display="block" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:mrow><mml:mrow><mml:mi mathvariant="normal">i</mml:mi><mml:mi mathvariant="normal">n</mml:mi><mml:mi mathvariant="normal">t</mml:mi><mml:mi mathvariant="normal">e</mml:mi><mml:mi mathvariant="normal">g</mml:mi><mml:mi mathvariant="normal">r</mml:mi><mml:mi mathvariant="normal">a</mml:mi><mml:mi mathvariant="normal">l</mml:mi></mml:mrow><mml:mrow><mml:mo stretchy="true" form="prefix">(</mml:mo><mml:mi>k</mml:mi><mml:mo stretchy="true" form="postfix">)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:msubsup><mml:mo>‚à´</mml:mo><mml:mn>0</mml:mn><mml:mi>‚àû</mml:mi></mml:msubsup><mml:mfrac><mml:msup><mml:mi>x</mml:mi><mml:mn>2</mml:mn></mml:msup><mml:mrow><mml:msup><mml:mi>x</mml:mi><mml:mn>2</mml:mn></mml:msup><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:mfrac><mml:msub><mml:mi>J</mml:mi><mml:mn>0</mml:mn></mml:msub><mml:mrow><mml:mo stretchy="true" form="prefix">(</mml:mo><mml:mi>k</mml:mi><mml:mi>x</mml:mi><mml:mo stretchy="true" form="postfix">)</mml:mo></mml:mrow><mml:mspace width="0.278em"></mml:mspace><mml:mi mathvariant="normal">d</mml:mi><mml:mi>x</mml:mi><mml:mspace width="0.278em"></mml:mspace><mml:mo>,</mml:mo></mml:mrow></mml:math></alternatives></disp-formula></p>
    <p>for 500 values of <inline-formula><alternatives>
    <tex-math><![CDATA[k]]></tex-math>
    <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:mi>k</mml:mi></mml:math></alternatives></inline-formula>
    logarithmically-spaced between 1 and <inline-formula><alternatives>
    <tex-math><![CDATA[10^4]]></tex-math>
    <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:msup><mml:mn>10</mml:mn><mml:mn>4</mml:mn></mml:msup></mml:math></alternatives></inline-formula>.
    The result is depicted on the left side of
    <xref alt="[fig:figure2]" rid="figU003Afigure2">[fig:figure2]</xref>.
    It can be seen that both methods agree very well and are roughly
    equally fast. While the Hankel transformation formally extends from
    0 to infinity, $ a = 10^{-5}$ and <inline-formula><alternatives>
    <tex-math><![CDATA[b = 10^8]]></tex-math>
    <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:mrow><mml:mi>b</mml:mi><mml:mo>=</mml:mo><mml:msup><mml:mn>10</mml:mn><mml:mn>8</mml:mn></mml:msup></mml:mrow></mml:math></alternatives></inline-formula>
    were used for <monospace>pylevin</monospace>. This choice of course
    depends on the specific integrand.</p>
  </sec>
  <sec id="hankl">
    <title><monospace>hankl</monospace></title>
    <p>Here, we follow the cosmology example provided in the
    <monospace>hankl</monospace> documentation (Karamanis &amp; Beutler
    (<xref alt="2021" rid="ref-karamanis_2021" ref-type="bibr">2021</xref>))
    to compute the monopole of the galaxy power spectrum:</p>
    <p><disp-formula><alternatives>
    <tex-math><![CDATA[
    \xi_0(s) =\int_0^\infty\left(b^2+fb/3 +f^2/5\right)P_\mathrm{lin}(k)J_0(ks) k^2\;\mathrm{d}k\;,
    ]]></tex-math>
    <mml:math display="block" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:mrow><mml:msub><mml:mi>Œæ</mml:mi><mml:mn>0</mml:mn></mml:msub><mml:mrow><mml:mo stretchy="true" form="prefix">(</mml:mo><mml:mi>s</mml:mi><mml:mo stretchy="true" form="postfix">)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:msubsup><mml:mo>‚à´</mml:mo><mml:mn>0</mml:mn><mml:mi>‚àû</mml:mi></mml:msubsup><mml:mrow><mml:mo stretchy="true" form="prefix">(</mml:mo><mml:msup><mml:mi>b</mml:mi><mml:mn>2</mml:mn></mml:msup><mml:mo>+</mml:mo><mml:mi>f</mml:mi><mml:mi>b</mml:mi><mml:mi>/</mml:mi><mml:mn>3</mml:mn><mml:mo>+</mml:mo><mml:msup><mml:mi>f</mml:mi><mml:mn>2</mml:mn></mml:msup><mml:mi>/</mml:mi><mml:mn>5</mml:mn><mml:mo stretchy="true" form="postfix">)</mml:mo></mml:mrow><mml:msub><mml:mi>P</mml:mi><mml:mrow><mml:mi mathvariant="normal">l</mml:mi><mml:mi mathvariant="normal">i</mml:mi><mml:mi mathvariant="normal">n</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo stretchy="true" form="prefix">(</mml:mo><mml:mi>k</mml:mi><mml:mo stretchy="true" form="postfix">)</mml:mo></mml:mrow><mml:msub><mml:mi>J</mml:mi><mml:mn>0</mml:mn></mml:msub><mml:mrow><mml:mo stretchy="true" form="prefix">(</mml:mo><mml:mi>k</mml:mi><mml:mi>s</mml:mi><mml:mo stretchy="true" form="postfix">)</mml:mo></mml:mrow><mml:msup><mml:mi>k</mml:mi><mml:mn>2</mml:mn></mml:msup><mml:mspace width="0.278em"></mml:mspace><mml:mi mathvariant="normal">d</mml:mi><mml:mi>k</mml:mi><mml:mspace width="0.278em"></mml:mspace><mml:mo>,</mml:mo></mml:mrow></mml:math></alternatives></disp-formula></p>
    <p>where <inline-formula><alternatives>
    <tex-math><![CDATA[b]]></tex-math>
    <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:mi>b</mml:mi></mml:math></alternatives></inline-formula>
    is the galaxy bias, <inline-formula><alternatives>
    <tex-math><![CDATA[f]]></tex-math>
    <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:mi>f</mml:mi></mml:math></alternatives></inline-formula>
    the logarithmic growth rate, and <inline-formula><alternatives>
    <tex-math><![CDATA[P_\mathrm{lin}(k)]]></tex-math>
    <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:mrow><mml:msub><mml:mi>P</mml:mi><mml:mrow><mml:mi mathvariant="normal">l</mml:mi><mml:mi mathvariant="normal">i</mml:mi><mml:mi mathvariant="normal">n</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo stretchy="true" form="prefix">(</mml:mo><mml:mi>k</mml:mi><mml:mo stretchy="true" form="postfix">)</mml:mo></mml:mrow></mml:mrow></mml:math></alternatives></inline-formula>
    is the linear matter power spectrum, which is calculated using
    <monospace>camb</monospace> (Lewis &amp; Bridle
    (<xref alt="2002" rid="ref-lewis_cosmological_2002" ref-type="bibr">2002</xref>))
    at six redshifts. Since <monospace>hankl</monospace> is FFT-based,
    it requires <inline-formula><alternatives>
    <tex-math><![CDATA[k]]></tex-math>
    <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:mi>k</mml:mi></mml:math></alternatives></inline-formula>
    to be discretised; the FFT-dual will then be calculated at the
    inverse grid points. For this comparison, we use
    <inline-formula><alternatives>
    <tex-math><![CDATA[2^{10}]]></tex-math>
    <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:msup><mml:mn>2</mml:mn><mml:mn>10</mml:mn></mml:msup></mml:math></alternatives></inline-formula>
    logarithmically-spaced points between <inline-formula><alternatives>
    <tex-math><![CDATA[k=10^{-4}]]></tex-math>
    <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:mrow><mml:mi>k</mml:mi><mml:mo>=</mml:mo><mml:msup><mml:mn>10</mml:mn><mml:mrow><mml:mi>‚àí</mml:mi><mml:mn>4</mml:mn></mml:mrow></mml:msup></mml:mrow></mml:math></alternatives></inline-formula>
    and <inline-formula><alternatives>
    <tex-math><![CDATA[k = 1]]></tex-math>
    <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:mrow><mml:mi>k</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:math></alternatives></inline-formula>
    for the transformation to converge. For
    <monospace>pylevin</monospace>, the number of points where the
    transformation is evaluated is arbitrary. Here we use 100 points,
    which is more than enough to resolve all features in
    <inline-formula><alternatives>
    <tex-math><![CDATA[\xi_0]]></tex-math>
    <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:msub><mml:mi>Œæ</mml:mi><mml:mn>0</mml:mn></mml:msub></mml:math></alternatives></inline-formula>.
    The results are shown on the right of
    <xref alt="[fig:figure2]" rid="figU003Afigure2">[fig:figure2]</xref>,
    and good agreement is observed between the two methods, with
    <monospace>hankl</monospace> roughly twice as fast as
    <monospace>pylevin</monospace>.</p>
    <fig>
      <caption><p>Comparison of <monospace>pylevin</monospace> with two
      methods to calculate a Hankel transformation. Dashed red is
      <monospace>pylevin</monospace> while solid blue is the alternative
      method. <bold>Left</bold>: Integral<inline-formula><alternatives>
      <tex-math><![CDATA[(k)]]></tex-math>
      <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:mrow><mml:mo stretchy="true" form="prefix">(</mml:mo><mml:mi>k</mml:mi><mml:mo stretchy="true" form="postfix">)</mml:mo></mml:mrow></mml:math></alternatives></inline-formula>
      evaluated with the Ogata method using the
      <monospace>hankel</monospace> package. <bold>Right</bold>:
      Integral for the galaxy power spectrum monopole evaluated using
      the <bold>hankl</bold> package. Different lines refer to different
      redshifts.
      <styled-content id="figU003Afigure2"></styled-content></p></caption>
      <graphic mimetype="application" mime-subtype="pdf" xlink:href="paper_plot_2_joss.pdf" />
    </fig>
  </sec>
  <sec id="pyfftlog">
    <title>pyfftlog</title>
    <p>For <monospace>pyfftlog</monospace> (Hamilton
    (<xref alt="2000" rid="ref-hamilton_2000" ref-type="bibr">2000</xref>)),
    we use the following transformation:</p>
    <p><disp-formula><alternatives>
    <tex-math><![CDATA[
    \mathrm{FT}(k) = \int_0^\infty r^{5}\mathrm{e}^{-r^2/2}J_4(kr)\;\mathrm{d}r\;.
    ]]></tex-math>
    <mml:math display="block" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:mrow><mml:mrow><mml:mi mathvariant="normal">F</mml:mi><mml:mi mathvariant="normal">T</mml:mi></mml:mrow><mml:mrow><mml:mo stretchy="true" form="prefix">(</mml:mo><mml:mi>k</mml:mi><mml:mo stretchy="true" form="postfix">)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:msubsup><mml:mo>‚à´</mml:mo><mml:mn>0</mml:mn><mml:mi>‚àû</mml:mi></mml:msubsup><mml:msup><mml:mi>r</mml:mi><mml:mn>5</mml:mn></mml:msup><mml:msup><mml:mi mathvariant="normal">e</mml:mi><mml:mrow><mml:mi>‚àí</mml:mi><mml:msup><mml:mi>r</mml:mi><mml:mn>2</mml:mn></mml:msup><mml:mi>/</mml:mi><mml:mn>2</mml:mn></mml:mrow></mml:msup><mml:msub><mml:mi>J</mml:mi><mml:mn>4</mml:mn></mml:msub><mml:mrow><mml:mo stretchy="true" form="prefix">(</mml:mo><mml:mi>k</mml:mi><mml:mi>r</mml:mi><mml:mo stretchy="true" form="postfix">)</mml:mo></mml:mrow><mml:mspace width="0.278em"></mml:mspace><mml:mi mathvariant="normal">d</mml:mi><mml:mi>r</mml:mi><mml:mspace width="0.278em"></mml:mspace><mml:mi>.</mml:mi></mml:mrow></mml:math></alternatives></disp-formula></p>
    <p>For <monospace>pyfftlog</monospace>,
    <inline-formula><alternatives>
    <tex-math><![CDATA[2^8]]></tex-math>
    <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:msup><mml:mn>2</mml:mn><mml:mn>8</mml:mn></mml:msup></mml:math></alternatives></inline-formula>
    logarithmically-spaced points between <inline-formula><alternatives>
    <tex-math><![CDATA[10^{-4}]]></tex-math>
    <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:msup><mml:mn>10</mml:mn><mml:mrow><mml:mi>‚àí</mml:mi><mml:mn>4</mml:mn></mml:mrow></mml:msup></mml:math></alternatives></inline-formula>
    and <inline-formula><alternatives>
    <tex-math><![CDATA[10^4]]></tex-math>
    <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:msup><mml:mn>10</mml:mn><mml:mn>4</mml:mn></mml:msup></mml:math></alternatives></inline-formula>
    for <inline-formula><alternatives>
    <tex-math><![CDATA[r]]></tex-math>
    <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:mi>r</mml:mi></mml:math></alternatives></inline-formula>
    and hence also for <inline-formula><alternatives>
    <tex-math><![CDATA[k]]></tex-math>
    <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:mi>k</mml:mi></mml:math></alternatives></inline-formula>.
    <monospace>pylevin</monospace> is evaluated for the same number of
    points; this value could, however, be reduced due to the featureless
    transformation, thus increasing the speed. In the left panel of
    <xref alt="[fig:figure3]" rid="figU003Afigure3">[fig:figure3]</xref>,
    the result of this exercise is shown. Good agreement between the two
    methods is found, with both taking the same amount of time. The
    large relative error at large values of
    <inline-formula><alternatives>
    <tex-math><![CDATA[k]]></tex-math>
    <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:mi>k</mml:mi></mml:math></alternatives></inline-formula>
    is due to the small value of the integral, and hence purely
    numerical noise.</p>
  </sec>
  <sec id="pyccl">
    <title>pyCCL</title>
    <p>Here, we compare the implementation of the non-Limber projection
    for the angular power spectrum:</p>
    <p><disp-formula><alternatives>
    <tex-math><![CDATA[
    C_\ell = \frac{2}{\pi}\int\mathrm{d}{\chi_1} W(\chi_1)\int\mathrm{d}{\chi_2} W(\chi_2)\int k^2\mathrm{d}k\;  P_{\mathrm{m}}(k, \chi_1,\chi_2)
    j_{\ell}(k\chi_1)j_{\ell}(k\chi_2) \;,
    ]]></tex-math>
    <mml:math display="block" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:mrow><mml:msub><mml:mi>C</mml:mi><mml:mo>‚Ñì</mml:mo></mml:msub><mml:mo>=</mml:mo><mml:mfrac><mml:mn>2</mml:mn><mml:mi>œÄ</mml:mi></mml:mfrac><mml:mo>‚à´</mml:mo><mml:mi mathvariant="normal">d</mml:mi><mml:msub><mml:mi>œá</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mi>W</mml:mi><mml:mrow><mml:mo stretchy="true" form="prefix">(</mml:mo><mml:msub><mml:mi>œá</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo stretchy="true" form="postfix">)</mml:mo></mml:mrow><mml:mo>‚à´</mml:mo><mml:mi mathvariant="normal">d</mml:mi><mml:msub><mml:mi>œá</mml:mi><mml:mn>2</mml:mn></mml:msub><mml:mi>W</mml:mi><mml:mrow><mml:mo stretchy="true" form="prefix">(</mml:mo><mml:msub><mml:mi>œá</mml:mi><mml:mn>2</mml:mn></mml:msub><mml:mo stretchy="true" form="postfix">)</mml:mo></mml:mrow><mml:mo>‚à´</mml:mo><mml:msup><mml:mi>k</mml:mi><mml:mn>2</mml:mn></mml:msup><mml:mi mathvariant="normal">d</mml:mi><mml:mi>k</mml:mi><mml:mspace width="0.278em"></mml:mspace><mml:msub><mml:mi>P</mml:mi><mml:mi mathvariant="normal">m</mml:mi></mml:msub><mml:mrow><mml:mo stretchy="true" form="prefix">(</mml:mo><mml:mi>k</mml:mi><mml:mo>,</mml:mo><mml:msub><mml:mi>œá</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>œá</mml:mi><mml:mn>2</mml:mn></mml:msub><mml:mo stretchy="true" form="postfix">)</mml:mo></mml:mrow><mml:msub><mml:mi>j</mml:mi><mml:mo>‚Ñì</mml:mo></mml:msub><mml:mrow><mml:mo stretchy="true" form="prefix">(</mml:mo><mml:mi>k</mml:mi><mml:msub><mml:mi>œá</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo stretchy="true" form="postfix">)</mml:mo></mml:mrow><mml:msub><mml:mi>j</mml:mi><mml:mo>‚Ñì</mml:mo></mml:msub><mml:mrow><mml:mo stretchy="true" form="prefix">(</mml:mo><mml:mi>k</mml:mi><mml:msub><mml:mi>œá</mml:mi><mml:mn>2</mml:mn></mml:msub><mml:mo stretchy="true" form="postfix">)</mml:mo></mml:mrow><mml:mspace width="0.278em"></mml:mspace><mml:mo>,</mml:mo></mml:mrow></mml:math></alternatives></disp-formula></p>
    <p>for <inline-formula><alternatives>
    <tex-math><![CDATA[W]]></tex-math>
    <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:mi>W</mml:mi></mml:math></alternatives></inline-formula>,
    we assume a Gaussian shell in redshift with width
    <inline-formula><alternatives>
    <tex-math><![CDATA[\sigma_z = 0.01]]></tex-math>
    <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:mrow><mml:msub><mml:mi>œÉ</mml:mi><mml:mi>z</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mn>0.01</mml:mn></mml:mrow></mml:math></alternatives></inline-formula>
    centred at <inline-formula><alternatives>
    <tex-math><![CDATA[z = 0.6]]></tex-math>
    <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:mrow><mml:mi>z</mml:mi><mml:mo>=</mml:mo><mml:mn>0.6</mml:mn></mml:mrow></mml:math></alternatives></inline-formula>,
    <inline-formula><alternatives>
    <tex-math><![CDATA[\chi(z)]]></tex-math>
    <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:mrow><mml:mi>œá</mml:mi><mml:mrow><mml:mo stretchy="true" form="prefix">(</mml:mo><mml:mi>z</mml:mi><mml:mo stretchy="true" form="postfix">)</mml:mo></mml:mrow></mml:mrow></mml:math></alternatives></inline-formula>
    is the comoving distance. The matter power spectrum,
    <inline-formula><alternatives>
    <tex-math><![CDATA[P_{\mathrm{m}}]]></tex-math>
    <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:msub><mml:mi>P</mml:mi><mml:mi mathvariant="normal">m</mml:mi></mml:msub></mml:math></alternatives></inline-formula>,
    is again calculated with <monospace>camb</monospace>. The results
    from <monospace>pylevin</monospace> are compared to
    <monospace>CCL</monospace> (Chisari et al.
    (<xref alt="2019" rid="ref-chisari_core_2019" ref-type="bibr">2019</xref>)),
    which implements an FFTLog algorithm
    (<xref alt="Fang et al., 2020" rid="ref-fang_2020" ref-type="bibr">Fang
    et al., 2020</xref>;
    <xref alt="Leonard et al., 2023" rid="ref-leonard_2023" ref-type="bibr">Leonard
    et al., 2023</xref>). This implementation first solves the two
    integrals over <inline-formula><alternatives>
    <tex-math><![CDATA[\chi_{1,2}]]></tex-math>
    <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:msub><mml:mi>œá</mml:mi><mml:mrow><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mn>2</mml:mn></mml:mrow></mml:msub></mml:math></alternatives></inline-formula>
    using FFTLog and then carries out the remaining integral over
    <inline-formula><alternatives>
    <tex-math><![CDATA[k]]></tex-math>
    <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:mi>k</mml:mi></mml:math></alternatives></inline-formula>
    and assumes that the <inline-formula><alternatives>
    <tex-math><![CDATA[k]]></tex-math>
    <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:mi>k</mml:mi></mml:math></alternatives></inline-formula>
    and <inline-formula><alternatives>
    <tex-math><![CDATA[\chi_{1,2}]]></tex-math>
    <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:msub><mml:mi>œá</mml:mi><mml:mrow><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mn>2</mml:mn></mml:mrow></mml:msub></mml:math></alternatives></inline-formula>
    dependence in the matter power spectrum is separable. To be
    consistent, we follow the same approach: we first integrate the
    <inline-formula><alternatives>
    <tex-math><![CDATA[\chi_{1,2}]]></tex-math>
    <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:msub><mml:mi>œá</mml:mi><mml:mrow><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mn>2</mml:mn></mml:mrow></mml:msub></mml:math></alternatives></inline-formula>
    using <monospace>pylevin</monospace>, then calculate the remaining
    <inline-formula><alternatives>
    <tex-math><![CDATA[k]]></tex-math>
    <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:mi>k</mml:mi></mml:math></alternatives></inline-formula>
    integration using the composite Simpson‚Äôs rule implemented in
    <monospace>scipy</monospace>. The right side of
    <xref alt="[fig:figure3]" rid="figU003Afigure3">[fig:figure3]</xref>
    shows that the two methods agree very well with each other and that
    the method implemented in <monospace>CCL</monospace> is about a
    factor of 2 faster. If the power spectrum, however, were not
    separable on small <inline-formula><alternatives>
    <tex-math><![CDATA[k]]></tex-math>
    <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:mi>k</mml:mi></mml:math></alternatives></inline-formula>,
    as it can be the case in modified gravity scenarios, the
    <monospace>CCL</monospace> method would need to split the integral
    up into sub-intervals where the separability holds, slowing down the
    computation by a factor equal to the number of sub-intervals. This
    assumption is not done in <monospace>pylevin</monospace>.</p>
    <fig>
      <caption><p>Comparison of <monospace>pylevin</monospace> with two
      other methods, the colour scheme is the same as in
      <xref alt="[fig:figure2]" rid="figU003Afigure2">[fig:figure2]</xref>.
      <bold>Left</bold>: Transformation defined in
      <inline-formula><alternatives>
      <tex-math><![CDATA[\mathrm{FT}(k)]]></tex-math>
      <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:mrow><mml:mrow><mml:mi mathvariant="normal">F</mml:mi><mml:mi mathvariant="normal">T</mml:mi></mml:mrow><mml:mrow><mml:mo stretchy="true" form="prefix">(</mml:mo><mml:mi>k</mml:mi><mml:mo stretchy="true" form="postfix">)</mml:mo></mml:mrow></mml:mrow></mml:math></alternatives></inline-formula>
      with the <monospace>pyfftlog</monospace> package.
      <bold>Right</bold>: angular power spectra,
      <inline-formula><alternatives>
      <tex-math><![CDATA[C(\ell)]]></tex-math>
      <mml:math display="inline" xmlns:mml="http://www.w3.org/1998/Math/MathML"><mml:mrow><mml:mi>C</mml:mi><mml:mrow><mml:mo stretchy="true" form="prefix">(</mml:mo><mml:mo>‚Ñì</mml:mo><mml:mo stretchy="true" form="postfix">)</mml:mo></mml:mrow></mml:mrow></mml:math></alternatives></inline-formula>
      computed with <monospace>pyCCL</monospace>. We show the relative
      difference between the two methods in the lower panel.
      <styled-content id="figU003Afigure3"></styled-content></p></caption>
      <graphic mimetype="application" mime-subtype="pdf" xlink:href="paper_plot_3_joss.pdf" />
    </fig>
  </sec>
</sec>
<sec id="acknowledgements">
  <title>Acknowledgements</title>
  <p>I would like to thank Andrina Nicola and Paul Rogozenski for their
  help fixing issues with the CCL non-Limber comparison.</p>
</sec>
</body>
<back>
<ref-list>
  <title></title>
  <ref id="ref-ogata_2005">
    <element-citation publication-type="article-journal">
      <person-group person-group-type="author">
        <name><surname>Ogata</surname><given-names>H.</given-names></name>
      </person-group>
      <article-title>A numerical integration formula based on the Bessel functions</article-title>
      <source>Publications of the Research Institute for Mathematical Sciences</source>
      <year iso-8601-date="2005-11">2005</year><month>11</month>
      <volume>41</volume>
      <pub-id pub-id-type="doi">10.2977/prims/1145474602</pub-id>
      <fpage>949</fpage>
      <lpage>970</lpage>
    </element-citation>
  </ref>
  <ref id="ref-chisari_core_2019">
    <element-citation publication-type="article-journal">
      <person-group person-group-type="author">
        <name><surname>Chisari</surname><given-names>Nora Elisa</given-names></name>
        <name><surname>Alonso</surname><given-names>David</given-names></name>
        <name><surname>Krause</surname><given-names>Elisabeth</given-names></name>
        <name><surname>Leonard</surname><given-names>C. Danielle</given-names></name>
        <name><surname>Bull</surname><given-names>Philip</given-names></name>
        <name><surname>Neveu</surname><given-names>J√©r√©my</given-names></name>
        <name><surname>Villarreal</surname><given-names>Antonia Sierra</given-names></name>
        <name><surname>Singh</surname><given-names>Sukhdeep</given-names></name>
        <name><surname>McClintock</surname><given-names>Thomas</given-names></name>
        <name><surname>Ellison</surname><given-names>John</given-names></name>
        <name><surname>Du</surname><given-names>Zilong</given-names></name>
        <name><surname>Zuntz</surname><given-names>Joe</given-names></name>
        <name><surname>Mead</surname><given-names>Alexander</given-names></name>
        <name><surname>Joudaki</surname><given-names>Shahab</given-names></name>
        <name><surname>Lorenz</surname><given-names>Christiane S.</given-names></name>
        <name><surname>Tr√∂ster</surname><given-names>Tilman</given-names></name>
        <name><surname>Sanchez</surname><given-names>Javier</given-names></name>
        <name><surname>Lanusse</surname><given-names>Francois</given-names></name>
        <name><surname>Ishak</surname><given-names>Mustapha</given-names></name>
        <name><surname>Hlozek</surname><given-names>Ren√©e</given-names></name>
        <name><surname>Blazek</surname><given-names>Jonathan</given-names></name>
        <name><surname>Campagne</surname><given-names>Jean-Eric</given-names></name>
        <name><surname>Almoubayyed</surname><given-names>Husni</given-names></name>
        <name><surname>Eifler</surname><given-names>Tim</given-names></name>
        <name><surname>Kirby</surname><given-names>Matthew</given-names></name>
        <name><surname>Kirkby</surname><given-names>David</given-names></name>
        <name><surname>Plaszczynski</surname><given-names>St√©phane</given-names></name>
        <name><surname>Slosar</surname><given-names>An≈æe</given-names></name>
        <name><surname>Vrastil</surname><given-names>Michal</given-names></name>
        <name><surname>Wagoner</surname><given-names>Erika L.</given-names></name>
        <string-name>LSST Dark Energy Science Collaboration</string-name>
      </person-group>
      <article-title>Core cosmology library: Precision cosmological predictions for LSST</article-title>
      <source>The Astrophysical Journal Supplement Series</source>
      <year iso-8601-date="2019-05">2019</year><month>05</month>
      <date-in-citation content-type="access-date"><year iso-8601-date="2024-02-21">2024</year><month>02</month><day>21</day></date-in-citation>
      <volume>242</volume>
      <issn>0067-0049</issn>
      <uri>https://ui.adsabs.harvard.edu/abs/2019ApJS..242....2C</uri>
      <pub-id pub-id-type="doi">10.3847/1538-4365/ab1658</pub-id>
      <fpage>2</fpage>
      <lpage></lpage>
    </element-citation>
  </ref>
  <ref id="ref-leonard_2023">
    <element-citation publication-type="article-journal">
      <person-group person-group-type="author">
        <name><surname>Leonard</surname><given-names>C. Danielle</given-names></name>
        <name><surname>Ferreira</surname><given-names>Tassia</given-names></name>
        <name><surname>Fang</surname><given-names>Xiao</given-names></name>
        <name><surname>Reischke</surname><given-names>Robert</given-names></name>
        <name><surname>Schoeneberg</surname><given-names>Nils</given-names></name>
        <name><surname>Tr√∂ster</surname><given-names>Tilman</given-names></name>
        <name><surname>Alonso</surname><given-names>David</given-names></name>
        <name><surname>Campagne</surname><given-names>Jean-Eric</given-names></name>
        <name><surname>Lanusse</surname><given-names>Fran√ßois</given-names></name>
        <name><surname>Slosar</surname><given-names>An≈æe</given-names></name>
        <name><surname>Ishak</surname><given-names>Mustapha</given-names></name>
      </person-group>
      <article-title>The N5K challenge: Non-limber integration for LSST cosmology</article-title>
      <source>The Open Journal of Astrophysics</source>
      <year iso-8601-date="2023-02">2023</year><month>02</month>
      <volume>6</volume>
      <uri>https://arxiv.org/abs/2212.04291</uri>
      <pub-id pub-id-type="doi">10.21105/astro.2212.04291</pub-id>
      <fpage>8</fpage>
      <lpage></lpage>
    </element-citation>
  </ref>
  <ref id="ref-hamilton_2000">
    <element-citation publication-type="article-journal">
      <person-group person-group-type="author">
        <name><surname>Hamilton</surname><given-names>A. J. S.</given-names></name>
      </person-group>
      <article-title>Uncorrelated modes of the non-linear power spectrum</article-title>
      <source>Monthly Notices of the Royal Astronomical Society</source>
      <year iso-8601-date="2000-02">2000</year><month>02</month>
      <volume>312</volume>
      <issue>2</issue>
      <uri>https://arxiv.org/abs/astro-ph/9905191</uri>
      <pub-id pub-id-type="doi">10.1046/j.1365-8711.2000.03071.x</pub-id>
      <fpage>257</fpage>
      <lpage>284</lpage>
    </element-citation>
  </ref>
  <ref id="ref-murray_2019">
    <element-citation publication-type="article-journal">
      <person-group person-group-type="author">
        <name><surname>Murray</surname><given-names>Steven</given-names></name>
        <name><surname>Poulin</surname><given-names>Francis</given-names></name>
      </person-group>
      <article-title>hankel: A Python library for performing simple and accurate Hankel transformations</article-title>
      <source>The Journal of Open Source Software</source>
      <year iso-8601-date="2019-05">2019</year><month>05</month>
      <volume>4</volume>
      <issue>37</issue>
      <uri>https://arxiv.org/abs/1906.01088</uri>
      <pub-id pub-id-type="doi">10.21105/joss.01397</pub-id>
      <fpage>1397</fpage>
      <lpage></lpage>
    </element-citation>
  </ref>
  <ref id="ref-iserles_efficient_2005">
    <element-citation publication-type="article-journal">
      <person-group person-group-type="author">
        <name><surname>Iserles</surname><given-names>Arieh</given-names></name>
        <name><surname>N√∏rsett</surname><given-names>Syvert P</given-names></name>
      </person-group>
      <article-title>Efficient quadrature of highly oscillatory integrals using derivatives</article-title>
      <source>Proceedings of the Royal Society A: Mathematical, Physical and Engineering Sciences</source>
      <year iso-8601-date="2005-04">2005</year><month>04</month>
      <date-in-citation content-type="access-date"><year iso-8601-date="2024-12-03">2024</year><month>12</month><day>03</day></date-in-citation>
      <volume>461</volume>
      <issue>2057</issue>
      <uri>https://royalsocietypublishing.org/doi/10.1098/rspa.2004.1401</uri>
      <pub-id pub-id-type="doi">10.1098/rspa.2004.1401</pub-id>
      <fpage>1383</fpage>
      <lpage>1399</lpage>
    </element-citation>
  </ref>
  <ref id="ref-schoneberg_2018">
    <element-citation publication-type="article-journal">
      <person-group person-group-type="author">
        <name><surname>Sch√∂neberg</surname><given-names>Nils</given-names></name>
        <name><surname>Simonoviƒá</surname><given-names>Marko</given-names></name>
        <name><surname>Lesgourgues</surname><given-names>Julien</given-names></name>
        <name><surname>Zaldarriaga</surname><given-names>Matias</given-names></name>
      </person-group>
      <article-title>Beyond the traditional line-of-sight approach of cosmological angular statistics</article-title>
      <source>JCAP</source>
      <year iso-8601-date="2018-10">2018</year><month>10</month>
      <volume>2018</volume>
      <issue>10</issue>
      <uri>https://arxiv.org/abs/1807.09540</uri>
      <pub-id pub-id-type="doi">10.1088/1475-7516/2018/10/047</pub-id>
      <fpage>047</fpage>
      <lpage></lpage>
    </element-citation>
  </ref>
  <ref id="ref-lewis_cosmological_2002">
    <element-citation publication-type="article-journal">
      <person-group person-group-type="author">
        <name><surname>Lewis</surname><given-names>Antony</given-names></name>
        <name><surname>Bridle</surname><given-names>Sarah</given-names></name>
      </person-group>
      <article-title>Cosmological parameters from CMB and other data: A Monte Carlo approach</article-title>
      <source>Physical Review D</source>
      <year iso-8601-date="2002">2002</year>
      <volume>D66</volume>
      <pub-id pub-id-type="doi">10.1103/PhysRevD.66.103511</pub-id>
      <fpage>103511</fpage>
      <lpage></lpage>
    </element-citation>
  </ref>
  <ref id="ref-levin_1996">
    <element-citation publication-type="article-journal">
      <person-group person-group-type="author">
        <name><surname>Levin</surname><given-names>David</given-names></name>
      </person-group>
      <article-title>Fast integration of rapidly oscillatory functions</article-title>
      <source>Journal of Computational and Applied Mathematics</source>
      <year iso-8601-date="1996">1996</year>
      <volume>67</volume>
      <issue>1</issue>
      <issn>0377-0427</issn>
      <uri>https://www.sciencedirect.com/science/article/pii/0377042794001189</uri>
      <pub-id pub-id-type="doi">10.1016/0377-0427(94)00118-9</pub-id>
      <fpage>95</fpage>
      <lpage>101</lpage>
    </element-citation>
  </ref>
  <ref id="ref-karamanis_2021">
    <element-citation publication-type="article-journal">
      <person-group person-group-type="author">
        <name><surname>Karamanis</surname><given-names>Minas</given-names></name>
        <name><surname>Beutler</surname><given-names>Florian</given-names></name>
      </person-group>
      <article-title>hankl: A lightweight Python implementation of the FFTLog algorithm for Cosmology</article-title>
      <source>arXiv e-prints</source>
      <year iso-8601-date="2021-06">2021</year><month>06</month>
      <uri>https://arxiv.org/abs/2106.06331</uri>
      <pub-id pub-id-type="doi">10.48550/arXiv.2106.06331</pub-id>
      <fpage>arXiv:2106.06331</fpage>
      <lpage></lpage>
    </element-citation>
  </ref>
  <ref id="ref-zieser_2016">
    <element-citation publication-type="article-journal">
      <person-group person-group-type="author">
        <name><surname>Zieser</surname><given-names>Britta</given-names></name>
        <name><surname>Merkel</surname><given-names>Philipp M.</given-names></name>
      </person-group>
      <article-title>The cross-correlation between 3D cosmic shear and the integrated Sachs-Wolfe effect</article-title>
      <source></source>
      <year iso-8601-date="2016-06">2016</year><month>06</month>
      <volume>459</volume>
      <issue>2</issue>
      <uri>https://arxiv.org/abs/1603.06406</uri>
      <pub-id pub-id-type="doi">10.1093/mnras/stw665</pub-id>
      <fpage>1586</fpage>
      <lpage>1595</lpage>
    </element-citation>
  </ref>
  <ref id="ref-chen_2022">
    <element-citation publication-type="article-journal">
      <person-group person-group-type="author">
        <name><surname>Chen</surname><given-names>Shukui</given-names></name>
        <name><surname>Serkh</surname><given-names>Kirill</given-names></name>
        <name><surname>Bremer</surname><given-names>James</given-names></name>
      </person-group>
      <article-title>On the adaptive Levin method</article-title>
      <source>arXiv e-prints</source>
      <year iso-8601-date="2022-11">2022</year><month>11</month>
      <uri>https://arxiv.org/abs/2211.13400</uri>
      <pub-id pub-id-type="doi">10.48550/arXiv.2211.13400</pub-id>
      <fpage>arXiv:2211.13400</fpage>
      <lpage></lpage>
    </element-citation>
  </ref>
  <ref id="ref-fang_2020">
    <element-citation publication-type="article-journal">
      <person-group person-group-type="author">
        <name><surname>Fang</surname><given-names>Xiao</given-names></name>
        <name><surname>Eifler</surname><given-names>Tim</given-names></name>
        <name><surname>Krause</surname><given-names>Elisabeth</given-names></name>
      </person-group>
      <article-title>2D-FFTLog: efficient computation of real-space covariance matrices for galaxy clustering and weak lensing</article-title>
      <source>MNRAS</source>
      <year iso-8601-date="2020-09">2020</year><month>09</month>
      <volume>497</volume>
      <issue>3</issue>
      <uri>https://arxiv.org/abs/2004.04833</uri>
      <pub-id pub-id-type="doi">10.1093/mnras/staa1726</pub-id>
      <fpage>2699</fpage>
      <lpage>2714</lpage>
    </element-citation>
  </ref>
  <ref id="ref-grasshorn_2018">
    <element-citation publication-type="article-journal">
      <person-group person-group-type="author">
        <name><surname>Grasshorn Gebhardt</surname><given-names>Henry S.</given-names></name>
        <name><surname>Jeong</surname><given-names>Donghui</given-names></name>
      </person-group>
      <article-title>Fast and accurate computation of projected two-point functions</article-title>
      <source>PRD</source>
      <year iso-8601-date="2018-01">2018</year><month>01</month>
      <volume>97</volume>
      <issue>2</issue>
      <uri>https://arxiv.org/abs/1709.02401</uri>
      <pub-id pub-id-type="doi">10.1103/PhysRevD.97.023504</pub-id>
      <fpage>023504</fpage>
      <lpage></lpage>
    </element-citation>
  </ref>
</ref-list>
</back>
</article>
